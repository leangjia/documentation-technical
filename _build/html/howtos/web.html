<!doctype html>


<html xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  
    <title>建造界面扩展 &mdash; odoo 9.0 文档</title>
    
    <link rel="stylesheet" href="../_static/style.css" type="text/css" />
    <link rel="stylesheet" href="../_static/pygments.css" type="text/css" />
    <link rel="stylesheet" href="../_static/patchqueue.css" type="text/css" />
    
    <script type="text/javascript">
      var DOCUMENTATION_OPTIONS = {
        URL_ROOT:    '../',
        VERSION:     '9.0',
        COLLAPSE_INDEX: false,
        FILE_SUFFIX: '.html',
        HAS_SOURCE:  true
      };
    </script>
    <script type="text/javascript" src="../_static/jquery.js"></script>
    <script type="text/javascript" src="../_static/underscore.js"></script>
    <script type="text/javascript" src="../_static/doctools.js"></script>
    <script type="text/javascript" src="../_static/translations.js"></script>
    <script type="text/javascript" src="../_static/patchqueue.js"></script>
    <script type="text/javascript" src="../_static/jquery.min.js"></script>
    <script type="text/javascript" src="../_static/bootstrap.js"></script>
    <script type="text/javascript" src="../_static/doc.js"></script>
    <script type="text/javascript" src="../_static/jquery.noconflict.js"></script>
    <link rel="top" title="odoo 9.0 文档" href="../index.html" />
    <link rel="up" title="Tutorials" href="../tutorials.html" />
    <link rel="next" title="Web服务API" href="../api_integration.html" />
    <link rel="prev" title="构建模块" href="backend.html" /> 
  </head>
  <body role="document"><header class="o_main_header o_has_sub_nav o_inverted ">
    <div class="o_main_header_main">
      <a class="pull-left o_logo" href="/"></a>
      <a href="#" class="o_mobile_menu_toggle visible-xs-block pull-right">
        <span class="sr-only">Toggle navigation</span>
        <span class="mdi-navigation-menu"></span>
      </a>
      <div class="o_header_buttons">
        <a href="http://www.odoo.com/trial" class="btn btn-primary">Start Now</a>
      </div>
      <ul class="o_primary_nav">
        <li class="dropdown">
          <a href="#" class="dropdown-toggle">Apps</a>
          <div class="dropdown-menu o_secondary_nav">
            <div class="container">
              <div class="row">
                <div class="col-sm-3 o_website_apps">
                  <div class="o_nav_app_family">
                    <span></span> Websites
                    <div>Build great user experience</div>
                  </div>
                  <ul>
                    <li><a href="https://www.odoo.com/page/website-builder">Website Builder</a></li>
                    <li><a href="https://www.odoo.com/page/e-commerce">eCommerce</a></li>
                    <li><a href="https://www.odoo.com/page/blog-engine">Blogs</a></li>
                    <li><a href="https://www.odoo.com/page/community-builder">Forums</a></li>
                    <li><a href="https://www.odoo.com/page/slides">Slides</a></li>
                    <li><a href="https://adspike.odoo.com">SEA</a></li>
                  </ul>
                </div>
                <div class="col-sm-3 o_sale_apps">
                  <div class="o_nav_app_family">
                    <span></span> Sales
                    <div>Boost your success rate</div>
                  </div>
                  <ul>
                    <li><a href="https://www.odoo.com/page/sales">Sales</a></li>
                    <li><a href="https://www.odoo.com/page/crm">CRM</a></li>
                    <li><a href="https://www.odoo.com/page/billing">Invoicing</a></li>
                    <li class="dropdown">
                      <a href="#0" class="dropdown-toggle">Point of Sale</a>
                      <ul>
                        <li><a href="https://www.odoo.com/page/point-of-sale">Shops</a></li>
                        <li><a href="https://www.odoo.com/page/pos-restaurant">Restaurants</a></li>
                      </ul>
                    </li>
                    <li><a href="https://www.odoo.com/page/subscriptions">Subscriptions</a></li>
                    <li><a href="https://www.odoo.com/page/sign">Sign</a></li>
                  </ul>
                </div>
                <div class="col-sm-3 o_operation_apps">
                  <div class="o_nav_app_family">
                    <span></span> Operations
                    <div>It's all about efficiency</div>
                  </div>
                  <ul>
                    <li><a href="https://www.odoo.com/page/accounting/">Accounting</a></li>
                    <li><a href="https://www.odoo.com/page/project-management/">Project</a></li>
                    <li class="dropdown">
                      <a href="#0" class="dropdown-toggle">Human Resources</a>
                      <ul>
                        <li><a href="https://www.odoo.com/page/recruitment">Recruitment</a></li>
                        <li><a href="https://www.odoo.com/page/employees">Employees</a></li>
                        <li><a href="https://www.odoo.com/page/expenses">Expenses</a></li>
                        <li><a href="https://www.odoo.com/page/appraisal">Appraisal</a></li>
                        <li><a href="https://www.odoo.com/page/fleet">Fleet</a></li>
                        <li><a href="https://www.odoo.com/page/leaves">Leaves</a></li>
                      </ul>
                    </li>
                    <li><a href="https://www.odoo.com/page/warehouse">Inventory</a></li>
                    <li><a href="https://www.odoo.com/page/purchase">Purchase</a></li>
                    <li class="dropdown">
                      <a href="#0" class="dropdown-toggle">Manufacturing</a>
                      <ul>
                        <li><a href="https://www.odoo.com/page/manufacturing">MRP</a></li>
                        <li><a href="https://www.odoo.com/page/plm">PLM</a></li>
                        <li><a href="https://www.odoo.com/page/maintenance">Maintenance</a></li>
                        <li><a href="https://www.odoo.com/page/quality">Quality</a></li>
                      </ul>
                    </li>
                  </ul>
                </div>
                <div class="col-sm-3 o_productivity_apps">
                  <div class="o_nav_app_family">
                    <span></span> Productivity Tools
                    <div>Great Tools = Happy People</div>
                  </div>
                  <ul>
                    <li class="dropdown">
                      <a href="#0" class="dropdown-toggle">Communication</a>
                      <ul>
                        <li><a href="https://www.odoo.com/page/discuss">Discuss</a></li>
                        <li><a href="https://www.odoo.com/page/discuss-groups">Mailing Lists</a></li>
                        <li><a href="https://www.odoo.com/page/notes">Notes</a></li>
                        <li><a href="#">Help desk</a></li>
                        <li><a href="#">Appointment</a></li>
                      </ul>
                    </li>
                    <li><a href="https://www.odoo.com/page/timesheet">Timesheet</a></li>
                    <li><a href="https://www.odoo.com/page/email-marketing">Email Marketing</a></li>
                    <li><a href="https://www.odoo.com/page/events">Events</a></li>
                    <li><a href="https://www.odoo.com/page/survey">Survey</a></li>
                    <li><a href="https://www.odoo.com/page/live-chat">Live Chat</a></li>
                  </ul>
                </div>
              </div>
            </div>
            <a href="http://www.odoo.com/apps/modules" class="o_store_link"><i class="fa fa-cube fa-fw"></i> Third party apps</a>
          </div>
        </li>
        <li><a href="https://www.odoo.com/page/tour">Tour</a></li>
        <li><a href="https://www.odoo.com/pricing">Pricing</a></li>
        <li><a href="https://www.odoo.com/page/docs">Docs</a></li>
      </ul>
    </div>
    <nav class="navbar o_sub_nav">
      <div class="container">
        <div class="navbar-header visible-xs">
            <button type="button" class="navbar-toggle collapsed text-left btn-block" data-toggle="collapse" data-target="#o_sub-menu" aria-expanded="false">
              Navigate
              <span class="mdi-hardware-keyboard-arrow-down pull-right"></span>
            </button>
        </div>

        <div class="collapse navbar-collapse" id="o_sub-menu">
          <ol class="o_breadcrumb breadcrumb nav navbar-left">
              
              





    
        
            <li><a href="../index.html">Developer Doc</a></li>
        
    
    <li class="active"><a href="#">建造界面扩展</a></li>

              
          </ol>

          <div class="call-to-action navbar-right hidden-xs">
            <a href="http://www.odoo.com/trial" class="btn btn-primary">Start Now</a>
          </div>

          <ul class="navbar-nav navbar-right nav o_sub_nav_actions">
            
              <li class="divider"></li>
            

            
            


            
          </ul>

          <ul class="nav navbar-nav navbar-right">
            

            
            

<li><a href="http://www.odoo.com/documentation/user/9.0/index.html">User</a></li>
<li><a href="http://www.odoo.com/documentation/9.0/index.html">Developer</a></li>
<li><a href="http://www.odoo.com/documentation/9.0/api_integration.html">API</a></li>
<li><a href="http://www.odoo.com/documentation/9.0/setup/install.html">Installation</a></li>
<li><a href="http://www.odoo.com/page/odoo-white-paper">White Papers</a></li>
<li><a href="http://www.odoo.com/page/legal">Legal</a></li>
            

            
          </ul>
        </div>
      </div>
    </nav>
  </header><div id="wrap" class="">
    
    
    
    <figure class="card top has_banner">
      <span class="card-img" style="background-image: url('../_static/banners/build_interface_ext.jpg');"></span>
      <div class="container text-center">
        <h1> 建造界面扩展 </h1>
      </div>
    </figure>
    
    
    
    <div class="container ">
      <main class="container-fluid ">
        
        <div class="row">
          
          <aside>
            <div class="navbar-aside text-center">
              <ul class="list-group text-left nav"><li class="list-group-item"><a href="#a-simple-module" class="ripple internal reference">一个简单的模块</a></li><li class="list-group-item"><a href="#odoo-javascript-module" class="ripple internal reference">Odoo的JavaScript模块</a></li><li class="list-group-item"><a href="#classes" class="ripple internal reference">类</a></li><li class="list-group-item"><a href="#widgets-basics" class="ripple internal reference">挂件基础</a><ul ><li class="list-group-item"><a href="#your-first-widget" class="ripple internal reference">你的第一个挂件</a></li><li class="list-group-item"><a href="#display-content" class="ripple internal reference">显示内容</a></li><li class="list-group-item"><a href="#widget-parents-and-children" class="ripple internal reference">Widget Parents and Children</a></li><li class="list-group-item"><a href="#destroying-widgets" class="ripple internal reference">销毁挂件</a></li></ul></li><li class="list-group-item"><a href="#the-qweb-template-engine" class="ripple internal reference">QWeb模板引擎</a><ul ><li class="list-group-item"><a href="#using-qweb" class="ripple internal reference">使用QWeb</a><ul ><li class="list-group-item"><a href="#qweb-context" class="ripple internal reference">QWeb上下文</a></li><li class="list-group-item"><a href="#template-declaration" class="ripple internal reference">模板声明</a></li><li class="list-group-item"><a href="#escaping" class="ripple internal reference">Escaping</a></li><li class="list-group-item"><a href="#outputting-html" class="ripple internal reference">输出HTML</a></li><li class="list-group-item"><a href="#conditionals" class="ripple internal reference">条件语句</a></li><li class="list-group-item"><a href="#iteration" class="ripple internal reference">迭代</a></li><li class="list-group-item"><a href="#defining-attributes" class="ripple internal reference">定义属性</a></li><li class="list-group-item"><a href="#calling-other-templates" class="ripple internal reference">调用其他模板</a></li><li class="list-group-item"><a href="#to-learn-more-about-qweb" class="ripple internal reference">要了解更多关于QWeb</a></li><li class="list-group-item"><a href="#exercise" class="ripple internal reference">练习</a></li></ul></li></ul></li><li class="list-group-item"><a href="#widget-helpers" class="ripple internal reference">挂件助手</a><ul ><li class="list-group-item"><a href="#widget-s-jquery-selector" class="ripple internal reference">``Widget``的jQuery选择</a></li><li class="list-group-item"><a href="#easier-dom-events-binding" class="ripple internal reference">更简单的DOM事件绑定</a></li></ul></li><li class="list-group-item"><a href="#widget-events-and-properties" class="ripple internal reference">挂件事件和属性</a><ul ><li class="list-group-item"><a href="#events" class="ripple internal reference">活动</a></li><li class="list-group-item"><a href="#properties" class="ripple internal reference">性能</a></li><li class="list-group-item"><a href="#id3" class="ripple internal reference">练习</a></li></ul></li><li class="list-group-item"><a href="#modify-existing-widgets-and-classes" class="ripple internal reference">修改现有的小部件和类</a></li><li class="list-group-item"><a href="#translations" class="ripple internal reference">翻译</a></li><li class="list-group-item"><a href="#communication-with-the-odoo-server" class="ripple internal reference">与Odoo服务器通信</a><ul ><li class="list-group-item"><a href="#contacting-models" class="ripple internal reference">联系模型</a></li><li class="list-group-item"><a href="#compoundcontext" class="ripple internal reference">CompoundContext</a></li><li class="list-group-item"><a href="#queries" class="ripple internal reference">查询</a></li></ul></li><li class="list-group-item"><a href="#exercises" class="ripple internal reference">练习</a></li><li class="list-group-item"><a href="#existing-web-components" class="ripple internal reference">现有的Web组件</a><ul ><li class="list-group-item"><a href="#the-action-manager" class="ripple internal reference">动作管理器</a><ul ><li class="list-group-item"><a href="#using-the-action-manager" class="ripple internal reference">使用动作管理器</a></li></ul></li><li class="list-group-item"><a href="#client-actions" class="ripple internal reference">客户端动作</a></li><li class="list-group-item"><a href="#architecture-of-the-views" class="ripple internal reference">视图的体系结构</a><ul ><li class="list-group-item"><a href="#the-view-manager" class="ripple internal reference">视图管理器</a></li><li class="list-group-item"><a href="#the-views" class="ripple internal reference">The Views</a></li></ul></li><li class="list-group-item"><a href="#the-form-view-fields" class="ripple internal reference">表单视图字段</a><ul ><li class="list-group-item"><a href="#creating-a-new-type-of-field" class="ripple internal reference">创建域的一种新类型</a><ul ><li class="list-group-item"><a href="#simple-read-only-field" class="ripple internal reference">简单的只读字段</a></li><li class="list-group-item"><a href="#read-write-field" class="ripple internal reference">读写字段</a></li></ul></li></ul></li><li class="list-group-item"><a href="#the-form-view-custom-widgets" class="ripple internal reference">表单视图定制的挂件</a></li></ul></li></ul>
              
              <p class="gith-container"><a href="https://github.com/odoo/odoo/edit/9.0/doc/howtos/web.rst" class="gith-link">
                  Edit on GitHub
              </a></p>
              
            </div>
          </aside>
          
          <article class="doc-body ">
            
            
  <section id="building-interface-extensions"><p >本指南是有关Odoo的Web客户端创建模块。</p><p >To create websites with Odoo, see <a href="website.html" class="internal reference"><em >建造网站</em></a>; to add business capabilities
or extend existing business systems of Odoo, see <a href="backend.html" class="internal reference"><em >构建模块</em></a>.</p><div role="alert" class="alert-warning alert"><p class="alert-title">警告</p><p >This guide assumes knowledge of:</p><ul ><li ><p >Javascript的基础知识和良好做法</p></li><li ><a href="http://jquery.org" class="external reference alert-link">jQuery</a></li><li ><a href="http://underscorejs.org" class="external reference alert-link">Underscore.js</a></li></ul><p >It also requires <a href="../setup/install.html#setup-install" class="internal alert-link reference"><span >an installed Odoo</span></a>, and <a href="http://git-scm.com" class="external reference alert-link">Git</a>.</p></div></section><section id="a-simple-module"><h2 >一个简单的模块</h2><p >让我们从一个简单的Odoo模块保持基本的Web组件的配置，让我们测试的Web框架。</p><p >The example module is available online and can be downloaded using the
following command:</p><div class="highlight-console"><div class="highlight"><pre><span class="gp">$</span> git clone http://github.com/odoo/petstore
</pre></div>
</div>
<p >This will create a <code >petstore</code> folder wherever you executed the command.
You then need to add that folder to Odoo's
<a href="../reference/cmdline.html#cmdoption-odoo.py--addons-path" class="internal reference"><code class="std xref std-option">addons path</code></a>, create a new database and
install the <code >oepetstore</code> module.</p><p >If you browse the <code >petstore</code> folder, you should see the following content:</p><div class="highlight-text"><div class="highlight"><pre>oepetstore
|-- images
|   |-- alligator.jpg
|   |-- ball.jpg
|   |-- crazy_circle.jpg
|   |-- fish.jpg
|   `-- mice.jpg
|-- __init__.py
|-- oepetstore.message_of_the_day.csv
|-- __openerp__.py
|-- petstore_data.xml
|-- petstore.py
|-- petstore.xml
`-- static
    `-- src
        |-- css
        |   `-- petstore.css
        |-- js
        |   `-- petstore.js
        `-- xml
            `-- petstore.xml
</pre></div>
</div>
<p >该模块已经拥有各种服务器的自定义。我们再回过头来这些之后，现在让我们专注于网络相关的内容，在``static``文件夹。</p><p >Files used in the &quot;web&quot; side of an Odoo module must be placed in a <code >static</code>
folder so they are available to a web browser, files outside that folder can
not be fetched by browsers. The <code >src/css</code>, <code >src/js</code> and <code >src/xml</code>
sub-folders are conventional and not strictly necessary.</p><dl ><dt ><code >oepetstore /静态/ CSS / petstore.css</code></dt><dd >Currently empty, will hold the <a href="http://www.w3.org/Style/CSS/Overview.en.html" class="external reference">CSS</a> for pet store content</dd><dt ><code >oepetstore /静态/ XML / petstore.xml</code></dt><dd >Mostly empty, will hold <a href="../reference/qweb.html#reference-qweb" class="internal reference"><span >QWeb</span></a> templates</dd><dt ><code >oepetstore /静态/ JS / petstore.js</code></dt><dd ><p >The most important (and interesting) part, contains the logic of the
application (or at least its web-browser side) as javascript. It should
currently look like:</p><div class="highlight-javascript"><div class="highlight"><pre><span class="nx">openerp</span><span class="p">.</span><span class="nx">oepetstore</span> <span class="o">=</span> <span class="kd">function</span><span class="p">(</span><span class="nx">instance</span><span class="p">,</span> <span class="nx">local</span><span class="p">)</span> <span class="p">{</span>
    <span class="kd">var</span> <span class="nx">_t</span> <span class="o">=</span> <span class="nx">instance</span><span class="p">.</span><span class="nx">web</span><span class="p">.</span><span class="nx">_t</span><span class="p">,</span>
        <span class="nx">_lt</span> <span class="o">=</span> <span class="nx">instance</span><span class="p">.</span><span class="nx">web</span><span class="p">.</span><span class="nx">_lt</span><span class="p">;</span>
    <span class="kd">var</span> <span class="nx">QWeb</span> <span class="o">=</span> <span class="nx">instance</span><span class="p">.</span><span class="nx">web</span><span class="p">.</span><span class="nx">qweb</span><span class="p">;</span>

    <span class="nx">local</span><span class="p">.</span><span class="nx">HomePage</span> <span class="o">=</span> <span class="nx">instance</span><span class="p">.</span><span class="nx">Widget</span><span class="p">.</span><span class="nx">extend</span><span class="p">({</span>
        <span class="nx">start</span><span class="o">:</span> <span class="kd">function</span><span class="p">()</span> <span class="p">{</span>
            <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="s2">&quot;pet store home page loaded&quot;</span><span class="p">);</span>
        <span class="p">},</span>
    <span class="p">});</span>

    <span class="nx">instance</span><span class="p">.</span><span class="nx">web</span><span class="p">.</span><span class="nx">client_actions</span><span class="p">.</span><span class="nx">add</span><span class="p">(</span>
        <span class="s1">&#39;petstore.homepage&#39;</span><span class="p">,</span> <span class="s1">&#39;instance.oepetstore.HomePage&#39;</span><span class="p">);</span>
<span class="p">}</span>
</pre></div>
</div>
</dd></dl><p >其中仅打印在浏览器的控制台一个小的消息。</p><p >The files in the <code >static</code> folder, need to be defined within the module in order for them to be loaded correctly. Everything in <code >src/xml</code> is defined in <code >__openerp__.py</code> while the contents of <code >src/css</code> and <code >src/js</code> are defined in <code >petstore.xml</code>, or a similar file.</p><div role="alert" class="alert-warning alert"><p class="alert-title">警告</p><p >All JavaScript files are concatenated and <a href="../glossary.html#term-minified" class="internal alert-link reference"><span class="std std-term xref">minified</span></a> to improve
application load time.</p><p >One of the drawback is debugging becomes more difficult as
individual files disappear and the code is made significantly less
readable. It is possible to disable this process by enabling the
&quot;developer mode&quot;: log into your Odoo instance (user <em >admin</em> password
<em >admin</em> by default) open the user menu (in the top-right corner of the
Odoo screen) and select <span class="guilabel">About Odoo</span> then <span class="guilabel">Activate
the developer mode</span>:</p><img src="../_images/about_odoo.png" class="img-responsive center-block"><img src="../_images/devmode.png" class="img-responsive center-block"><p >这将重新加载Web客户端与优化禁用，使得开发和调试显著更舒适。</p></div></section><section id="odoo-javascript-module"><h2 >Odoo的JavaScript模块</h2><p >JavaScript没有内置模块。其结果是在不同的文件中定义的变量都一起捣碎，并可能会发生冲突。这已经引起了用于构建清洁命名空间和限制命名冲突的风险，各种模块的模式。</p><p >该Odoo框架使用这样一个模式的网络插件中定义的模块，以这两个命名空间的代码并正确责令其装载。</p><p ><code >oepetstore/static/js/petstore.js</code> contains a module declaration:</p><div class="highlight-javascript"><div class="highlight"><pre><span class="nx">openerp</span><span class="p">.</span><span class="nx">oepetstore</span> <span class="o">=</span> <span class="kd">function</span><span class="p">(</span><span class="nx">instance</span><span class="p">,</span> <span class="nx">local</span><span class="p">)</span> <span class="p">{</span>
    <span class="nx">local</span><span class="p">.</span><span class="nx">xxx</span> <span class="o">=</span> <span class="p">...;</span>
<span class="p">}</span>
</pre></div>
</div>
<p >In Odoo web, modules are declared as functions set on the global <code >openerp</code>
variable. The function's name must be the same as the addon (in this case
<code >oepetstore</code>) so the framework can find it, and automatically initialize it.</p><p >When the web client loads your module it will call the root function
and provide two parameters:</p><ul ><li >the first parameter is the current instance of the Odoo web client, it gives
access to various capabilities defined by the Odoo (translations,
network services) as well as objects defined by the core or by other
modules.</li><li >the second parameter is your own local namespace automatically created by
the web client. Objects and variables which should be accessible from
outside your module (either because the Odoo web client needs to call them
or because others may want to customize them) should be set inside that
namespace.</li></ul></section><section id="classes"><h2 >类</h2><p >Much as modules, and contrary to most object-oriented languages, javascript
does not build in <em >classes</em><a href="#id4" class="footnote-ref" id="id1">1</a> although it provides roughly
equivalent (if lower-level and more verbose) mechanisms.</p><p >为了简单和开发人员友好Odoo网络提供了基于约翰Resig的'简单的JavaScript Inheritance`_班制度。</p><p >New classes are defined by calling the <code class="js-func xref js">extend()</code>
method of <code class="js-class xref js">openerp.web.Class()</code>:</p><div class="highlight-javascript"><div class="highlight"><pre><span class="kd">var</span> <span class="nx">MyClass</span> <span class="o">=</span> <span class="nx">instance</span><span class="p">.</span><span class="nx">web</span><span class="p">.</span><span class="nx">Class</span><span class="p">.</span><span class="nx">extend</span><span class="p">({</span>
    <span class="nx">say_hello</span><span class="o">:</span> <span class="kd">function</span><span class="p">()</span> <span class="p">{</span>
        <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="s2">&quot;hello&quot;</span><span class="p">);</span>
    <span class="p">},</span>
<span class="p">});</span>
</pre></div>
</div>
<p >The <code class="js-func xref js">extend()</code> method takes a dictionary describing
the new class's content (methods and static attributes). In this case, it will
only have a <code >say_hello</code> method which takes no parameters.</p><p >Classes are instantiated using the <code >new</code> operator:</p><div class="highlight-javascript"><div class="highlight"><pre><span class="kd">var</span> <span class="nx">my_object</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">MyClass</span><span class="p">();</span>
<span class="nx">my_object</span><span class="p">.</span><span class="nx">say_hello</span><span class="p">();</span>
<span class="c1">// print &quot;hello&quot; in the console</span>
</pre></div>
</div>
<p >And attributes of the instance can be accessed via <code >this</code>:</p><div class="highlight-javascript"><div class="highlight"><pre><span class="kd">var</span> <span class="nx">MyClass</span> <span class="o">=</span> <span class="nx">instance</span><span class="p">.</span><span class="nx">web</span><span class="p">.</span><span class="nx">Class</span><span class="p">.</span><span class="nx">extend</span><span class="p">({</span>
    <span class="nx">say_hello</span><span class="o">:</span> <span class="kd">function</span><span class="p">()</span> <span class="p">{</span>
        <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="s2">&quot;hello&quot;</span><span class="p">,</span> <span class="k">this</span><span class="p">.</span><span class="nx">name</span><span class="p">);</span>
    <span class="p">},</span>
<span class="p">});</span>

<span class="kd">var</span> <span class="nx">my_object</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">MyClass</span><span class="p">();</span>
<span class="nx">my_object</span><span class="p">.</span><span class="nx">name</span> <span class="o">=</span> <span class="s2">&quot;Bob&quot;</span><span class="p">;</span>
<span class="nx">my_object</span><span class="p">.</span><span class="nx">say_hello</span><span class="p">();</span>
<span class="c1">// print &quot;hello Bob&quot; in the console</span>
</pre></div>
</div>
<p >Classes can provide an initializer to perform the initial setup of the
instance, by defining an <code >init()</code> method. The initializer receives the
parameters passed when using the <code >new</code> operator:</p><div class="highlight-javascript"><div class="highlight"><pre><span class="kd">var</span> <span class="nx">MyClass</span> <span class="o">=</span> <span class="nx">instance</span><span class="p">.</span><span class="nx">web</span><span class="p">.</span><span class="nx">Class</span><span class="p">.</span><span class="nx">extend</span><span class="p">({</span>
    <span class="nx">init</span><span class="o">:</span> <span class="kd">function</span><span class="p">(</span><span class="nx">name</span><span class="p">)</span> <span class="p">{</span>
        <span class="k">this</span><span class="p">.</span><span class="nx">name</span> <span class="o">=</span> <span class="nx">name</span><span class="p">;</span>
    <span class="p">},</span>
    <span class="nx">say_hello</span><span class="o">:</span> <span class="kd">function</span><span class="p">()</span> <span class="p">{</span>
        <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="s2">&quot;hello&quot;</span><span class="p">,</span> <span class="k">this</span><span class="p">.</span><span class="nx">name</span><span class="p">);</span>
    <span class="p">},</span>
<span class="p">});</span>

<span class="kd">var</span> <span class="nx">my_object</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">MyClass</span><span class="p">(</span><span class="s2">&quot;Bob&quot;</span><span class="p">);</span>
<span class="nx">my_object</span><span class="p">.</span><span class="nx">say_hello</span><span class="p">();</span>
<span class="c1">// print &quot;hello Bob&quot; in the console</span>
</pre></div>
</div>
<p >It is also possible to create subclasses from existing (used-defined) classes
by calling <code class="js-func xref js">extend()</code> on the parent class, as is done
to subclass <code class="js-class xref js">Class()</code>:</p><div class="highlight-javascript"><div class="highlight"><pre><span class="kd">var</span> <span class="nx">MySpanishClass</span> <span class="o">=</span> <span class="nx">MyClass</span><span class="p">.</span><span class="nx">extend</span><span class="p">({</span>
    <span class="nx">say_hello</span><span class="o">:</span> <span class="kd">function</span><span class="p">()</span> <span class="p">{</span>
        <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="s2">&quot;hola&quot;</span><span class="p">,</span> <span class="k">this</span><span class="p">.</span><span class="nx">name</span><span class="p">);</span>
    <span class="p">},</span>
<span class="p">});</span>

<span class="kd">var</span> <span class="nx">my_object</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">MySpanishClass</span><span class="p">(</span><span class="s2">&quot;Bob&quot;</span><span class="p">);</span>
<span class="nx">my_object</span><span class="p">.</span><span class="nx">say_hello</span><span class="p">();</span>
<span class="c1">// print &quot;hola Bob&quot; in the console</span>
</pre></div>
</div>
<p >When overriding a method using inheritance, you can use <code >this._super()</code> to
call the original method:</p><div class="highlight-javascript"><div class="highlight"><pre><span class="kd">var</span> <span class="nx">MySpanishClass</span> <span class="o">=</span> <span class="nx">MyClass</span><span class="p">.</span><span class="nx">extend</span><span class="p">({</span>
    <span class="nx">say_hello</span><span class="o">:</span> <span class="kd">function</span><span class="p">()</span> <span class="p">{</span>
        <span class="k">this</span><span class="p">.</span><span class="nx">_super</span><span class="p">();</span>
        <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="s2">&quot;translation in Spanish: hola&quot;</span><span class="p">,</span> <span class="k">this</span><span class="p">.</span><span class="nx">name</span><span class="p">);</span>
    <span class="p">},</span>
<span class="p">});</span>

<span class="kd">var</span> <span class="nx">my_object</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">MySpanishClass</span><span class="p">(</span><span class="s2">&quot;Bob&quot;</span><span class="p">);</span>
<span class="nx">my_object</span><span class="p">.</span><span class="nx">say_hello</span><span class="p">();</span>
<span class="c1">// print &quot;hello Bob \n translation in Spanish: hola Bob&quot; in the console</span>
</pre></div>
</div>
<div role="alert" class="alert-warning alert"><p class="alert-title">警告</p><p ><code >_super</code> is not a standard method, it is set on-the-fly to the next
method in the current inheritance chain, if any. It is only defined
during the <em >synchronous</em> part of a method call, for use in asynchronous
handlers (after network calls or in <code >setTimeout</code> callbacks) a reference
to its value should be retained, it should not be accessed via <code >this</code>:</p><div class="highlight-javascript"><div class="highlight"><pre><span class="c1">// broken, will generate an error</span>
<span class="nx">say_hello</span><span class="o">:</span> <span class="kd">function</span> <span class="p">()</span> <span class="p">{</span>
    <span class="nx">setTimeout</span><span class="p">(</span><span class="kd">function</span> <span class="p">()</span> <span class="p">{</span>
        <span class="k">this</span><span class="p">.</span><span class="nx">_super</span><span class="p">();</span>
    <span class="p">}.</span><span class="nx">bind</span><span class="p">(</span><span class="k">this</span><span class="p">),</span> <span class="mi">0</span><span class="p">);</span>
<span class="p">}</span>

<span class="c1">// correct</span>
<span class="nx">say_hello</span><span class="o">:</span> <span class="kd">function</span> <span class="p">()</span> <span class="p">{</span>
    <span class="c1">// don&#39;t forget .bind()</span>
    <span class="kd">var</span> <span class="nx">_super</span> <span class="o">=</span> <span class="k">this</span><span class="p">.</span><span class="nx">_super</span><span class="p">.</span><span class="nx">bind</span><span class="p">(</span><span class="k">this</span><span class="p">);</span>
    <span class="nx">setTimeout</span><span class="p">(</span><span class="kd">function</span> <span class="p">()</span> <span class="p">{</span>
        <span class="nx">_super</span><span class="p">();</span>
    <span class="p">}.</span><span class="nx">bind</span><span class="p">(</span><span class="k">this</span><span class="p">),</span> <span class="mi">0</span><span class="p">);</span>
<span class="p">}</span>
</pre></div>
</div>
</div></section><section id="widgets-basics"><h2 >挂件基础</h2><p >该Odoo <a href="http://jquery.org" class="external reference">Web客户端捆绑jQuery</a>，方便DOM操作。它是有用的，并提供了比标准'W3C更好的API DOM` _ [#dombugs] _，但不足以构建复杂的应用程序，导致维护困难。</p><p >Much like object-oriented desktop UI toolkits (e.g. <a href="http://qt-project.org" class="external reference">Qt</a>, <a href="https://developer.apple.com/technologies/mac/cocoa.html" class="external reference">Cocoa</a> or <a href="http://www.gtk.org" class="external reference">GTK</a>),
Odoo Web makes specific components responsible for sections of a page. In
Odoo web, the base for such components is the <code class="js-class xref js">Widget()</code>
class, a component specialized in handling a page section and displaying
information for the user.</p></section><section id="your-first-widget"><h3 >你的第一个挂件</h3><p >The initial demonstration module already provides a basic widget:</p><div class="highlight-javascript"><div class="highlight"><pre><span class="nx">local</span><span class="p">.</span><span class="nx">HomePage</span> <span class="o">=</span> <span class="nx">instance</span><span class="p">.</span><span class="nx">Widget</span><span class="p">.</span><span class="nx">extend</span><span class="p">({</span>
    <span class="nx">start</span><span class="o">:</span> <span class="kd">function</span><span class="p">()</span> <span class="p">{</span>
        <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="s2">&quot;pet store home page loaded&quot;</span><span class="p">);</span>
    <span class="p">},</span>
<span class="p">});</span>
</pre></div>
</div>
<p >It extends <code class="js-class xref js">Widget()</code> and overrides the standard method
<code class="js-func xref js">start()</code>, which — much like the previous <code >MyClass</code>
— does little for now.</p><p >This line at the end of the file:</p><div class="highlight-javascript"><div class="highlight"><pre><span class="nx">instance</span><span class="p">.</span><span class="nx">web</span><span class="p">.</span><span class="nx">client_actions</span><span class="p">.</span><span class="nx">add</span><span class="p">(</span>
    <span class="s1">&#39;petstore.homepage&#39;</span><span class="p">,</span> <span class="s1">&#39;instance.oepetstore.HomePage&#39;</span><span class="p">);</span>
</pre></div>
</div>
<p >registers our basic widget as a client action. Client actions will be
explained later, for now this is just what allows our widget to
be called and displayed when we select the
<span class="menuselection">Pet Store ‣ Pet Store ‣ Home Page</span> menu.</p><div role="alert" class="alert-warning alert"><p class="alert-title">警告</p><p >because the widget will be called from outside our module, the web client
needs its &quot;fully qualified&quot; name, not the local version.</p></div></section><section id="display-content"><h3 >显示内容</h3><p >Widgets have a number of methods and features, but the basics are simple:</p><ul ><li ><p >成立了一个小部件</p></li><li ><p >格式化挂件的数据</p></li><li ><p >显示部件</p></li></ul><p >The <code >HomePage</code> widget already has a <code class="js-func xref js">start()</code>
method. That method is part of the normal widget lifecycle and automatically
called once the widget is inserted in the page. We can use it to display some
content.</p><p >All widgets have a <code class="js-attr xref js">$el</code> which represents the
section of page they're in charge of (as a <a href="http://jquery.org" class="external reference">jQuery</a> object). Widget content
should be inserted there. By default, <code class="js-attr xref js">$el</code> is an
empty <code >&lt;div&gt;</code> element.</p><p >A <code >&lt;div&gt;</code> element is usually invisible to the user if it has no content (or
without specific styles giving it a size) which is why nothing is displayed
on the page when <code >HomePage</code> is launched.</p><p >Let's add some content to the widget's root element, using jQuery:</p><div class="highlight-javascript"><div class="highlight"><pre><span class="nx">local</span><span class="p">.</span><span class="nx">HomePage</span> <span class="o">=</span> <span class="nx">instance</span><span class="p">.</span><span class="nx">Widget</span><span class="p">.</span><span class="nx">extend</span><span class="p">({</span>
    <span class="nx">start</span><span class="o">:</span> <span class="kd">function</span><span class="p">()</span> <span class="p">{</span>
        <span class="k">this</span><span class="p">.</span><span class="nx">$el</span><span class="p">.</span><span class="nx">append</span><span class="p">(</span><span class="s2">&quot;&lt;div&gt;Hello dear Odoo user!&lt;/div&gt;&quot;</span><span class="p">);</span>
    <span class="p">},</span>
<span class="p">});</span>
</pre></div>
</div>
<p >That message will now appear when you open <span class="menuselection">Pet Store
‣ Pet Store ‣ Home Page</span></p><div role="alert" class="alert-info alert"><p class="alert-title">注解</p><p >刷新Odoo网页加载JavaScript代码，您需要重新加载页面。没有必要重新启动Odoo服务器。</p></div><p >The <code >HomePage</code> widget is used by Odoo Web and managed automatically.
To learn how to use a widget &quot;from scratch&quot; let's create a new one:</p><div class="highlight-javascript"><div class="highlight"><pre><span class="nx">local</span><span class="p">.</span><span class="nx">GreetingsWidget</span> <span class="o">=</span> <span class="nx">instance</span><span class="p">.</span><span class="nx">Widget</span><span class="p">.</span><span class="nx">extend</span><span class="p">({</span>
    <span class="nx">start</span><span class="o">:</span> <span class="kd">function</span><span class="p">()</span> <span class="p">{</span>
        <span class="k">this</span><span class="p">.</span><span class="nx">$el</span><span class="p">.</span><span class="nx">append</span><span class="p">(</span><span class="s2">&quot;&lt;div&gt;We are so happy to see you again in this menu!&lt;/div&gt;&quot;</span><span class="p">);</span>
    <span class="p">},</span>
<span class="p">});</span>
</pre></div>
</div>
<p >We can now add our <code >GreetingsWidget</code> to the <code >HomePage</code> by using the
<code >GreetingsWidget</code>'s <code class="js-func xref js">appendTo()</code> method:</p><div class="highlight-javascript"><div class="highlight"><pre><span class="nx">local</span><span class="p">.</span><span class="nx">HomePage</span> <span class="o">=</span> <span class="nx">instance</span><span class="p">.</span><span class="nx">Widget</span><span class="p">.</span><span class="nx">extend</span><span class="p">({</span>
    <span class="nx">start</span><span class="o">:</span> <span class="kd">function</span><span class="p">()</span> <span class="p">{</span>
        <span class="k">this</span><span class="p">.</span><span class="nx">$el</span><span class="p">.</span><span class="nx">append</span><span class="p">(</span><span class="s2">&quot;&lt;div&gt;Hello dear Odoo user!&lt;/div&gt;&quot;</span><span class="p">);</span>
        <span class="kd">var</span> <span class="nx">greeting</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">local</span><span class="p">.</span><span class="nx">GreetingsWidget</span><span class="p">(</span><span class="k">this</span><span class="p">);</span>
        <span class="k">return</span> <span class="nx">greeting</span><span class="p">.</span><span class="nx">appendTo</span><span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">$el</span><span class="p">);</span>
    <span class="p">},</span>
<span class="p">});</span>
</pre></div>
</div>
<ul ><li ><p >[UNKNOWN NODE problematic]HomePage``第一添加自己的内容，它的DOM根</p></li><li ><p ><code >HomePage``然后实例``GreetingsWidget</code></p></li><li >Finally it tells <code >GreetingsWidget</code> where to insert itself, delegating part
of its <code class="js-attr xref js">$el</code> to the <code >GreetingsWidget</code>.</li></ul><p >When the <code class="js-func xref js">appendTo()</code> method is called, it asks the
widget to insert itself at the specified position and to display its content.
The <code class="js-func xref js">start()</code> method will be called during the call
to <code class="js-func xref js">appendTo()</code>.</p><p >To see what happens under the displayed interface, we will use the browser's
DOM Explorer. But first let's alter our widgets slightly so we can more easily
find where they are, by <code class="js-attr xref js">adding a class to their root elements</code>:</p><div class="highlight-javascript"><div class="highlight"><pre><span class="nx">local</span><span class="p">.</span><span class="nx">HomePage</span> <span class="o">=</span> <span class="nx">instance</span><span class="p">.</span><span class="nx">Widget</span><span class="p">.</span><span class="nx">extend</span><span class="p">({</span>
    <span class="nx">className</span><span class="o">:</span> <span class="s1">&#39;oe_petstore_homepage&#39;</span><span class="p">,</span>
    <span class="p">...</span>
<span class="p">});</span>
<span class="nx">local</span><span class="p">.</span><span class="nx">GreetingsWidget</span> <span class="o">=</span> <span class="nx">instance</span><span class="p">.</span><span class="nx">Widget</span><span class="p">.</span><span class="nx">extend</span><span class="p">({</span>
    <span class="nx">className</span><span class="o">:</span> <span class="s1">&#39;oe_petstore_greetings&#39;</span><span class="p">,</span>
    <span class="p">...</span>
<span class="p">});</span>
</pre></div>
</div>
<p >If you can find the relevant section of the DOM (right-click on the text
then <span class="guilabel">Inspect Element</span>), it should look like this:</p><div class="highlight-html"><div class="highlight"><pre><span class="nt">&lt;div</span> <span class="na">class=</span><span class="s">&quot;oe_petstore_homepage&quot;</span><span class="nt">&gt;</span>
    <span class="nt">&lt;div&gt;</span>Hello dear Odoo user!<span class="nt">&lt;/div&gt;</span>
    <span class="nt">&lt;div</span> <span class="na">class=</span><span class="s">&quot;oe_petstore_greetings&quot;</span><span class="nt">&gt;</span>
        <span class="nt">&lt;div&gt;</span>We are so happy to see you again in this menu!<span class="nt">&lt;/div&gt;</span>
    <span class="nt">&lt;/div&gt;</span>
<span class="nt">&lt;/div&gt;</span>
</pre></div>
</div>
<p >Which clearly shows the two <code >&lt;div&gt;</code> elements automatically created by
<code class="js-class xref js">Widget()</code>, because we added some classes on them.</p><p >我们也可以看到我们增加了自己的两个消息，控股的div</p><p >Finally, note the <code >&lt;div class=&quot;oe_petstore_greetings&quot;&gt;</code> element which
represents the <code >GreetingsWidget</code> instance is <em >inside</em> the
<code >&lt;div class=&quot;oe_petstore_homepage&quot;&gt;</code> which represents the <code >HomePage</code>
instance, since we appended</p></section><section id="widget-parents-and-children"><h3 >Widget Parents and Children</h3><p >In the previous part, we instantiated a widget using this syntax:</p><div class="highlight-javascript"><div class="highlight"><pre><span class="k">new</span> <span class="nx">local</span><span class="p">.</span><span class="nx">GreetingsWidget</span><span class="p">(</span><span class="k">this</span><span class="p">);</span>
</pre></div>
</div>
<p >The first argument is <code >this</code>, which in that case was a <code >HomePage</code>
instance. This tells the widget being created which other widget is its
<em >parent</em>.</p><p >As we've seen, widgets are usually inserted in the DOM by another widget and
<em >inside</em> that other widget's root element. This means most widgets are &quot;part&quot;
of another widget, and exist on behalf of it. We call the container the
<em >parent</em>, and the contained widget the <em >child</em>.</p><p >由于多个技术和概念的原因，有必要对一个插件知道谁是它的父和谁是其子女。</p><dl ><dt ><code class="js-func xref js">getParent()</code></dt><dd ><p >can be used to get the parent of a widget:</p><div class="highlight-javascript"><div class="highlight"><pre><span class="nx">local</span><span class="p">.</span><span class="nx">GreetingsWidget</span> <span class="o">=</span> <span class="nx">instance</span><span class="p">.</span><span class="nx">Widget</span><span class="p">.</span><span class="nx">extend</span><span class="p">({</span>
    <span class="nx">start</span><span class="o">:</span> <span class="kd">function</span><span class="p">()</span> <span class="p">{</span>
        <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">getParent</span><span class="p">().</span><span class="nx">$el</span> <span class="p">);</span>
        <span class="c1">// will print &quot;div.oe_petstore_homepage&quot; in the console</span>
    <span class="p">},</span>
<span class="p">});</span>
</pre></div>
</div>
</dd><dt ><code class="js-func xref js">getChildren()</code></dt><dd ><p >can be used to get a list of its children:</p><div class="highlight-javascript"><div class="highlight"><pre><span class="nx">local</span><span class="p">.</span><span class="nx">HomePage</span> <span class="o">=</span> <span class="nx">instance</span><span class="p">.</span><span class="nx">Widget</span><span class="p">.</span><span class="nx">extend</span><span class="p">({</span>
    <span class="nx">start</span><span class="o">:</span> <span class="kd">function</span><span class="p">()</span> <span class="p">{</span>
        <span class="kd">var</span> <span class="nx">greeting</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">local</span><span class="p">.</span><span class="nx">GreetingsWidget</span><span class="p">(</span><span class="k">this</span><span class="p">);</span>
        <span class="nx">greeting</span><span class="p">.</span><span class="nx">appendTo</span><span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">$el</span><span class="p">);</span>
        <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">getChildren</span><span class="p">()[</span><span class="mi">0</span><span class="p">].</span><span class="nx">$el</span><span class="p">);</span>
        <span class="c1">// will print &quot;div.oe_petstore_greetings&quot; in the console</span>
    <span class="p">},</span>
<span class="p">});</span>
</pre></div>
</div>
</dd></dl><p >When overriding the <code class="js-func xref js">init()</code> method of a widget it is
<em >of the utmost importance</em> to pass the parent to the <code >this._super()</code> call,
otherwise the relation will not be set up correctly:</p><div class="highlight-javascript"><div class="highlight"><pre><span class="nx">local</span><span class="p">.</span><span class="nx">GreetingsWidget</span> <span class="o">=</span> <span class="nx">instance</span><span class="p">.</span><span class="nx">Widget</span><span class="p">.</span><span class="nx">extend</span><span class="p">({</span>
    <span class="nx">init</span><span class="o">:</span> <span class="kd">function</span><span class="p">(</span><span class="nx">parent</span><span class="p">,</span> <span class="nx">name</span><span class="p">)</span> <span class="p">{</span>
        <span class="k">this</span><span class="p">.</span><span class="nx">_super</span><span class="p">(</span><span class="nx">parent</span><span class="p">);</span>
        <span class="k">this</span><span class="p">.</span><span class="nx">name</span> <span class="o">=</span> <span class="nx">name</span><span class="p">;</span>
    <span class="p">},</span>
<span class="p">});</span>
</pre></div>
</div>
<p >Finally, if a widget does not have a parent (e.g. because it's the root
widget of the application), <code >null</code> can be provided as parent:</p><div class="highlight-javascript"><div class="highlight"><pre><span class="k">new</span> <span class="nx">local</span><span class="p">.</span><span class="nx">GreetingsWidget</span><span class="p">(</span><span class="kc">null</span><span class="p">);</span>
</pre></div>
</div>
</section><section id="destroying-widgets"><h3 >销毁挂件</h3><p >If you can display content to your users, you should also be able to erase
it. This is done via the <code class="js-func xref js">destroy()</code> method:</p><div class="highlight-javascript"><div class="highlight"><pre><span class="nx">greeting</span><span class="p">.</span><span class="nx">destroy</span><span class="p">();</span>
</pre></div>
</div>
<p >When a widget is destroyed it will first call
<code class="js-func xref js">destroy()</code> on all its children. Then it erases itself
from the DOM. If you have set up permanent structures in
<code class="js-func xref js">init()</code> or <code class="js-func xref js">start()</code> which
must be explicitly cleaned up (because the garbage collector will not handle
them), you can override <code class="js-func xref js">destroy()</code>.</p><div role="alert" class="alert-danger alert"><p class="alert-title">危险</p><p >when overriding <code class="js-func xref js">destroy()</code>, <code >_super()</code>
<em >must always</em> be called otherwise the widget and its children are not
correctly cleaned up leaving possible memory leaks and &quot;phantom events&quot;,
even if no error is displayed</p></div></section><section id="the-qweb-template-engine"><h2 >QWeb模板引擎</h2><p >In the previous section we added content to our widgets by directly
manipulating (and adding to) their DOM:</p><div class="highlight-javascript"><div class="highlight"><pre><span class="k">this</span><span class="p">.</span><span class="nx">$el</span><span class="p">.</span><span class="nx">append</span><span class="p">(</span><span class="s2">&quot;&lt;div&gt;Hello dear Odoo user!&lt;/div&gt;&quot;</span><span class="p">);</span>
</pre></div>
</div>
<p >This allows generating and displaying any type of content, but gets unwieldy
when generating significant amounts of DOM (lots of duplication, quoting
issues, ...)</p><p >As many other environments, Odoo's solution is to use a <a href="http://en.wikipedia.org/wiki/Web_template_system" class="external reference">template engine</a>.
Odoo's template engine is called <a href="../reference/qweb.html#reference-qweb" class="internal reference"><span >QWeb</span></a>.</p><p >QWeb is an XML-based templating language, similar to <a href="http://en.wikipedia.org/wiki/Genshi_(templating_language)" class="external reference">Genshi</a>, <a href="http://en.wikipedia.org/wiki/Thymeleaf" class="external reference">Thymeleaf</a> or <a href="http://en.wikipedia.org/wiki/Facelets" class="external reference">Facelets</a>. It has the following
characteristics:</p><ul ><li ><p >它在JavaScript中全面实施，并在浏览器中呈现</p></li><li >Each template file (XML files) contains multiple templates</li><li >It has special support in Odoo Web's <code class="js-class xref js">Widget()</code>, though it
can be used outside of Odoo's web client (and it's possible to use
<code class="js-class xref js">Widget()</code> without relying on QWeb)</li></ul><div role="alert" class="alert-info alert"><p class="alert-title">注解</p><p >The rationale behind using QWeb instead of existing javascript template
engines is the extensibility of pre-existing (third-party) templates, much
like Odoo <a href="../reference/views.html#reference-views" class="internal alert-link reference"><span >views</span></a>.</p><p >Most javascript template engines are text-based which precludes easy
structural extensibility where an XML-based templating engine can be
generically altered using e.g. XPath or CSS and a tree-alteration DSL (or
even just XSLT). This flexibility and extensibility is a core
characteristic of Odoo, and losing it was considered unacceptable.</p></div></section><section id="using-qweb"><h3 >使用QWeb</h3><p >First let's define a simple QWeb template in the almost-empty
<code >oepetstore/static/src/xml/petstore.xml</code> file:</p><div class="highlight-xml"><div class="highlight"><pre><span class="cp">&lt;?xml version=&quot;1.0&quot; encoding=&quot;UTF-8&quot;?&gt;</span>
<span class="nt">&lt;templates</span> <span class="na">xml:space=</span><span class="s">&quot;preserve&quot;</span><span class="nt">&gt;</span>
    <span class="nt">&lt;t</span> <span class="na">t-name=</span><span class="s">&quot;HomePageTemplate&quot;</span><span class="nt">&gt;</span>
        <span class="nt">&lt;div</span> <span class="na">style=</span><span class="s">&quot;background-color: red;&quot;</span><span class="nt">&gt;</span>This is some simple HTML<span class="nt">&lt;/div&gt;</span>
    <span class="nt">&lt;/t&gt;</span>
<span class="nt">&lt;/templates&gt;</span>
</pre></div>
</div>
<p >Now we can use this template inside of the <code >HomePage</code> widget. Using the
<code >QWeb</code> loader variable defined at the top of the page, we can call to the
template defined in the XML file:</p><div class="highlight-javascript"><div class="highlight"><pre><span class="nx">local</span><span class="p">.</span><span class="nx">HomePage</span> <span class="o">=</span> <span class="nx">instance</span><span class="p">.</span><span class="nx">Widget</span><span class="p">.</span><span class="nx">extend</span><span class="p">({</span>
    <span class="nx">start</span><span class="o">:</span> <span class="kd">function</span><span class="p">()</span> <span class="p">{</span>
        <span class="k">this</span><span class="p">.</span><span class="nx">$el</span><span class="p">.</span><span class="nx">append</span><span class="p">(</span><span class="nx">QWeb</span><span class="p">.</span><span class="nx">render</span><span class="p">(</span><span class="s2">&quot;HomePageTemplate&quot;</span><span class="p">));</span>
    <span class="p">},</span>
<span class="p">});</span>
</pre></div>
</div>
<p ><code class="js-func xref js">QWeb.render()</code> looks for the specified template, renders it to a string
and returns the result.</p><p >However, because <code class="js-class xref js">Widget()</code> has special integration for QWeb
the template can be set directly on the widget via its
<code class="js-attr xref js">template</code> attribute:</p><div class="highlight-javascript"><div class="highlight"><pre><span class="nx">local</span><span class="p">.</span><span class="nx">HomePage</span> <span class="o">=</span> <span class="nx">instance</span><span class="p">.</span><span class="nx">Widget</span><span class="p">.</span><span class="nx">extend</span><span class="p">({</span>
    <span class="nx">template</span><span class="o">:</span> <span class="s2">&quot;HomePageTemplate&quot;</span><span class="p">,</span>
    <span class="nx">start</span><span class="o">:</span> <span class="kd">function</span><span class="p">()</span> <span class="p">{</span>
        <span class="p">...</span>
    <span class="p">},</span>
<span class="p">});</span>
</pre></div>
</div>
<p >Although the result looks similar, there are two differences between these
usages:</p><ul ><li >with the second version, the template is rendered right before
<code class="js-func xref js">start()</code> is called</li><li >in the first version the template's content is added to the widget's root
element, whereas in the second version the template's root element is
directly <em >set as</em> the widget's root element. Which is why the &quot;greetings&quot;
sub-widget also gets a red background</li></ul><div role="alert" class="alert-warning alert"><p class="alert-title">警告</p><p >templates should have a single non-<code >t</code> root element, especially if
they're set as a widget's <code class="js-attr xref js">template</code>. If there are
multiple &quot;root elements&quot;, results are undefined (usually only the first
root element will be used and the others will be ignored)</p></div></section><section id="qweb-context"><h4 >QWeb上下文</h4><p >QWeb模板可以被给定的数据，并且可以包含基本的显示逻辑。</p><p >For explicit calls to <code class="js-func xref js">QWeb.render()</code>, the template data is passed as
second parameter:</p><div class="highlight-javascript"><div class="highlight"><pre><span class="nx">QWeb</span><span class="p">.</span><span class="nx">render</span><span class="p">(</span><span class="s2">&quot;HomePageTemplate&quot;</span><span class="p">,</span> <span class="p">{</span><span class="nx">name</span><span class="o">:</span> <span class="s2">&quot;Klaus&quot;</span><span class="p">});</span>
</pre></div>
</div>
<p >with the template modified to:</p><div class="highlight-xml"><div class="highlight"><pre><span class="nt">&lt;t</span> <span class="na">t-name=</span><span class="s">&quot;HomePageTemplate&quot;</span><span class="nt">&gt;</span>
    <span class="nt">&lt;div&gt;</span>Hello <span class="nt">&lt;t</span> <span class="na">t-esc=</span><span class="s">&quot;name&quot;</span><span class="nt">/&gt;&lt;/div&gt;</span>
<span class="nt">&lt;/t&gt;</span>
</pre></div>
</div>
<p >will result in:</p><div class="highlight-html"><div class="highlight"><pre><span class="nt">&lt;div&gt;</span>Hello Klaus<span class="nt">&lt;/div&gt;</span>
</pre></div>
</div>
<p >When using <code class="js-class xref js">Widget()</code>'s integration it is not possible to
provide additional data to the template. The template will be given a single
<code >widget</code> context variable, referencing the widget being rendered right
before <code class="js-func xref js">start()</code> is called (the widget's state will
essentially be that set up by <code class="js-func xref js">init()</code>):</p><div class="highlight-xml"><div class="highlight"><pre><span class="nt">&lt;t</span> <span class="na">t-name=</span><span class="s">&quot;HomePageTemplate&quot;</span><span class="nt">&gt;</span>
    <span class="nt">&lt;div&gt;</span>Hello <span class="nt">&lt;t</span> <span class="na">t-esc=</span><span class="s">&quot;widget.name&quot;</span><span class="nt">/&gt;&lt;/div&gt;</span>
<span class="nt">&lt;/t&gt;</span>
</pre></div>
</div>
<div class="highlight-javascript"><div class="highlight"><pre><span class="nx">local</span><span class="p">.</span><span class="nx">HomePage</span> <span class="o">=</span> <span class="nx">instance</span><span class="p">.</span><span class="nx">Widget</span><span class="p">.</span><span class="nx">extend</span><span class="p">({</span>
    <span class="nx">template</span><span class="o">:</span> <span class="s2">&quot;HomePageTemplate&quot;</span><span class="p">,</span>
    <span class="nx">init</span><span class="o">:</span> <span class="kd">function</span><span class="p">(</span><span class="nx">parent</span><span class="p">)</span> <span class="p">{</span>
        <span class="k">this</span><span class="p">.</span><span class="nx">_super</span><span class="p">(</span><span class="nx">parent</span><span class="p">);</span>
        <span class="k">this</span><span class="p">.</span><span class="nx">name</span> <span class="o">=</span> <span class="s2">&quot;Mordecai&quot;</span><span class="p">;</span>
    <span class="p">},</span>
    <span class="nx">start</span><span class="o">:</span> <span class="kd">function</span><span class="p">()</span> <span class="p">{</span>
    <span class="p">},</span>
<span class="p">});</span>
</pre></div>
</div>
<p >Result:</p><div class="highlight-html"><div class="highlight"><pre><span class="nt">&lt;div&gt;</span>Hello Mordecai<span class="nt">&lt;/div&gt;</span>
</pre></div>
</div>
</section><section id="template-declaration"><h4 >模板声明</h4><p >We've seen how to <em >render</em> QWeb templates, let's now see the syntax of
the templates themselves.</p><p >A QWeb template is composed of regular XML mixed with QWeb <em >directives</em>. A
QWeb directive is declared with XML attributes starting with <code >t-</code>.</p><p >The most basic directive is <code >t-name</code>, used to declare new templates in
a template file:</p><div class="highlight-xml"><div class="highlight"><pre><span class="nt">&lt;templates&gt;</span>
    <span class="nt">&lt;t</span> <span class="na">t-name=</span><span class="s">&quot;HomePageTemplate&quot;</span><span class="nt">&gt;</span>
        <span class="nt">&lt;div&gt;</span>This is some simple HTML<span class="nt">&lt;/div&gt;</span>
    <span class="nt">&lt;/t&gt;</span>
<span class="nt">&lt;/templates&gt;</span>
</pre></div>
</div>
<p ><code >t-name</code> takes the name of the template being defined, and declares that
it can be called using <code class="js-func xref js">QWeb.render()</code>. It can only be used at the
top-level of a template file.</p></section><section id="escaping"><h4 >Escaping</h4><p >The <code >t-esc</code> directive can be used to output text:</p><div class="highlight-xml"><div class="highlight"><pre><span class="nt">&lt;div&gt;</span>Hello <span class="nt">&lt;t</span> <span class="na">t-esc=</span><span class="s">&quot;name&quot;</span><span class="nt">/&gt;&lt;/div&gt;</span>
</pre></div>
</div>
<p >It takes a Javascript expression which is evaluated, the result of the
expression is then HTML-escaped and inserted in the document. Since it's an
expression it's possible to provide just a variable name as above, or a more
complex expression like a computation:</p><div class="highlight-xml"><div class="highlight"><pre><span class="nt">&lt;div&gt;&lt;t</span> <span class="na">t-esc=</span><span class="s">&quot;3+5&quot;</span><span class="nt">/&gt;&lt;/div&gt;</span>
</pre></div>
</div>
<p >or method calls:</p><div class="highlight-xml"><div class="highlight"><pre><span class="nt">&lt;div&gt;&lt;t</span> <span class="na">t-esc=</span><span class="s">&quot;name.toUpperCase()&quot;</span><span class="nt">/&gt;&lt;/div&gt;</span>
</pre></div>
</div>
</section><section id="outputting-html"><h4 >输出HTML</h4><p >为了要呈现在页面注入HTML，使用``t-raw``。像``t-esc``接受一个任意JavaScript表达式作为参数，但是它不执行HTML转义一步。</p><div class="highlight-xml"><div class="highlight"><pre><span class="nt">&lt;div&gt;&lt;t</span> <span class="na">t-raw=</span><span class="s">&quot;name.link(user_account)&quot;</span><span class="nt">/&gt;&lt;/div&gt;</span>
</pre></div>
</div>
<div role="alert" class="alert-danger alert"><p class="alert-title">危险</p><p ><code >t-raw</code> <em >must not</em> be used on any data which may contain non-escaped
user-provided content as this leads to <a href="http://en.wikipedia.org/wiki/Cross-site_scripting" class="external reference alert-link">cross-site scripting</a>
vulnerabilities</p></div></section><section id="conditionals"><h4 >条件语句</h4><p >QWeb can have conditional blocks using <code >t-if</code>. The directive takes an
arbitrary expression, if the expression is falsy (<code >false</code>, <code >null</code>, <code >0</code>
or an empty string) the whole block is suppressed, otherwise it is displayed.</p><div class="highlight-xml"><div class="highlight"><pre><span class="nt">&lt;div&gt;</span>
    <span class="nt">&lt;t</span> <span class="na">t-if=</span><span class="s">&quot;true == true&quot;</span><span class="nt">&gt;</span>
        true is true
    <span class="nt">&lt;/t&gt;</span>
    <span class="nt">&lt;t</span> <span class="na">t-if=</span><span class="s">&quot;true == false&quot;</span><span class="nt">&gt;</span>
        true is not true
    <span class="nt">&lt;/t&gt;</span>
<span class="nt">&lt;/div&gt;</span>
</pre></div>
</div>
<div role="alert" class="alert-info alert"><p class="alert-title">注解</p><p >QWeb doesn't have an &quot;else&quot; structure, use a second <code >t-if</code> with the
original condition inverted. You may want to store the condition in a
local variable if it's a complex or expensive expression.</p></div></section><section id="iteration"><h4 >迭代</h4><p >迭代一个列表，使用``t-foreach``和``t-as``。 [UNKNOWN NODE problematic]t-foreach``需要返回一个列表进行迭代的``t-as``表达式以一个变量名绑定到每个项目迭代中。</p><div class="highlight-xml"><div class="highlight"><pre><span class="nt">&lt;div&gt;</span>
    <span class="nt">&lt;t</span> <span class="na">t-foreach=</span><span class="s">&quot;names&quot;</span> <span class="na">t-as=</span><span class="s">&quot;name&quot;</span><span class="nt">&gt;</span>
        <span class="nt">&lt;div&gt;</span>
            Hello <span class="nt">&lt;t</span> <span class="na">t-esc=</span><span class="s">&quot;name&quot;</span><span class="nt">/&gt;</span>
        <span class="nt">&lt;/div&gt;</span>
    <span class="nt">&lt;/t&gt;</span>
<span class="nt">&lt;/div&gt;</span>
</pre></div>
</div>
<div role="alert" class="alert-info alert"><p class="alert-title">注解</p><p ><code >t-foreach</code> can also be used with numbers and objects
(dictionaries)</p></div></section><section id="defining-attributes"><h4 >定义属性</h4><p >QWeb provides two related directives to define computed attributes:
<code class="samp">t-att-<em >name</em></code> and <code class="samp">t-attf-<em >name</em></code>. In either case, <em >name</em> is the
name of the attribute to create (e.g. <code >t-att-id</code> defines the attribute
<code >id</code> after rendering).</p><p ><code >t-att-</code> takes a javascript expression whose result is set as the
attribute's value, it is most useful if all of the attribute's value is
computed:</p><div class="highlight-xml"><div class="highlight"><pre><span class="nt">&lt;div&gt;</span>
    Input your name:
    <span class="nt">&lt;input</span> <span class="na">type=</span><span class="s">&quot;text&quot;</span> <span class="na">t-att-value=</span><span class="s">&quot;defaultName&quot;</span><span class="nt">/&gt;</span>
<span class="nt">&lt;/div&gt;</span>
</pre></div>
</div>
<p ><code >t-attf-</code> takes a <em >format string</em>. A format string is literal text with
interpolation blocks inside, an interpolation block is a javascript
expression between <code >{{</code> and <code >}}</code>, which will be replaced by the result
of the expression. It is most useful for attributes which are partially
literal and partially computed such as a class:</p><div class="highlight-xml"><div class="highlight"><pre><span class="nt">&lt;div</span> <span class="na">t-attf-class=</span><span class="s">&quot;container {{ left ? &#39;text-left&#39; : &#39;&#39; }} {{ extra_class }}&quot;</span><span class="nt">&gt;</span>
    insert content here
<span class="nt">&lt;/div&gt;</span>
</pre></div>
</div>
</section><section id="calling-other-templates"><h4 >调用其他模板</h4><p >Templates can be split into sub-templates (for simplicity, maintainability,
reusability or to avoid excessive markup nesting).</p><p >This is done using the <code >t-call</code> directive, which takes the name of the
template to render:</p><div class="highlight-xml"><div class="highlight"><pre><span class="nt">&lt;t</span> <span class="na">t-name=</span><span class="s">&quot;A&quot;</span><span class="nt">&gt;</span>
    <span class="nt">&lt;div</span> <span class="na">class=</span><span class="s">&quot;i-am-a&quot;</span><span class="nt">&gt;</span>
        <span class="nt">&lt;t</span> <span class="na">t-call=</span><span class="s">&quot;B&quot;</span><span class="nt">/&gt;</span>
    <span class="nt">&lt;/div&gt;</span>
<span class="nt">&lt;/t&gt;</span>
<span class="nt">&lt;t</span> <span class="na">t-name=</span><span class="s">&quot;B&quot;</span><span class="nt">&gt;</span>
    <span class="nt">&lt;div</span> <span class="na">class=</span><span class="s">&quot;i-am-b&quot;</span><span class="nt">/&gt;</span>
<span class="nt">&lt;/t&gt;</span>
</pre></div>
</div>
<p >rendering the <code >A</code> template will result in:</p><div class="highlight-xml"><div class="highlight"><pre><span class="nt">&lt;div</span> <span class="na">class=</span><span class="s">&quot;i-am-a&quot;</span><span class="nt">&gt;</span>
    <span class="nt">&lt;div</span> <span class="na">class=</span><span class="s">&quot;i-am-b&quot;</span><span class="nt">/&gt;</span>
<span class="nt">&lt;/div&gt;</span>
</pre></div>
</div>
<p >子模板继承其调用者的渲染上下文。</p></section><section id="to-learn-more-about-qweb"><h4 >要了解更多关于QWeb</h4><p >For a QWeb reference, see <a href="../reference/qweb.html#reference-qweb" class="internal reference"><span >QWeb</span></a>.</p></section><section id="exercise"><h4 >练习</h4><div role="alert" class="alert-exercise alert"><p class="alert-title">Exercise</p><p >QWeb的挂件的使用</p><p >Create a widget whose constructor takes two parameters aside from
<code >parent</code>: <code >product_names</code> and <code >color</code>.</p><ul ><li ><p >[UNKNOWN NODE problematic]product_names``应该字符串数组，一个产品的每一个名字</p></li><li ><code >color</code> is a string containing a color in CSS color format (ie:
<code >#000000</code> for black).</li></ul><p >小部件应显示给定的产品名称之一的，其他的，每一个与背景颜色的``color``和边界值单独的盒子。您应该使用QWeb呈现HTML。任何必要的CSS应该是``oepetstore /静态/ src目录/ CSS / petstore.css``。</p><p >使用Widget在``HomePage``半打的产品。</p></div></section><section id="widget-helpers"><h2 >挂件助手</h2></section><section id="widget-s-jquery-selector"><h3 >[UNKNOWN NODE problematic]Widget``的jQuery选择</h3><p >Selecting DOM elements within a widget can be performed by calling the
<code >find()</code> method on the widget's DOM root:</p><div class="highlight-javascript"><div class="highlight"><pre><span class="k">this</span><span class="p">.</span><span class="nx">$el</span><span class="p">.</span><span class="nx">find</span><span class="p">(</span><span class="s2">&quot;input.my_input&quot;</span><span class="p">)...</span>
</pre></div>
</div>
<p >But because it's a common operation, <code class="js-class xref js">Widget()</code> provides an
equivalent shortcut through the <code class="js-func xref js">$()</code> method:</p><div class="highlight-javascript"><div class="highlight"><pre><span class="nx">local</span><span class="p">.</span><span class="nx">MyWidget</span> <span class="o">=</span> <span class="nx">instance</span><span class="p">.</span><span class="nx">Widget</span><span class="p">.</span><span class="nx">extend</span><span class="p">({</span>
    <span class="nx">start</span><span class="o">:</span> <span class="kd">function</span><span class="p">()</span> <span class="p">{</span>
        <span class="k">this</span><span class="p">.</span><span class="nx">$</span><span class="p">(</span><span class="s2">&quot;input.my_input&quot;</span><span class="p">)...</span>
    <span class="p">},</span>
<span class="p">});</span>
</pre></div>
</div>
<div role="alert" class="alert-warning alert"><p class="alert-title">警告</p><p >The global jQuery function <code >$()</code> should <em >never</em> be used unless it is
absolutely necessary: selection on a widget's root are scoped to the
widget and local to it, but selections with <code >$()</code> are global to the
page/application and may match parts of other widgets and views, leading
to odd or dangerous side-effects. Since a widget should generally act
only on the DOM section it owns, there is no cause for global selection.</p></div></section><section id="easier-dom-events-binding"><h3 >更简单的DOM事件绑定</h3><p >We have previously bound DOM events using normal jQuery event handlers (e.g.
<code >.click()</code> or <code >.change()</code>) on widget elements:</p><div class="highlight-javascript"><div class="highlight"><pre><span class="nx">local</span><span class="p">.</span><span class="nx">MyWidget</span> <span class="o">=</span> <span class="nx">instance</span><span class="p">.</span><span class="nx">Widget</span><span class="p">.</span><span class="nx">extend</span><span class="p">({</span>
    <span class="nx">start</span><span class="o">:</span> <span class="kd">function</span><span class="p">()</span> <span class="p">{</span>
        <span class="kd">var</span> <span class="nx">self</span> <span class="o">=</span> <span class="k">this</span><span class="p">;</span>
        <span class="k">this</span><span class="p">.</span><span class="nx">$</span><span class="p">(</span><span class="s2">&quot;.my_button&quot;</span><span class="p">).</span><span class="nx">click</span><span class="p">(</span><span class="kd">function</span><span class="p">()</span> <span class="p">{</span>
            <span class="nx">self</span><span class="p">.</span><span class="nx">button_clicked</span><span class="p">();</span>
        <span class="p">});</span>
    <span class="p">},</span>
    <span class="nx">button_clicked</span><span class="o">:</span> <span class="kd">function</span><span class="p">()</span> <span class="p">{</span>
        <span class="p">..</span>
    <span class="p">},</span>
<span class="p">});</span>
</pre></div>
</div>
<p >While this works it has a few issues:</p><ol ><li ><p >这是相当冗长</p></li><li >it does not support replacing the widget's root element at runtime as
the binding is only performed when <code >start()</code> is run (during widget
initialization)</li><li ><p >它需要处理``this``结合问题</p></li></ol><p >Widgets thus provide a shortcut to DOM event binding via
<code class="js-attr xref js">events</code>:</p><div class="highlight-javascript"><div class="highlight"><pre><span class="nx">local</span><span class="p">.</span><span class="nx">MyWidget</span> <span class="o">=</span> <span class="nx">instance</span><span class="p">.</span><span class="nx">Widget</span><span class="p">.</span><span class="nx">extend</span><span class="p">({</span>
    <span class="nx">events</span><span class="o">:</span> <span class="p">{</span>
        <span class="s2">&quot;click .my_button&quot;</span><span class="o">:</span> <span class="s2">&quot;button_clicked&quot;</span><span class="p">,</span>
    <span class="p">},</span>
    <span class="nx">button_clicked</span><span class="o">:</span> <span class="kd">function</span><span class="p">()</span> <span class="p">{</span>
        <span class="p">..</span>
    <span class="p">}</span>
<span class="p">});</span>
</pre></div>
</div>
<p ><code class="js-attr xref js">events</code> is an object (mapping) of an event to the
function or method to call when the event is triggered:</p><ul ><li >the key is an event name, possibly refined with a CSS selector in which
case only if the event happens on a selected sub-element will the function
or method run: <code >click</code> will handle all clicks within the widget, but
<code >click .my_button</code> will only handle clicks in elements bearing the
<code >my_button</code> class</li><li ><p >该值执行操作时，该事件被触发</p><p >It can be either a function:</p><div class="highlight-javascript"><div class="highlight"><pre><span class="nx">events</span><span class="o">:</span> <span class="p">{</span>
    <span class="s1">&#39;click&#39;</span><span class="o">:</span> <span class="kd">function</span> <span class="p">(</span><span class="nx">e</span><span class="p">)</span> <span class="p">{</span> <span class="cm">/* code here */</span> <span class="p">}</span>
<span class="p">}</span>
</pre></div>
</div>
<p >or the name of a method on the object (see example above).</p><p >在两种情况下，[UNKNOWN NODE problematic]this``是小部件实例和处理程序被赋予一个参数，所述`的jQuery事件object`_为事件。</p></li></ul></section><section id="widget-events-and-properties"><h2 >挂件事件和属性</h2></section><section id="events"><h3 >活动</h3><p >Widgets provide an event system (separate from the DOM/jQuery event system
described above): a widget can fire events on itself, and other widgets (or
itself) can bind themselves and listen for these events:</p><div class="highlight-javascript"><div class="highlight"><pre><span class="nx">local</span><span class="p">.</span><span class="nx">ConfirmWidget</span> <span class="o">=</span> <span class="nx">instance</span><span class="p">.</span><span class="nx">Widget</span><span class="p">.</span><span class="nx">extend</span><span class="p">({</span>
    <span class="nx">events</span><span class="o">:</span> <span class="p">{</span>
        <span class="s1">&#39;click button.ok_button&#39;</span><span class="o">:</span> <span class="kd">function</span> <span class="p">()</span> <span class="p">{</span>
            <span class="k">this</span><span class="p">.</span><span class="nx">trigger</span><span class="p">(</span><span class="s1">&#39;user_chose&#39;</span><span class="p">,</span> <span class="kc">true</span><span class="p">);</span>
        <span class="p">},</span>
        <span class="s1">&#39;click button.cancel_button&#39;</span><span class="o">:</span> <span class="kd">function</span> <span class="p">()</span> <span class="p">{</span>
            <span class="k">this</span><span class="p">.</span><span class="nx">trigger</span><span class="p">(</span><span class="s1">&#39;user_chose&#39;</span><span class="p">,</span> <span class="kc">false</span><span class="p">);</span>
        <span class="p">}</span>
    <span class="p">},</span>
    <span class="nx">start</span><span class="o">:</span> <span class="kd">function</span><span class="p">()</span> <span class="p">{</span>
        <span class="k">this</span><span class="p">.</span><span class="nx">$el</span><span class="p">.</span><span class="nx">append</span><span class="p">(</span><span class="s2">&quot;&lt;div&gt;Are you sure you want to perform this action?&lt;/div&gt;&quot;</span> <span class="o">+</span>
            <span class="s2">&quot;&lt;button class=&#39;ok_button&#39;&gt;Ok&lt;/button&gt;&quot;</span> <span class="o">+</span>
            <span class="s2">&quot;&lt;button class=&#39;cancel_button&#39;&gt;Cancel&lt;/button&gt;&quot;</span><span class="p">);</span>
    <span class="p">},</span>
<span class="p">});</span>
</pre></div>
</div>
<p >This widget acts as a facade, transforming user input (through DOM events)
into a documentable internal event to which parent widgets can bind
themselves.</p><p ><code class="js-func xref js">trigger()</code> takes the name of the event to trigger as
its first (mandatory) argument, any further arguments are treated as event
data and passed directly to listeners.</p><p >We can then set up a parent event instantiating our generic widget and
listening to the <code >user_chose</code> event using <code class="js-func xref js">on()</code>:</p><div class="highlight-javascript"><div class="highlight"><pre><span class="nx">local</span><span class="p">.</span><span class="nx">HomePage</span> <span class="o">=</span> <span class="nx">instance</span><span class="p">.</span><span class="nx">Widget</span><span class="p">.</span><span class="nx">extend</span><span class="p">({</span>
    <span class="nx">start</span><span class="o">:</span> <span class="kd">function</span><span class="p">()</span> <span class="p">{</span>
        <span class="kd">var</span> <span class="nx">widget</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">local</span><span class="p">.</span><span class="nx">ConfirmWidget</span><span class="p">(</span><span class="k">this</span><span class="p">);</span>
        <span class="nx">widget</span><span class="p">.</span><span class="nx">on</span><span class="p">(</span><span class="s2">&quot;user_chose&quot;</span><span class="p">,</span> <span class="k">this</span><span class="p">,</span> <span class="k">this</span><span class="p">.</span><span class="nx">user_chose</span><span class="p">);</span>
        <span class="nx">widget</span><span class="p">.</span><span class="nx">appendTo</span><span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">$el</span><span class="p">);</span>
    <span class="p">},</span>
    <span class="nx">user_chose</span><span class="o">:</span> <span class="kd">function</span><span class="p">(</span><span class="nx">confirm</span><span class="p">)</span> <span class="p">{</span>
        <span class="k">if</span> <span class="p">(</span><span class="nx">confirm</span><span class="p">)</span> <span class="p">{</span>
            <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="s2">&quot;The user agreed to continue&quot;</span><span class="p">);</span>
        <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
            <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="s2">&quot;The user refused to continue&quot;</span><span class="p">);</span>
        <span class="p">}</span>
    <span class="p">},</span>
<span class="p">});</span>
</pre></div>
</div>
<p ><code class="js-func xref js">on()</code> binds a function to be called when the
event identified by <code >event_name</code> is. The <code >func</code> argument is the
function to call and <code >object</code> is the object to which that function is
related if it is a method. The bound function will be called with the
additional arguments of <code class="js-func xref js">trigger()</code> if it has
any. Example:</p><div class="highlight-javascript"><div class="highlight"><pre><span class="nx">start</span><span class="o">:</span> <span class="kd">function</span><span class="p">()</span> <span class="p">{</span>
    <span class="kd">var</span> <span class="nx">widget</span> <span class="o">=</span> <span class="p">...</span>
    <span class="nx">widget</span><span class="p">.</span><span class="nx">on</span><span class="p">(</span><span class="s2">&quot;my_event&quot;</span><span class="p">,</span> <span class="k">this</span><span class="p">,</span> <span class="k">this</span><span class="p">.</span><span class="nx">my_event_triggered</span><span class="p">);</span>
    <span class="nx">widget</span><span class="p">.</span><span class="nx">trigger</span><span class="p">(</span><span class="s2">&quot;my_event&quot;</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">3</span><span class="p">);</span>
<span class="p">},</span>
<span class="nx">my_event_triggered</span><span class="o">:</span> <span class="kd">function</span><span class="p">(</span><span class="nx">a</span><span class="p">,</span> <span class="nx">b</span><span class="p">,</span> <span class="nx">c</span><span class="p">)</span> <span class="p">{</span>
    <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="nx">a</span><span class="p">,</span> <span class="nx">b</span><span class="p">,</span> <span class="nx">c</span><span class="p">);</span>
    <span class="c1">// will print &quot;1 2 3&quot;</span>
<span class="p">}</span>
</pre></div>
</div>
<div role="alert" class="alert-info alert"><p class="alert-title">注解</p><p >上其他部件触发事件通常是一个坏主意。主要的例外情况的规则是``openerp.web.bus``它存在专门为广播埃文斯在其中的任何部件可能是整个Odoo Web应用程序感兴趣。</p></div></section><section id="properties"><h3 >性能</h3><p >Properties are very similar to normal object attributes in that they allow
storing data on a widget instance, however they have the additional feature
that they trigger events when set:</p><div class="highlight-javascript"><div class="highlight"><pre><span class="nx">start</span><span class="o">:</span> <span class="kd">function</span><span class="p">()</span> <span class="p">{</span>
    <span class="k">this</span><span class="p">.</span><span class="nx">widget</span> <span class="o">=</span> <span class="p">...</span>
    <span class="k">this</span><span class="p">.</span><span class="nx">widget</span><span class="p">.</span><span class="nx">on</span><span class="p">(</span><span class="s2">&quot;change:name&quot;</span><span class="p">,</span> <span class="k">this</span><span class="p">,</span> <span class="k">this</span><span class="p">.</span><span class="nx">name_changed</span><span class="p">);</span>
    <span class="k">this</span><span class="p">.</span><span class="nx">widget</span><span class="p">.</span><span class="nx">set</span><span class="p">(</span><span class="s2">&quot;name&quot;</span><span class="p">,</span> <span class="s2">&quot;Nicolas&quot;</span><span class="p">);</span>
<span class="p">},</span>
<span class="nx">name_changed</span><span class="o">:</span> <span class="kd">function</span><span class="p">()</span> <span class="p">{</span>
    <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="s2">&quot;The new value of the property &#39;name&#39; is&quot;</span><span class="p">,</span> <span class="k">this</span><span class="p">.</span><span class="nx">widget</span><span class="p">.</span><span class="nx">get</span><span class="p">(</span><span class="s2">&quot;name&quot;</span><span class="p">));</span>
<span class="p">}</span>
</pre></div>
</div>
<ul ><li ><code class="js-func xref js">set()</code> sets the value of a property and triggers
<code class="samp">change:<em >propname</em></code> (where <em >propname</em> is the property name passed as
first parameter to <code class="js-func xref js">set()</code>) and <code >change</code></li><li ><code class="js-func xref js">get()</code> retrieves the value of a property.</li></ul></section><section id="id3"><h3 >练习</h3><div role="alert" class="alert-exercise alert"><p class="alert-title">Exercise</p><p >控件属性和事件</p><p >Create a widget <code >ColorInputWidget</code> that will display 3 <code >&lt;input
type=&quot;text&quot;&gt;</code>. Each of these <code >&lt;input&gt;</code> is dedicated to type a
hexadecimal number from 00 to FF. When any of these <code >&lt;input&gt;</code> is
modified by the user the widget must query the content of the three
<code >&lt;input&gt;</code>, concatenate their values to have a complete CSS color code
(ie: <code >#00FF00</code>) and put the result in a property named <code >color</code>. Please
note the jQuery <code >change()</code> event that you can bind on any HTML
<code >&lt;input&gt;</code> element and the <code >val()</code> method that can query the current
value of that <code >&lt;input&gt;</code> could be useful to you for this exercise.</p><p >然后，修改``HomePage``构件实例``ColorInputWidget``并显示它。该``HomePage``挂件还应该显示一个空矩形。该矩形必须始终，在任何时刻，都有相同的背景色在``ColorInputWidget``实例的``color``属性的颜色。</p><p >使用QWeb生成所有的HTML。</p></div></section><section id="modify-existing-widgets-and-classes"><h2 >修改现有的小部件和类</h2><p >The class system of the Odoo web framework allows direct modification of
existing classes using the <code class="js-func xref js">include()</code> method:</p><div class="highlight-javascript"><div class="highlight"><pre><span class="kd">var</span> <span class="nx">TestClass</span> <span class="o">=</span> <span class="nx">instance</span><span class="p">.</span><span class="nx">web</span><span class="p">.</span><span class="nx">Class</span><span class="p">.</span><span class="nx">extend</span><span class="p">({</span>
    <span class="nx">testMethod</span><span class="o">:</span> <span class="kd">function</span><span class="p">()</span> <span class="p">{</span>
        <span class="k">return</span> <span class="s2">&quot;hello&quot;</span><span class="p">;</span>
    <span class="p">},</span>
<span class="p">});</span>

<span class="nx">TestClass</span><span class="p">.</span><span class="nx">include</span><span class="p">({</span>
    <span class="nx">testMethod</span><span class="o">:</span> <span class="kd">function</span><span class="p">()</span> <span class="p">{</span>
        <span class="k">return</span> <span class="k">this</span><span class="p">.</span><span class="nx">_super</span><span class="p">()</span> <span class="o">+</span> <span class="s2">&quot; world&quot;</span><span class="p">;</span>
    <span class="p">},</span>
<span class="p">});</span>

<span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="k">new</span> <span class="nx">TestClass</span><span class="p">().</span><span class="nx">testMethod</span><span class="p">());</span>
<span class="c1">// will print &quot;hello world&quot;</span>
</pre></div>
</div>
<p >这个系统类似于继承机制，但是它会改变创建一类新的在就地目标类代替。</p><p >In that case, <code >this._super()</code> will call the original implementation of a
method being replaced/redefined. If the class already had sub-classes, all
calls to <code >this._super()</code> in sub-classes will call the new implementations
defined in the call to <code class="js-func xref js">include()</code>. This will also work
if some instances of the class (or of any of its sub-classes) were created
prior to the call to <code class="js-func xref js">include()</code>.</p></section><section id="translations"><h2 >翻译</h2><p >The process to translate text in Python and JavaScript code is very
similar. You could have noticed these lines at the beginning of the
<code >petstore.js</code> file:</p><div class="highlight-javascript"><div class="highlight"><pre><span class="kd">var</span> <span class="nx">_t</span> <span class="o">=</span> <span class="nx">instance</span><span class="p">.</span><span class="nx">web</span><span class="p">.</span><span class="nx">_t</span><span class="p">,</span>
    <span class="nx">_lt</span> <span class="o">=</span> <span class="nx">instance</span><span class="p">.</span><span class="nx">web</span><span class="p">.</span><span class="nx">_lt</span><span class="p">;</span>
</pre></div>
</div>
<p >These lines are simply used to import the translation functions in the current
JavaScript module. They are used thus:</p><div class="highlight-javascript"><div class="highlight"><pre><span class="k">this</span><span class="p">.</span><span class="nx">$el</span><span class="p">.</span><span class="nx">text</span><span class="p">(</span><span class="nx">_t</span><span class="p">(</span><span class="s2">&quot;Hello user!&quot;</span><span class="p">));</span>
</pre></div>
</div>
<p >In Odoo, translations files are automatically generated by scanning the source
code. All piece of code that calls a certain function are detected and their
content is added to a translation file that will then be sent to the
translators. In Python, the function is <code >_()</code>. In JavaScript the function is
<code class="js-func xref js">_t()</code> (and also <code class="js-func xref js">_lt()</code>).</p><p ><code >_t()</code> will return the translation defined for the text it is given. If no
translation is defined for that text, it will return the original text as-is.</p><div role="alert" class="alert-info alert"><p class="alert-title">注解</p><p >To inject user-provided values in translatable strings, it is recommended
to use <a href="http://gabceb.github.io/underscore.string.site/#sprintf" class="external reference alert-link">_.str.sprintf</a> with named
arguments <em >after</em> the translation:</p><div class="highlight-javascript"><div class="highlight"><pre><span class="k">this</span><span class="p">.</span><span class="nx">$el</span><span class="p">.</span><span class="nx">text</span><span class="p">(</span><span class="nx">_</span><span class="p">.</span><span class="nx">str</span><span class="p">.</span><span class="nx">sprintf</span><span class="p">(</span>
    <span class="nx">_t</span><span class="p">(</span><span class="s2">&quot;Hello, %(user)s!&quot;</span><span class="p">),</span> <span class="p">{</span>
    <span class="nx">user</span><span class="o">:</span> <span class="s2">&quot;Ed&quot;</span>
<span class="p">}));</span>
</pre></div>
</div>
<p >这使得翻译字符串更具可读性翻译人员，并让他们更灵活地重新排序或忽略的参数。</p></div><p ><code class="js-func xref js">_lt()</code> (&quot;lazy translate&quot;) is similar but somewhat more
complex: instead of translating its parameter immediately, it returns
an object which, when converted to a string, will perform the translation.</p><p >It is used to define translatable terms before the translations system is
initialized, for class attributes for instance (as modules are loaded before
the user's language is configured and translations are downloaded).</p></section><section id="communication-with-the-odoo-server"><h2 >与Odoo服务器通信</h2></section><section id="contacting-models"><h3 >联系模型</h3><p >Most operations with Odoo involve communicating with <em >models</em> implementing
business concern, these models will then (potentially) interact with some
storage engine (usually <a href="http://en.wikipedia.org/wiki/PostgreSQL" class="external reference">PostgreSQL</a>).</p><p >Although <a href="http://jquery.org" class="external reference">jQuery</a> provides a <a href="http://api.jquery.com/jquery.ajax/" class="external reference">$.ajax</a> function for network interactions,
communicating with Odoo requires additional metadata whose setup before every
call would be verbose and error-prone. As a result, Odoo web provides
higher-level communication primitives.</p><p >To demonstrate this, the file <code >petstore.py</code> already contains a small model
with a sample method:</p><div class="highlight-python"><div class="highlight"><pre><span class="k">class</span> <span class="nc">message_of_the_day</span><span class="p">(</span><span class="n">models</span><span class="o">.</span><span class="n">Model</span><span class="p">):</span>
    <span class="n">_name</span> <span class="o">=</span> <span class="s">&quot;oepetstore.message_of_the_day&quot;</span>

    <span class="nd">@api.model</span>
    <span class="k">def</span> <span class="nf">my_method</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="p">{</span><span class="s">&quot;hello&quot;</span><span class="p">:</span> <span class="s">&quot;world&quot;</span><span class="p">}</span>

    <span class="n">message</span> <span class="o">=</span> <span class="n">fields</span><span class="o">.</span><span class="n">Text</span><span class="p">(),</span>
    <span class="n">color</span> <span class="o">=</span> <span class="n">fields</span><span class="o">.</span><span class="n">Char</span><span class="p">(</span><span class="n">size</span><span class="o">=</span><span class="mi">20</span><span class="p">),</span>
</pre></div>
</div>
<p >This declares a model with two fields, and a method <code >my_method()</code> which
returns a literal dictionary.</p><p >Here is a sample widget that calls <code >my_method()</code> and displays the result:</p><div class="highlight-javascript"><div class="highlight"><pre><span class="nx">local</span><span class="p">.</span><span class="nx">HomePage</span> <span class="o">=</span> <span class="nx">instance</span><span class="p">.</span><span class="nx">Widget</span><span class="p">.</span><span class="nx">extend</span><span class="p">({</span>
    <span class="nx">start</span><span class="o">:</span> <span class="kd">function</span><span class="p">()</span> <span class="p">{</span>
        <span class="kd">var</span> <span class="nx">self</span> <span class="o">=</span> <span class="k">this</span><span class="p">;</span>
        <span class="kd">var</span> <span class="nx">model</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">instance</span><span class="p">.</span><span class="nx">web</span><span class="p">.</span><span class="nx">Model</span><span class="p">(</span><span class="s2">&quot;oepetstore.message_of_the_day&quot;</span><span class="p">);</span>
        <span class="nx">model</span><span class="p">.</span><span class="nx">call</span><span class="p">(</span><span class="s2">&quot;my_method&quot;</span><span class="p">,</span> <span class="p">{</span><span class="nx">context</span><span class="o">:</span> <span class="k">new</span> <span class="nx">instance</span><span class="p">.</span><span class="nx">web</span><span class="p">.</span><span class="nx">CompoundContext</span><span class="p">()}).</span><span class="nx">then</span><span class="p">(</span><span class="kd">function</span><span class="p">(</span><span class="nx">result</span><span class="p">)</span> <span class="p">{</span>
            <span class="nx">self</span><span class="p">.</span><span class="nx">$el</span><span class="p">.</span><span class="nx">append</span><span class="p">(</span><span class="s2">&quot;&lt;div&gt;Hello &quot;</span> <span class="o">+</span> <span class="nx">result</span><span class="p">[</span><span class="s2">&quot;hello&quot;</span><span class="p">]</span> <span class="o">+</span> <span class="s2">&quot;&lt;/div&gt;&quot;</span><span class="p">);</span>
            <span class="c1">// will show &quot;Hello world&quot; to the user</span>
        <span class="p">});</span>
    <span class="p">},</span>
<span class="p">});</span>
</pre></div>
</div>
<p >The class used to call Odoo models is <code class="js-class xref js">openerp.Model()</code>. It is
instantiated with the Odoo model's name as first parameter
(<code >oepetstore.message_of_the_day</code> here).</p><p ><code class="js-func xref js">call()</code> can be used to call any (public) method of an
Odoo model. It takes the following positional arguments:</p><dl ><dt ><code >name</code></dt><dd ><p >该方法调用，[UNKNOWN NODE problematic]这里my_method``的名称</p></dd><dt ><code >args</code></dt><dd ><p >的`位置arguments`_阵列，以提供给该方法。因为示例具有没有位置参数来提供，不设置``args``参数。</p><p >Here is an other example with positional arguments:</p><div class="highlight-python"><div class="highlight"><pre><span class="nd">@api.model</span>
<span class="k">def</span> <span class="nf">my_method2</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">a</span><span class="p">,</span> <span class="n">b</span><span class="p">,</span> <span class="n">c</span><span class="p">):</span> <span class="o">...</span>
</pre></div>
</div>
<div class="highlight-javascript"><div class="highlight"><pre><span class="nx">model</span><span class="p">.</span><span class="nx">call</span><span class="p">(</span><span class="s2">&quot;my_method&quot;</span><span class="p">,</span> <span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">3</span><span class="p">],</span> <span class="p">...</span>
<span class="c1">// with this a=1, b=2 and c=3</span>
</pre></div>
</div>
</dd><dt ><code >kwargs</code></dt><dd ><p >的'关键字arguments`_映射通过。这个例子提供了一个单一命名参数``context``。</p><div class="highlight-python"><div class="highlight"><pre><span class="nd">@api.model</span>
<span class="k">def</span> <span class="nf">my_method2</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">a</span><span class="p">,</span> <span class="n">b</span><span class="p">,</span> <span class="n">c</span><span class="p">):</span> <span class="o">...</span>
</pre></div>
</div>
<div class="highlight-javascript"><div class="highlight"><pre><span class="nx">model</span><span class="p">.</span><span class="nx">call</span><span class="p">(</span><span class="s2">&quot;my_method&quot;</span><span class="p">,</span> <span class="p">[],</span> <span class="p">{</span><span class="nx">a</span><span class="o">:</span> <span class="mi">1</span><span class="p">,</span> <span class="nx">b</span><span class="o">:</span> <span class="mi">2</span><span class="p">,</span> <span class="nx">c</span><span class="o">:</span> <span class="mi">3</span><span class="p">,</span> <span class="p">...</span>
<span class="c1">// with this a=1, b=2 and c=3</span>
</pre></div>
</div>
</dd></dl><p ><code class="js-func xref js">call()</code> returns a deferred resolved with the value
returned by the model's method as first argument.</p></section><section id="compoundcontext"><h3 >CompoundContext</h3><p >The previous section used a <code >context</code> argument which was not explained in
the method call:</p><div class="highlight-javascript"><div class="highlight"><pre><span class="nx">model</span><span class="p">.</span><span class="nx">call</span><span class="p">(</span><span class="s2">&quot;my_method&quot;</span><span class="p">,</span> <span class="p">{</span><span class="nx">context</span><span class="o">:</span> <span class="k">new</span> <span class="nx">instance</span><span class="p">.</span><span class="nx">web</span><span class="p">.</span><span class="nx">CompoundContext</span><span class="p">()})</span>
</pre></div>
</div>
<p >The context is like a &quot;magic&quot; argument that the web client will always give to
the server when calling a method. The context is a dictionary containing
multiple keys. One of the most important key is the language of the user, used
by the server to translate all the messages of the application. Another one is
the time zone of the user, used to compute correctly dates and times if Odoo
is used by people in different countries.</p><p >The <code >argument</code> is necessary in all methods, otherwise bad things could
happen (such as the application not being translated correctly). That's why,
when you call a model's method, you should always provide that argument. The
solution to achieve that is to use <code class="js-class xref js">openerp.web.CompoundContext()</code>.</p><p ><code class="js-class xref js">CompoundContext()</code> is a class used to pass the user's
context (with language, time zone, etc...) to the server as well as adding new
keys to the context (some models' methods use arbitrary keys added to the
context). It is created by giving to its constructor any number of
dictionaries or other <code class="js-class xref js">CompoundContext()</code> instances. It will
merge all those contexts before sending them to the server.</p><div class="highlight-javascript"><div class="highlight"><pre><span class="nx">model</span><span class="p">.</span><span class="nx">call</span><span class="p">(</span><span class="s2">&quot;my_method&quot;</span><span class="p">,</span> <span class="p">{</span><span class="nx">context</span><span class="o">:</span> <span class="k">new</span> <span class="nx">instance</span><span class="p">.</span><span class="nx">web</span><span class="p">.</span><span class="nx">CompoundContext</span><span class="p">({</span><span class="s1">&#39;new_key&#39;</span><span class="o">:</span> <span class="s1">&#39;key_value&#39;</span><span class="p">})})</span>
</pre></div>
</div>
<div class="highlight-python"><div class="highlight"><pre><span class="nd">@api.model</span>
<span class="k">def</span> <span class="nf">my_method</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
    <span class="k">print</span> <span class="bp">self</span><span class="o">.</span><span class="n">env</span><span class="o">.</span><span class="n">context</span>
    <span class="o">//</span> <span class="n">will</span> <span class="k">print</span><span class="p">:</span> <span class="p">{</span><span class="s">&#39;lang&#39;</span><span class="p">:</span> <span class="s">&#39;en_US&#39;</span><span class="p">,</span> <span class="s">&#39;new_key&#39;</span><span class="p">:</span> <span class="s">&#39;key_value&#39;</span><span class="p">,</span> <span class="s">&#39;tz&#39;</span><span class="p">:</span> <span class="s">&#39;Europe/Brussels&#39;</span><span class="p">,</span> <span class="s">&#39;uid&#39;</span><span class="p">:</span> <span class="mi">1</span><span class="p">}</span>
</pre></div>
</div>
<p >You can see the dictionary in the argument <code >context</code> contains some keys that
are related to the configuration of the current user in Odoo plus the
<code >new_key</code> key that was added when instantiating
<code class="js-class xref js">CompoundContext()</code>.</p></section><section id="queries"><h3 >查询</h3><p >While <code class="js-func xref js">call()</code> is sufficient for any interaction with Odoo
models, Odoo Web provides a helper for simpler and clearer querying of models
(fetching of records based on various conditions):
<code class="js-func xref js">query()</code> which acts as a shortcut for the common
combination of <code class="py py-meth xref">search()</code> and
:<code class="py py-meth xref">read()</code>. It provides a clearer syntax to search
and read models:</p><div class="highlight-javascript"><div class="highlight"><pre><span class="nx">model</span><span class="p">.</span><span class="nx">query</span><span class="p">([</span><span class="s1">&#39;name&#39;</span><span class="p">,</span> <span class="s1">&#39;login&#39;</span><span class="p">,</span> <span class="s1">&#39;user_email&#39;</span><span class="p">,</span> <span class="s1">&#39;signature&#39;</span><span class="p">])</span>
     <span class="p">.</span><span class="nx">filter</span><span class="p">([[</span><span class="s1">&#39;active&#39;</span><span class="p">,</span> <span class="s1">&#39;=&#39;</span><span class="p">,</span> <span class="kc">true</span><span class="p">],</span> <span class="p">[</span><span class="s1">&#39;company_id&#39;</span><span class="p">,</span> <span class="s1">&#39;=&#39;</span><span class="p">,</span> <span class="nx">main_company</span><span class="p">]])</span>
     <span class="p">.</span><span class="nx">limit</span><span class="p">(</span><span class="mi">15</span><span class="p">)</span>
     <span class="p">.</span><span class="nx">all</span><span class="p">().</span><span class="nx">then</span><span class="p">(</span><span class="kd">function</span> <span class="p">(</span><span class="nx">users</span><span class="p">)</span> <span class="p">{</span>
    <span class="c1">// do work with users records</span>
<span class="p">});</span>
</pre></div>
</div>
<p >versus:</p><div class="highlight-javascript"><div class="highlight"><pre><span class="nx">model</span><span class="p">.</span><span class="nx">call</span><span class="p">(</span><span class="s1">&#39;search&#39;</span><span class="p">,</span> <span class="p">[[</span><span class="s1">&#39;active&#39;</span><span class="p">,</span> <span class="s1">&#39;=&#39;</span><span class="p">,</span> <span class="kc">true</span><span class="p">],</span> <span class="p">[</span><span class="s1">&#39;company_id&#39;</span><span class="p">,</span> <span class="s1">&#39;=&#39;</span><span class="p">,</span> <span class="nx">main_company</span><span class="p">]],</span> <span class="p">{</span><span class="nx">limit</span><span class="o">:</span> <span class="mi">15</span><span class="p">})</span>
    <span class="p">.</span><span class="nx">then</span><span class="p">(</span><span class="kd">function</span> <span class="p">(</span><span class="nx">ids</span><span class="p">)</span> <span class="p">{</span>
        <span class="k">return</span> <span class="nx">model</span><span class="p">.</span><span class="nx">call</span><span class="p">(</span><span class="s1">&#39;read&#39;</span><span class="p">,</span> <span class="p">[</span><span class="nx">ids</span><span class="p">,</span> <span class="p">[</span><span class="s1">&#39;name&#39;</span><span class="p">,</span> <span class="s1">&#39;login&#39;</span><span class="p">,</span> <span class="s1">&#39;user_email&#39;</span><span class="p">,</span> <span class="s1">&#39;signature&#39;</span><span class="p">]]);</span>
    <span class="p">})</span>
    <span class="p">.</span><span class="nx">then</span><span class="p">(</span><span class="kd">function</span> <span class="p">(</span><span class="nx">users</span><span class="p">)</span> <span class="p">{</span>
        <span class="c1">// do work with users records</span>
    <span class="p">});</span>
</pre></div>
</div>
<ul ><li ><code class="js-func xref js">query()</code> takes an optional list of fields as
parameter (if no field is provided, all fields of the model are fetched). It
returns a <a href="../reference/javascript.html#openerp.web.Query" class="internal reference" title="openerp.web.Query"><code class="js-class xref js">openerp.web.Query()</code></a> which can be further customized before
being executed</li><li ><a href="../reference/javascript.html#openerp.web.Query" class="internal reference" title="openerp.web.Query"><code class="js-class xref js">Query()</code></a> represents the query being built. It is
immutable, methods to customize the query actually return a modified copy,
so it's possible to use the original and the new version side-by-side. See
<a href="../reference/javascript.html#openerp.web.Query" class="internal reference" title="openerp.web.Query"><code class="js-class xref js">Query()</code></a> for its customization options.</li></ul><p >When the query is set up as desired, simply call
<a href="../reference/javascript.html#openerp.web.Query.all" class="internal reference" title="openerp.web.Query.all"><code class="js-func xref js">all()</code></a> to execute it and return a
deferred to its result. The result is the same as
<code class="py py-meth xref">read()</code>'s, an array of dictionaries where each
dictionary is a requested record, with each requested field a dictionary key.</p></section><section id="exercises"><h2 >练习</h2><div role="alert" class="alert-exercise alert"><p class="alert-title">Exercise</p><p >今日消息</p><p >创建一个``MessageOfTheDay``插件显示的``oepetstore.message_of_the_day``模型的最后一个记录。挂件应尽快，因为它是显示其读取记录。</p><p >显示在宠物商店主页的挂件。</p></div><div role="alert" class="alert-exercise alert"><p class="alert-title">Exercise</p><p >宠物玩具名单</p><p >Create a <code >PetToysList</code> widget displaying 5 toys (using their name and
their images).</p><p >The pet toys are not stored in a new model, instead they're stored in
<code >product.product</code> using a special category <em >Pet Toys</em>. You can see the
pre-generated toys and add new ones by going to
<span class="menuselection">Pet Store ‣ Pet Store ‣ Pet Toys</span>. You will probably
need to explore <code >product.product</code> to create the right domain to
select just pet toys.</p><p >In Odoo, images are generally stored in regular fields encoded as
<a href="http://en.wikipedia.org/wiki/Base64" class="external reference alert-link">base64</a>, HTML supports displaying images straight from base64 with
<code class="samp">&lt;img src=&quot;data:<em >mime_type</em>;base64,<em >base64_image_data</em>&quot;/&gt;</code></p><p >该``PetToysList``部件应该在``MessageOfTheDay``部件的右侧显示在主页上。你需要做一些布局CSS来实现这一目标。</p></div></section><section id="existing-web-components"><h2 >现有的Web组件</h2></section><section id="the-action-manager"><h3 >动作管理器</h3><p >In Odoo, many operations start from an <a href="../reference/actions.html#reference-actions" class="internal reference"><span >action</span></a>:
opening a menu item (to a view), printing a report, ...</p><p >Actions are pieces of data describing how a client should react to the
activation of a piece of content. Actions can be stored (and read through a
model) or they can be generated on-the fly (locally to the client by
javascript code, or remotely by a method of a model).</p><p >In Odoo Web, the component responsible for handling and reacting to these
actions is the <em >Action Manager</em>.</p></section><section id="using-the-action-manager"><h4 >使用动作管理器</h4><p >The action manager can be invoked explicitly from javascript code by creating
a dictionary describing <a href="../reference/actions.html#reference-actions" class="internal reference"><span >an action</span></a> of the right
type, and calling an action manager instance with it.</p><p ><code class="js-func xref js">do_action()</code> is a shortcut of <code class="js-class xref js">Widget()</code>
looking up the &quot;current&quot; action manager and executing the action:</p><div class="highlight-javascript"><div class="highlight"><pre><span class="nx">instance</span><span class="p">.</span><span class="nx">web</span><span class="p">.</span><span class="nx">TestWidget</span> <span class="o">=</span> <span class="nx">instance</span><span class="p">.</span><span class="nx">Widget</span><span class="p">.</span><span class="nx">extend</span><span class="p">({</span>
    <span class="nx">dispatch_to_new_action</span><span class="o">:</span> <span class="kd">function</span><span class="p">()</span> <span class="p">{</span>
        <span class="k">this</span><span class="p">.</span><span class="nx">do_action</span><span class="p">({</span>
            <span class="nx">type</span><span class="o">:</span> <span class="s1">&#39;ir.actions.act_window&#39;</span><span class="p">,</span>
            <span class="nx">res_model</span><span class="o">:</span> <span class="s2">&quot;product.product&quot;</span><span class="p">,</span>
            <span class="nx">res_id</span><span class="o">:</span> <span class="mi">1</span><span class="p">,</span>
            <span class="nx">views</span><span class="o">:</span> <span class="p">[[</span><span class="kc">false</span><span class="p">,</span> <span class="s1">&#39;form&#39;</span><span class="p">]],</span>
            <span class="nx">target</span><span class="o">:</span> <span class="s1">&#39;current&#39;</span><span class="p">,</span>
            <span class="nx">context</span><span class="o">:</span> <span class="p">{},</span>
        <span class="p">});</span>
    <span class="p">},</span>
<span class="p">});</span>
</pre></div>
</div>
<p >The most common action <code >type</code> is <code >ir.actions.act_window</code> which provides
views to a model (displays a model in various manners), its most common
attributes are:</p><dl ><dt ><code >res_model</code></dt><dd ><p >该模型在视图中显示</p></dd><dt ><code >res_id</code> (可选)</dt><dd ><p >对于形式的视图，在``res_model``预选记录</p></dd><dt ><code >views</code></dt><dd >Lists the views available through the action. A list of
<code >[view_id, view_type]</code>, <code >view_id</code> can either be the database identifier
of a view of the right type, or <code >false</code> to use the view by default for
the specified type. View types can not be present multiple times. The action
will open the first view of the list by default.</dd><dt ><code >target</code></dt><dd >Either <code >current</code> (the default) which replaces the &quot;content&quot; section of the
web client by the action, or <code >new</code> to open the action in a dialog box.</dd><dt ><code >context</code></dt><dd ><p >附加的上下文数据的动作中使用。</p></dd></dl><div role="alert" class="alert-exercise alert"><p class="alert-title">Exercise</p><p >跳转到产品</p><p >修改``PetToysList``组件，以便点击一个玩具代替了网页的玩具的表单视图。</p></div></section><section id="client-actions"><h3 >客户端动作</h3><p >Throughout this guide, we used a simple <code >HomePage</code> widget which the web
client automatically starts when we select the right menu item. But how did
the Odoo web know to start this widget? Because the widget is registered as
a <em >client action</em>.</p><p >A client action is (as its name implies) an action type defined almost
entirely in the client, in javascript for Odoo web. The server simply sends
an action tag (an arbitrary name), and optionally adds a few parameters, but
beyond that <em >everything</em> is handled by custom client code.</p><p >Our widget is registered as the handler for the client action through this:</p><div class="highlight-javascript"><div class="highlight"><pre><span class="nx">instance</span><span class="p">.</span><span class="nx">web</span><span class="p">.</span><span class="nx">client_actions</span><span class="p">.</span><span class="nx">add</span><span class="p">(</span><span class="s1">&#39;petstore.homepage&#39;</span><span class="p">,</span> <span class="s1">&#39;instance.oepetstore.HomePage&#39;</span><span class="p">);</span>
</pre></div>
</div>
<p ><code >instance.web.client_actions</code> is a <code class="js-class xref js">Registry()</code> in which
the action manager looks up client action handlers when it needs to execute
one. The first parameter of <code class="js-class xref js">add()</code> is the name
(tag) of the client action, and the second parameter is the path to the widget
from the Odoo web client root.</p><p >必须在执行客户端动作，动作管理器查找其标记在注册表中，走指定的路​​径，并显示它发现在最后的小部件。</p><div role="alert" class="alert-info alert"><p class="alert-title">注解</p><p >a client action handler can also be a regular function, in whch case
it'll be called and its result (if any) will be interpreted as the
next action to execute.</p></div><p >On the server side, we had simply defined an <code >ir.actions.client</code> action:</p><div class="highlight-xml"><div class="highlight"><pre><span class="nt">&lt;record</span> <span class="na">id=</span><span class="s">&quot;action_home_page&quot;</span> <span class="na">model=</span><span class="s">&quot;ir.actions.client&quot;</span><span class="nt">&gt;</span>
    <span class="nt">&lt;field</span> <span class="na">name=</span><span class="s">&quot;tag&quot;</span><span class="nt">&gt;</span>petstore.homepage<span class="nt">&lt;/field&gt;</span>
<span class="nt">&lt;/record&gt;</span>
</pre></div>
</div>
<p >and a menu opening the action:</p><div class="highlight-xml"><div class="highlight"><pre><span class="nt">&lt;menuitem</span> <span class="na">id=</span><span class="s">&quot;home_page_petstore_menu&quot;</span> <span class="na">parent=</span><span class="s">&quot;petstore_menu&quot;</span>
          <span class="na">name=</span><span class="s">&quot;Home Page&quot;</span> <span class="na">action=</span><span class="s">&quot;action_home_page&quot;</span><span class="nt">/&gt;</span>
</pre></div>
</div>
</section><section id="architecture-of-the-views"><h3 >视图的体系结构</h3><p >Much of Odoo web's usefulness (and complexity) resides in views. Each view
type is a way of displaying a model in the client.</p></section><section id="the-view-manager"><h4 >视图管理器</h4><p >When an <code >ActionManager</code> instance receive an action of type
<code >ir.actions.act_window</code>, it delegates the synchronization and handling of
the views themselves to a <em >view manager</em>, which will then set up one or
multiple views depending on the original action's requirements:</p><a href="../_images/viewarchitecture.svg" class="internal reference"><img src="../_images/viewarchitecture.svg" class="img-responsive center-block"></a></section><section id="the-views"><h4 >The Views</h4><p >Most <a href="../reference/views.html#reference-views" class="internal reference"><span >Odoo views</span></a> are implemented through a subclass
of <code class="js-class xref js">openerp.web.View()</code> which provides a bit of generic basic structure
for handling events and displaying model information.</p><p >The <em >search view</em> is considered a view type by the main Odoo framework, but
handled separately by the web client (as it's a more permanent fixture and
can interact with other views, which regular views don't do).</p><p >A view is responsible for loading its own description XML (using
<code class="py xref py-class">fields_view_get</code>) and any other data source
it needs. To that purpose, views are provided with an optional view
identifier set as the <code class="js-attr xref js">view_id</code> attribute.</p><p >Views are also provided with a <code class="js-class xref js">DataSet()</code> instance which
holds most necessary model information (the model name and possibly various
record ids).</p><p >Views may also want to handle search queries by overriding
<code class="js-func xref js">do_search()</code>, and updating their
<code class="js-class xref js">DataSet()</code> as necessary.</p></section><section id="the-form-view-fields"><h3 >表单视图字段</h3><p >一个常见的​​需求是Web表单视图的分机来增加显示字段的新途径。</p><p >All built-in fields have a default display implementation, a new
form widget may be necessary to correctly interact with a new field type
(e.g. a <a href="../glossary.html#term-gis" class="internal reference"><span class="std std-term xref">GIS</span></a> field) or to provide new representations and ways to
interact with existing field types (e.g. validate
<code class="py xref py-class">Char</code> fields which should contain email addresses
and display them as email links).</p><p >To explicitly specify which form widget should be used to display a field,
simply use the <code >widget</code> attribute in the view's XML description:</p><div class="highlight-xml"><div class="highlight"><pre><span class="nt">&lt;field</span> <span class="na">name=</span><span class="s">&quot;contact_mail&quot;</span> <span class="na">widget=</span><span class="s">&quot;email&quot;</span><span class="nt">/&gt;</span>
</pre></div>
</div>
<div role="alert" class="alert-info alert"><p class="alert-title">注解</p><ul ><li >the same widget is used in both &quot;view&quot; (read-only) and &quot;edition&quot; modes
of a form view, it's not possible to use a widget in one and an other
widget in the other</li><li >and a given field (name) can not be used multiple times in the same form</li><li ><p >一个小部件可以忽略表单视图的当前模式和保持不变的同时查看和编辑</p></li></ul></div><p >字段由表单视图实例化后，已读取它的XML描述和建造代表该说明相应的HTML。在此之后，表格视图将使用一些方法中，字段的对象进行通信。这些方法是由``FieldInterface``接口中定义。几乎所有字段继承了``AbstractField``抽象类。这个类定义了需要由多数字段实现了一些默认的机制。</p><p >Here are some of the responsibilities of a field class:</p><ul ><li ><p >字段类必须显示，并允许用户编辑该字段的值。</p></li><li ><p >It must correctly implement the 3 field attributes available in all fields
of Odoo. The <code >AbstractField</code> class already implements an algorithm that
dynamically calculates the value of these attributes (they can change at any
moment because their value change according to the value of other
fields). Their values are stored in <em >Widget Properties</em> (the widget
properties were explained earlier in this guide). It is the responsibility
of each field class to check these widget properties and dynamically adapt
depending of their values. Here is a description of each of these
attributes:</p><ul ><li ><code >required</code>: The field must have a value before saving. If <code >required</code>
is <code >true</code> and the field doesn't have a value, the method
<code >is_valid()</code> of the field must return <code >false</code>.</li><li ><code >invisible</code>: When this is <code >true</code>, the field must be invisible. The
<code >AbstractField</code> class already has a basic implementation of this
behavior that fits most fields.</li><li ><code >readonly</code>: When <code >true</code>, the field must not be editable by the
user. Most fields in Odoo have a completely different behavior depending
on the value of <code >readonly</code>. As example, the <code >FieldChar</code> displays an
HTML <code >&lt;input&gt;</code> when it is editable and simply displays the text when
it is read-only. This also means it has much more code it would need to
implement only one behavior, but this is necessary to ensure a good user
experience.</li></ul></li><li >Fields have two methods, <code >set_value()</code> and <code >get_value()</code>, which are
called by the form view to give it the value to display and get back the new
value entered by the user. These methods must be able to handle the value as
given by the Odoo server when a <code >read()</code> is performed on a model and give
back a valid value for a <code >write()</code>.  Remember that the JavaScript/Python
data types used to represent the values given by <code >read()</code> and given to
<code >write()</code> is not necessarily the same in Odoo. As example, when you read a
many2one, it is always a tuple whose first value is the id of the pointed
record and the second one is the name get (ie: <code >(15, &quot;Agrolait&quot;)</code>). But
when you write a many2one it must be a single integer, not a tuple
anymore. <code >AbstractField</code> has a default implementation of these methods
that works well for simple data type and set a widget property named
<code >value</code>.</li></ul><p >请注意，以更好地了解如何实施字段，我们强烈建议你看一下``FieldInterface``接口和Odoo Web客户端的代码``AbstractField``直接类的定义。</p></section><section id="creating-a-new-type-of-field"><h4 >创建域的一种新类型</h4><p >在这一部分，我们将解释如何创建一个新的类型的字段。这里的例子将是重新实现``FieldChar``类，并逐步讲解每一个部分。</p></section><section id="simple-read-only-field"><h5 >简单的只读字段</h5><p >这里是只显示文本的第一实现。用户将不能够修改该字段的内容。</p><div class="highlight-javascript"><div class="highlight"><pre><span class="nx">local</span><span class="p">.</span><span class="nx">FieldChar2</span> <span class="o">=</span> <span class="nx">instance</span><span class="p">.</span><span class="nx">web</span><span class="p">.</span><span class="nx">form</span><span class="p">.</span><span class="nx">AbstractField</span><span class="p">.</span><span class="nx">extend</span><span class="p">({</span>
    <span class="nx">init</span><span class="o">:</span> <span class="kd">function</span><span class="p">()</span> <span class="p">{</span>
        <span class="k">this</span><span class="p">.</span><span class="nx">_super</span><span class="p">.</span><span class="nx">apply</span><span class="p">(</span><span class="k">this</span><span class="p">,</span> <span class="nx">arguments</span><span class="p">);</span>
        <span class="k">this</span><span class="p">.</span><span class="nx">set</span><span class="p">(</span><span class="s2">&quot;value&quot;</span><span class="p">,</span> <span class="s2">&quot;&quot;</span><span class="p">);</span>
    <span class="p">},</span>
    <span class="nx">render_value</span><span class="o">:</span> <span class="kd">function</span><span class="p">()</span> <span class="p">{</span>
        <span class="k">this</span><span class="p">.</span><span class="nx">$el</span><span class="p">.</span><span class="nx">text</span><span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">get</span><span class="p">(</span><span class="s2">&quot;value&quot;</span><span class="p">));</span>
    <span class="p">},</span>
<span class="p">});</span>

<span class="nx">instance</span><span class="p">.</span><span class="nx">web</span><span class="p">.</span><span class="nx">form</span><span class="p">.</span><span class="nx">widgets</span><span class="p">.</span><span class="nx">add</span><span class="p">(</span><span class="s1">&#39;char2&#39;</span><span class="p">,</span> <span class="s1">&#39;instance.oepetstore.FieldChar2&#39;</span><span class="p">);</span>
</pre></div>
</div>
<p >In this example, we declare a class named <code >FieldChar2</code> inheriting from
<code >AbstractField</code>. We also register this class in the registry
<code >instance.web.form.widgets</code> under the key <code >char2</code>. That will allow us to
use this new field in any form view by specifying <code >widget=&quot;char2&quot;</code> in the
<code >&lt;field/&gt;</code> tag in the XML declaration of the view.</p><p >In this example, we define a single method: <code >render_value()</code>. All it does is
display the widget property <code >value</code>.  Those are two tools defined by the
<code >AbstractField</code> class. As explained before, the form view will call the
method <code >set_value()</code> of the field to set the value to display. This method
already has a default implementation in <code >AbstractField</code> which simply sets
the widget property <code >value</code>. <code >AbstractField</code> also watch the
<code >change:value</code> event on itself and calls the <code >render_value()</code> when it
occurs. So, <code >render_value()</code> is a convenience method to implement in child
classes to perform some operation each time the value of the field changes.</p><p >In the <code >init()</code> method, we also define the default value of the field if
none is specified by the form view (here we assume the default value of a
<code >char</code> field should be an empty string).</p></section><section id="read-write-field"><h5 >读写字段</h5><p >Read-only fields, which only display content and don't allow the
user to modify it can be useful, but most fields in Odoo also allow editing.
This makes the field classes more complicated, mostly because fields are
supposed to handle both editable and non-editable mode, those modes are
often completely different (for design and usability purpose) and the fields
must be able to switch between modes at any moment.</p><p >To know in which mode the current field should be, the <code >AbstractField</code> class
sets a widget property named <code >effective_readonly</code>. The field should watch
for changes in that widget property and display the correct mode
accordingly. Example:</p><div class="highlight-javascript"><div class="highlight"><pre><span class="nx">local</span><span class="p">.</span><span class="nx">FieldChar2</span> <span class="o">=</span> <span class="nx">instance</span><span class="p">.</span><span class="nx">web</span><span class="p">.</span><span class="nx">form</span><span class="p">.</span><span class="nx">AbstractField</span><span class="p">.</span><span class="nx">extend</span><span class="p">({</span>
    <span class="nx">init</span><span class="o">:</span> <span class="kd">function</span><span class="p">()</span> <span class="p">{</span>
        <span class="k">this</span><span class="p">.</span><span class="nx">_super</span><span class="p">.</span><span class="nx">apply</span><span class="p">(</span><span class="k">this</span><span class="p">,</span> <span class="nx">arguments</span><span class="p">);</span>
        <span class="k">this</span><span class="p">.</span><span class="nx">set</span><span class="p">(</span><span class="s2">&quot;value&quot;</span><span class="p">,</span> <span class="s2">&quot;&quot;</span><span class="p">);</span>
    <span class="p">},</span>
    <span class="nx">start</span><span class="o">:</span> <span class="kd">function</span><span class="p">()</span> <span class="p">{</span>
        <span class="k">this</span><span class="p">.</span><span class="nx">on</span><span class="p">(</span><span class="s2">&quot;change:effective_readonly&quot;</span><span class="p">,</span> <span class="k">this</span><span class="p">,</span> <span class="kd">function</span><span class="p">()</span> <span class="p">{</span>
            <span class="k">this</span><span class="p">.</span><span class="nx">display_field</span><span class="p">();</span>
            <span class="k">this</span><span class="p">.</span><span class="nx">render_value</span><span class="p">();</span>
        <span class="p">});</span>
        <span class="k">this</span><span class="p">.</span><span class="nx">display_field</span><span class="p">();</span>
        <span class="k">return</span> <span class="k">this</span><span class="p">.</span><span class="nx">_super</span><span class="p">();</span>
    <span class="p">},</span>
    <span class="nx">display_field</span><span class="o">:</span> <span class="kd">function</span><span class="p">()</span> <span class="p">{</span>
        <span class="kd">var</span> <span class="nx">self</span> <span class="o">=</span> <span class="k">this</span><span class="p">;</span>
        <span class="k">this</span><span class="p">.</span><span class="nx">$el</span><span class="p">.</span><span class="nx">html</span><span class="p">(</span><span class="nx">QWeb</span><span class="p">.</span><span class="nx">render</span><span class="p">(</span><span class="s2">&quot;FieldChar2&quot;</span><span class="p">,</span> <span class="p">{</span><span class="nx">widget</span><span class="o">:</span> <span class="k">this</span><span class="p">}));</span>
        <span class="k">if</span> <span class="p">(</span><span class="o">!</span> <span class="k">this</span><span class="p">.</span><span class="nx">get</span><span class="p">(</span><span class="s2">&quot;effective_readonly&quot;</span><span class="p">))</span> <span class="p">{</span>
            <span class="k">this</span><span class="p">.</span><span class="nx">$</span><span class="p">(</span><span class="s2">&quot;input&quot;</span><span class="p">).</span><span class="nx">change</span><span class="p">(</span><span class="kd">function</span><span class="p">()</span> <span class="p">{</span>
                <span class="nx">self</span><span class="p">.</span><span class="nx">internal_set_value</span><span class="p">(</span><span class="nx">self</span><span class="p">.</span><span class="nx">$</span><span class="p">(</span><span class="s2">&quot;input&quot;</span><span class="p">).</span><span class="nx">val</span><span class="p">());</span>
            <span class="p">});</span>
        <span class="p">}</span>
    <span class="p">},</span>
    <span class="nx">render_value</span><span class="o">:</span> <span class="kd">function</span><span class="p">()</span> <span class="p">{</span>
        <span class="k">if</span> <span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">get</span><span class="p">(</span><span class="s2">&quot;effective_readonly&quot;</span><span class="p">))</span> <span class="p">{</span>
            <span class="k">this</span><span class="p">.</span><span class="nx">$el</span><span class="p">.</span><span class="nx">text</span><span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">get</span><span class="p">(</span><span class="s2">&quot;value&quot;</span><span class="p">));</span>
        <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
            <span class="k">this</span><span class="p">.</span><span class="nx">$</span><span class="p">(</span><span class="s2">&quot;input&quot;</span><span class="p">).</span><span class="nx">val</span><span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">get</span><span class="p">(</span><span class="s2">&quot;value&quot;</span><span class="p">));</span>
        <span class="p">}</span>
    <span class="p">},</span>
<span class="p">});</span>

<span class="nx">instance</span><span class="p">.</span><span class="nx">web</span><span class="p">.</span><span class="nx">form</span><span class="p">.</span><span class="nx">widgets</span><span class="p">.</span><span class="nx">add</span><span class="p">(</span><span class="s1">&#39;char2&#39;</span><span class="p">,</span> <span class="s1">&#39;instance.oepetstore.FieldChar2&#39;</span><span class="p">);</span>
</pre></div>
</div>
<div class="highlight-xml"><div class="highlight"><pre><span class="nt">&lt;t</span> <span class="na">t-name=</span><span class="s">&quot;FieldChar2&quot;</span><span class="nt">&gt;</span>
    <span class="nt">&lt;div</span> <span class="na">class=</span><span class="s">&quot;oe_field_char2&quot;</span><span class="nt">&gt;</span>
        <span class="nt">&lt;t</span> <span class="na">t-if=</span><span class="s">&quot;! widget.get(&#39;effective_readonly&#39;)&quot;</span><span class="nt">&gt;</span>
            <span class="nt">&lt;input</span> <span class="na">type=</span><span class="s">&quot;text&quot;</span><span class="nt">&gt;&lt;/input&gt;</span>
        <span class="nt">&lt;/t&gt;</span>
    <span class="nt">&lt;/div&gt;</span>
<span class="nt">&lt;/t&gt;</span>
</pre></div>
</div>
<p >In the <code >start()</code> method (which is called immediately after a widget has been
appended to the DOM), we bind on the event <code >change:effective_readonly</code>. That
allows us to redisplay the field each time the widget property
<code >effective_readonly</code> changes. This event handler will call
<code >display_field()</code>, which is also called directly in <code >start()</code>. This
<code >display_field()</code> was created specifically for this field, it's not a method
defined in <code >AbstractField</code> or any other class. We can use this method
to display the content of the field depending on the current mode.</p><p >From now on the conception of this field is typical, except there is a
lot of verifications to know the state of the <code >effective_readonly</code> property:</p><ul ><li >In the QWeb template used to display the content of the widget, it displays
an <code >&lt;input type=&quot;text&quot; /&gt;</code> if we are in read-write mode and nothing in
particular in read-only mode.</li><li >In the <code >display_field()</code> method, we have to bind on the <code >change</code> event
of the <code >&lt;input type=&quot;text&quot; /&gt;</code> to know when the user has changed the
value. When it happens, we call the <code >internal_set_value()</code> method with the
new value of the field. This is a convenience method provided by the
<code >AbstractField</code> class. That method will set a new value in the <code >value</code>
property but will not trigger a call to <code >render_value()</code> (which is not
necessary since the <code >&lt;input type=&quot;text&quot; /&gt;</code> already contains the correct
value).</li><li >In <code >render_value()</code>, we use a completely different code to display the
value of the field depending if we are in read-only or in read-write mode.</li></ul><div role="alert" class="alert-exercise alert"><p class="alert-title">Exercise</p><p >创建一个彩色场</p><p >Create a <code >FieldColor</code> class. The value of this field should be a string
containing a color code like those used in CSS (example: <code >#FF0000</code> for
red). In read-only mode, this color field should display a little block
whose color corresponds to the value of the field. In read-write mode, you
should display an <code >&lt;input type=&quot;color&quot; /&gt;</code>. That type of <code >&lt;input /&gt;</code>
is an HTML5 component that doesn't work in all browsers but works well in
Google Chrome. So it's OK to use as an exercise.</p><p >您可以使用插件在``message_of_the_day``模式，其名为``color``字段的表单视图。作为奖励，你可以改变在本指南的前面部分创建，以显示新的一天，在``color``字段指示的背景颜色的消息``MessageOfTheDay``部件。</p></div></section><section id="the-form-view-custom-widgets"><h3 >表单视图定制的挂件</h3><p >Form fields are used to edit a single field, and are intrinsically linked to
a field. Because this may be limiting, it is also possible to create
<em >form widgets</em> which are not so restricted and have less ties to a specific
lifecycle.</p><p >Custom form widgets can be added to a form view through the <code >widget</code> tag:</p><div class="highlight-xml"><div class="highlight"><pre><span class="nt">&lt;widget</span> <span class="na">type=</span><span class="s">&quot;xxx&quot;</span> <span class="nt">/&gt;</span>
</pre></div>
</div>
<p >This type of widget will simply be created by the form view during the
creation of the HTML according to the XML definition. They have properties in
common with the fields (like the <code >effective_readonly</code> property) but they are
not assigned a precise field. And so they don't have methods like
<code >get_value()</code> and <code >set_value()</code>. They must inherit from the <code >FormWidget</code>
abstract class.</p><p >Form widgets can interact with form fields by listening for their changes and
fetching or altering their values. They can access form fields through
their <code class="js-attr xref js">field_manager</code> attribute:</p><div class="highlight-javascript"><div class="highlight"><pre><span class="nx">local</span><span class="p">.</span><span class="nx">WidgetMultiplication</span> <span class="o">=</span> <span class="nx">instance</span><span class="p">.</span><span class="nx">web</span><span class="p">.</span><span class="nx">form</span><span class="p">.</span><span class="nx">FormWidget</span><span class="p">.</span><span class="nx">extend</span><span class="p">({</span>
    <span class="nx">start</span><span class="o">:</span> <span class="kd">function</span><span class="p">()</span> <span class="p">{</span>
        <span class="k">this</span><span class="p">.</span><span class="nx">_super</span><span class="p">();</span>
        <span class="k">this</span><span class="p">.</span><span class="nx">field_manager</span><span class="p">.</span><span class="nx">on</span><span class="p">(</span><span class="s2">&quot;field_changed:integer_a&quot;</span><span class="p">,</span> <span class="k">this</span><span class="p">,</span> <span class="k">this</span><span class="p">.</span><span class="nx">display_result</span><span class="p">);</span>
        <span class="k">this</span><span class="p">.</span><span class="nx">field_manager</span><span class="p">.</span><span class="nx">on</span><span class="p">(</span><span class="s2">&quot;field_changed:integer_b&quot;</span><span class="p">,</span> <span class="k">this</span><span class="p">,</span> <span class="k">this</span><span class="p">.</span><span class="nx">display_result</span><span class="p">);</span>
        <span class="k">this</span><span class="p">.</span><span class="nx">display_result</span><span class="p">();</span>
    <span class="p">},</span>
    <span class="nx">display_result</span><span class="o">:</span> <span class="kd">function</span><span class="p">()</span> <span class="p">{</span>
        <span class="kd">var</span> <span class="nx">result</span> <span class="o">=</span> <span class="k">this</span><span class="p">.</span><span class="nx">field_manager</span><span class="p">.</span><span class="nx">get_field_value</span><span class="p">(</span><span class="s2">&quot;integer_a&quot;</span><span class="p">)</span> <span class="o">*</span>
                     <span class="k">this</span><span class="p">.</span><span class="nx">field_manager</span><span class="p">.</span><span class="nx">get_field_value</span><span class="p">(</span><span class="s2">&quot;integer_b&quot;</span><span class="p">);</span>
        <span class="k">this</span><span class="p">.</span><span class="nx">$el</span><span class="p">.</span><span class="nx">text</span><span class="p">(</span><span class="s2">&quot;a*b = &quot;</span> <span class="o">+</span> <span class="nx">result</span><span class="p">);</span>
    <span class="p">}</span>
<span class="p">});</span>

<span class="nx">instance</span><span class="p">.</span><span class="nx">web</span><span class="p">.</span><span class="nx">form</span><span class="p">.</span><span class="nx">custom_widgets</span><span class="p">.</span><span class="nx">add</span><span class="p">(</span><span class="s1">&#39;multiplication&#39;</span><span class="p">,</span> <span class="s1">&#39;instance.oepetstore.WidgetMultiplication&#39;</span><span class="p">);</span>
</pre></div>
</div>
<p ><code class="js-attr xref js">FormWidget</code> is generally the
<code class="js-class xref js">FormView()</code> itself, but features used from it should
be limited to those defined by <code class="js-class xref js">FieldManagerMixin()</code>,
the most useful being:</p><ul ><li ><code class="js-func xref js">get_field_value(field_name)()</code>
which returns the value of a field.</li><li ><code class="js-func xref js">set_values(values)()</code> sets multiple
field values, takes a mapping of <code >{field_name: value_to_set}</code></li><li >An event <code class="samp">field_changed:<em >field_name</em></code> is triggered any time the value
of the field called <code >field_name</code> is changed</li></ul><div role="alert" class="alert-exercise alert"><p class="alert-title">Exercise</p><p >坐标显示在谷歌地图</p><p >添加两个字段``product.product``存储纬度和经度，然后创建一个新的表单控件来显示产品的原产地的经度和纬度的地图</p><p >To display the map, use Google Map's embedding:</p><div class="highlight-html"><div class="highlight"><pre><span class="nt">&lt;iframe</span> <span class="na">width=</span><span class="s">&quot;400&quot;</span> <span class="na">height=</span><span class="s">&quot;300&quot;</span> <span class="na">src=</span><span class="s">&quot;https://maps.google.com/?ie=UTF8&amp;amp;ll=XXX,YYY&amp;amp;output=embed&quot;</span><span class="nt">&gt;</span>
<span class="nt">&lt;/iframe&gt;</span>
</pre></div>
</div>
<p >其中``XXX``应该由纬度和``YYY``由经度所取代。</p><p >显示这两个位置的字段，并使用他们产品的表单视图的新的笔记本页面地图工具。</p></div><div role="alert" class="alert-exercise alert"><p class="alert-title">Exercise</p><p >获取当前坐标</p><p >添加一个按钮复位该产品的坐标到用户的位置，就可以得到这些坐标使用'javascript的地理位置API`_。</p><p >现在我们想显示的附加按钮来自动设置的坐标到当前用户的位置。</p><p >要得到用户的坐标，一个简单的方法是使用地理位置的JavaScript API。 <a href="http://www.w3schools.com/html/html5_geolocation.asp" class="external reference alert-link">请参阅联机文档了解如何使用it</a>。</p><p >另请注意，用户不应该能够在该按钮点击时，表单视图是只读模式。因此，这个自定义挂件应正确处理的``effective_readonly``物业就像任何字段。这样做的一个方法是使当``effective_readonly``是真实的按钮消失。</p></div><div class="footnote" id="id4"><span class="footnote-label"><a class="footnote-backref" href="#id1">[1]</a></span> as a separate concept from instances. In many languages classes
are full-fledged objects and themselves instance (of
metaclasses) but there remains two fairly separate hierarchies
between classes and instances</div><div class="footnote" id="dombugs"><span class="footnote-label"><a class="footnote-backref" href="#id2">[2]</a></span> <p >以及掩盖了跨浏览器的差异，虽然这已经随着时间的推移变得不那么必要</p></div></section>

          </article>
        </div>
        
        <div id="mask"></div>
      </main>
    </div>
  </div>

  <div class="floating_action_container">
    <a id="floating_action" class="ripple" href="#">
      <i class="mdi-action-explore"></i>
    </a>
    <div id="floating_action_menu">
      <span class="bubble"></span>
      <ul class="list-group content">
        <li class="list-group-item ripple"><a>Cras justo odio</a></li>
        <li class="list-group-item ripple"><a>Dapibus ac facilisis in</a></li>
        <li class="list-group-item ripple"><a>Morbi leo risus</a></li>
        <li class="list-group-item ripple"><a>Porta ac consectetur ac</a></li>
        <li class="list-group-item ripple"><a>Vestibulum at eros</a></li>
      </ul>
    </div>
  </div>
  <footer>
    <div id="footer" class="container">
      <span class="o_logo o_logo_inverse center-block o_footer_logo"></span>
      <div class="row">
        <div class="col-sm-7 col-md-7 col-lg-6">
          <div class="row">
            <div class="col-xs-6 col-sm-4">
              <span class="menu_title">Community</span>
              <ul>
                <li><a href="https://github.com/odoo/odoo">Github</a></li>
                <li><a href="http://www.odoo.com/page/download">Download</a></li>
                <li class="divider"></li>
                <li><a href="http://runbot.odoo.com/runbot/repo/git-github-com-odoo-enterprise-7">Runbot</a></li>
                <li><a href="https://github.com/odoo/odoo/wiki/Translations">Translations</a></li>
                <li class="divider"></li>
                <li><a href="http://www.odoo.com/page/odoo-community">Mailing Lists</a></li>
                <li><a href="http://www.odoo.com/forum/help-1">Forum</a></li>
              </ul>
            </div>
            <div class="col-xs-6 col-sm-4">
              <span class="menu_title">Services</span>
              <ul>
                <li><a href="http://www.odoo.com/pricing">Editions</a></li>
                <li><a href="http://www.odoo.com/pricing-online">Cloud Pricing</a></li>
                <li><a href="http://www.odoo.com/page/upgrade">Upgrade</a></li>
                <li class="divider"></li>
                <li><a href="http://www.odoo.com/partners">Find a partner</a></li>
                <li><a href="http://www.odoo.com/page/become-a-partner">Become a partner</a></li>
                <li class="divider"></li>
                <li><a href="http://www.odoo.com/page/education-program">Education</a></li>
                <li class="divider"></li>
                <li><a href="http://www.odoo.com/page/security">Security</a></li>
              </ul>
            </div>
            <div class="col-sm-4 mb64">
              <span class="menu_title">About us</span>
              <ul>
                <li><a href="http://www.odoo.com/page/about-us">Our company</a></li>
                <li><a href="http://www.odoo.com/page/contactus">Contact</a></li>
                <li class="divider" />
                <li><a href="http://www.odoo.com/event">Events</a></li>
                <li><a href="http://www.odoo.com/blog/">Blog</a></li>
                <li><a href="http://www.odoo.com/blog/6">Customers</a></li>
                <li class="divider" />
                <li><a href="http://www.odoo.com/jobs">Jobs</a></li>
              </ul>
            </div>
          </div>
        </div>
        <div class="col-sm-5 col-md-4 col-md-offset-1 col-lg-5 col-lg-offset-1">
          <p>
            <small>
              Odoo is a suite of open source business apps that cover all your company needs: CRM, eCommerce, accounting, inventory, point of sale, project management, etc.
              <br/><br/>
              Odoo's unique value proposition is to be at the same time very easy to use and fully integrated.
            </small>
          </p>
        </div>
      </div>
    </div>
    <div class="o_footer_bottom">
      <div class="container">
        <a class="small" href="http://www.odoo.com/page/website-builder">Website made with <span class="o_logo o_logo_inverse o_logo_15"></span></a>
        <div class="social-links pull-right">
          <a href="http://www.odoo.com/web/about/facebook"><i class="fa fa-facebook"></i></a>
          <a href="http://www.odoo.com/web/about/twitter"><i class="fa fa-twitter"></i></a>
          <a href="http://www.odoo.com/web/about/linkedin"><i class="fa fa-linkedin"></i></a>
          <a href="mailto:info@odoo.com"><i class="fa fa-envelope"></i></a>
        </div>
      </div>
    </div>
  </footer>
  </body>
</html>