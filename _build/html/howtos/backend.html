<!doctype html>


<html xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  
    <title>构建模块 &mdash; odoo 9.0 文档</title>
    
    <link rel="stylesheet" href="../_static/style.css" type="text/css" />
    <link rel="stylesheet" href="../_static/pygments.css" type="text/css" />
    <link rel="stylesheet" href="../_static/patchqueue.css" type="text/css" />
    
    <script type="text/javascript">
      var DOCUMENTATION_OPTIONS = {
        URL_ROOT:    '../',
        VERSION:     '9.0',
        COLLAPSE_INDEX: false,
        FILE_SUFFIX: '.html',
        HAS_SOURCE:  true
      };
    </script>
    <script type="text/javascript" src="../_static/jquery.js"></script>
    <script type="text/javascript" src="../_static/underscore.js"></script>
    <script type="text/javascript" src="../_static/doctools.js"></script>
    <script type="text/javascript" src="../_static/translations.js"></script>
    <script type="text/javascript" src="../_static/patchqueue.js"></script>
    <script type="text/javascript" src="../_static/jquery.min.js"></script>
    <script type="text/javascript" src="../_static/bootstrap.js"></script>
    <script type="text/javascript" src="../_static/doc.js"></script>
    <script type="text/javascript" src="../_static/jquery.noconflict.js"></script>
    <link rel="top" title="odoo 9.0 文档" href="../index.html" />
    <link rel="up" title="Tutorials" href="../tutorials.html" />
    <link rel="next" title="建造界面扩展" href="web.html" />
    <link rel="prev" title="建造网站" href="website.html" /> 
  </head>
  <body role="document"><header class="o_main_header o_has_sub_nav o_inverted ">
    <div class="o_main_header_main">
      <a class="pull-left o_logo" href="/"></a>
      <a href="#" class="o_mobile_menu_toggle visible-xs-block pull-right">
        <span class="sr-only">Toggle navigation</span>
        <span class="mdi-navigation-menu"></span>
      </a>
      <div class="o_header_buttons">
        <a href="http://www.odoo.com/trial" class="btn btn-primary">Start Now</a>
      </div>
      <ul class="o_primary_nav">
        <li class="dropdown">
          <a href="#" class="dropdown-toggle">Apps</a>
          <div class="dropdown-menu o_secondary_nav">
            <div class="container">
              <div class="row">
                <div class="col-sm-3 o_website_apps">
                  <div class="o_nav_app_family">
                    <span></span> Websites
                    <div>Build great user experience</div>
                  </div>
                  <ul>
                    <li><a href="https://www.odoo.com/page/website-builder">Website Builder</a></li>
                    <li><a href="https://www.odoo.com/page/e-commerce">eCommerce</a></li>
                    <li><a href="https://www.odoo.com/page/blog-engine">Blogs</a></li>
                    <li><a href="https://www.odoo.com/page/community-builder">Forums</a></li>
                    <li><a href="https://www.odoo.com/page/slides">Slides</a></li>
                    <li><a href="https://adspike.odoo.com">SEA</a></li>
                  </ul>
                </div>
                <div class="col-sm-3 o_sale_apps">
                  <div class="o_nav_app_family">
                    <span></span> Sales
                    <div>Boost your success rate</div>
                  </div>
                  <ul>
                    <li><a href="https://www.odoo.com/page/sales">Sales</a></li>
                    <li><a href="https://www.odoo.com/page/crm">CRM</a></li>
                    <li><a href="https://www.odoo.com/page/billing">Invoicing</a></li>
                    <li class="dropdown">
                      <a href="#0" class="dropdown-toggle">Point of Sale</a>
                      <ul>
                        <li><a href="https://www.odoo.com/page/point-of-sale">Shops</a></li>
                        <li><a href="https://www.odoo.com/page/pos-restaurant">Restaurants</a></li>
                      </ul>
                    </li>
                    <li><a href="https://www.odoo.com/page/subscriptions">Subscriptions</a></li>
                    <li><a href="https://www.odoo.com/page/sign">Sign</a></li>
                  </ul>
                </div>
                <div class="col-sm-3 o_operation_apps">
                  <div class="o_nav_app_family">
                    <span></span> Operations
                    <div>It's all about efficiency</div>
                  </div>
                  <ul>
                    <li><a href="https://www.odoo.com/page/accounting/">Accounting</a></li>
                    <li><a href="https://www.odoo.com/page/project-management/">Project</a></li>
                    <li class="dropdown">
                      <a href="#0" class="dropdown-toggle">Human Resources</a>
                      <ul>
                        <li><a href="https://www.odoo.com/page/recruitment">Recruitment</a></li>
                        <li><a href="https://www.odoo.com/page/employees">Employees</a></li>
                        <li><a href="https://www.odoo.com/page/expenses">Expenses</a></li>
                        <li><a href="https://www.odoo.com/page/appraisal">Appraisal</a></li>
                        <li><a href="https://www.odoo.com/page/fleet">Fleet</a></li>
                        <li><a href="https://www.odoo.com/page/leaves">Leaves</a></li>
                      </ul>
                    </li>
                    <li><a href="https://www.odoo.com/page/warehouse">Inventory</a></li>
                    <li><a href="https://www.odoo.com/page/purchase">Purchase</a></li>
                    <li class="dropdown">
                      <a href="#0" class="dropdown-toggle">Manufacturing</a>
                      <ul>
                        <li><a href="https://www.odoo.com/page/manufacturing">MRP</a></li>
                        <li><a href="https://www.odoo.com/page/plm">PLM</a></li>
                        <li><a href="https://www.odoo.com/page/maintenance">Maintenance</a></li>
                        <li><a href="https://www.odoo.com/page/quality">Quality</a></li>
                      </ul>
                    </li>
                  </ul>
                </div>
                <div class="col-sm-3 o_productivity_apps">
                  <div class="o_nav_app_family">
                    <span></span> Productivity Tools
                    <div>Great Tools = Happy People</div>
                  </div>
                  <ul>
                    <li class="dropdown">
                      <a href="#0" class="dropdown-toggle">Communication</a>
                      <ul>
                        <li><a href="https://www.odoo.com/page/discuss">Discuss</a></li>
                        <li><a href="https://www.odoo.com/page/discuss-groups">Mailing Lists</a></li>
                        <li><a href="https://www.odoo.com/page/notes">Notes</a></li>
                        <li><a href="#">Help desk</a></li>
                        <li><a href="#">Appointment</a></li>
                      </ul>
                    </li>
                    <li><a href="https://www.odoo.com/page/timesheet">Timesheet</a></li>
                    <li><a href="https://www.odoo.com/page/email-marketing">Email Marketing</a></li>
                    <li><a href="https://www.odoo.com/page/events">Events</a></li>
                    <li><a href="https://www.odoo.com/page/survey">Survey</a></li>
                    <li><a href="https://www.odoo.com/page/live-chat">Live Chat</a></li>
                  </ul>
                </div>
              </div>
            </div>
            <a href="http://www.odoo.com/apps/modules" class="o_store_link"><i class="fa fa-cube fa-fw"></i> Third party apps</a>
          </div>
        </li>
        <li><a href="https://www.odoo.com/page/tour">Tour</a></li>
        <li><a href="https://www.odoo.com/pricing">Pricing</a></li>
        <li><a href="https://www.odoo.com/page/docs">Docs</a></li>
      </ul>
    </div>
    <nav class="navbar o_sub_nav">
      <div class="container">
        <div class="navbar-header visible-xs">
            <button type="button" class="navbar-toggle collapsed text-left btn-block" data-toggle="collapse" data-target="#o_sub-menu" aria-expanded="false">
              Navigate
              <span class="mdi-hardware-keyboard-arrow-down pull-right"></span>
            </button>
        </div>

        <div class="collapse navbar-collapse" id="o_sub-menu">
          <ol class="o_breadcrumb breadcrumb nav navbar-left">
              
              





    
        
            <li><a href="../index.html">Developer Doc</a></li>
        
    
    <li class="active"><a href="#">构建模块</a></li>

              
          </ol>

          <div class="call-to-action navbar-right hidden-xs">
            <a href="http://www.odoo.com/trial" class="btn btn-primary">Start Now</a>
          </div>

          <ul class="navbar-nav navbar-right nav o_sub_nav_actions">
            
              <li class="divider"></li>
            

            
            


            
          </ul>

          <ul class="nav navbar-nav navbar-right">
            

            
            

<li><a href="http://www.odoo.com/documentation/user/9.0/index.html">User</a></li>
<li><a href="http://www.odoo.com/documentation/9.0/index.html">Developer</a></li>
<li><a href="http://www.odoo.com/documentation/9.0/api_integration.html">API</a></li>
<li><a href="http://www.odoo.com/documentation/9.0/setup/install.html">Installation</a></li>
<li><a href="http://www.odoo.com/page/odoo-white-paper">White Papers</a></li>
<li><a href="http://www.odoo.com/page/legal">Legal</a></li>
            

            
          </ul>
        </div>
      </div>
    </nav>
  </header><div id="wrap" class="">
    
    
    
    <figure class="card top has_banner">
      <span class="card-img" style="background-image: url('../_static/banners/build_a_module.jpg');"></span>
      <div class="container text-center">
        <h1> 构建模块 </h1>
      </div>
    </figure>
    
    
    
    <div class="container ">
      <main class="container-fluid ">
        
        <div class="row">
          
          <aside>
            <div class="navbar-aside text-center">
              <ul class="list-group text-left nav"><li class="list-group-item"><a href="#start-stop-the-odoo-server" class="ripple internal reference">启动/停止Odoo服务器</a></li><li class="list-group-item"><a href="#build-an-odoo-module" class="ripple internal reference">构建Odoo模块</a><ul ><li class="list-group-item"><a href="#composition-of-a-module" class="ripple internal reference">一个模块的组成</a></li><li class="list-group-item"><a href="#module-structure" class="ripple internal reference">模块结构</a></li><li class="list-group-item"><a href="#object-relational-mapping" class="ripple internal reference">对象 - 关系映射</a></li><li class="list-group-item"><a href="#model-fields" class="ripple internal reference">模型字段</a><ul ><li class="list-group-item"><a href="#common-attributes" class="ripple internal reference">公共属性</a></li><li class="list-group-item"><a href="#simple-fields" class="ripple internal reference">简单字段</a></li><li class="list-group-item"><a href="#reserved-fields" class="ripple internal reference">保留字段</a></li><li class="list-group-item"><a href="#special-fields" class="ripple internal reference">特殊字段</a></li></ul></li><li class="list-group-item"><a href="#data-files" class="ripple internal reference">数据文件</a></li><li class="list-group-item"><a href="#actions-and-menus" class="ripple internal reference">动作和菜单</a></li></ul></li><li class="list-group-item"><a href="#basic-views" class="ripple internal reference">基本视图</a><ul ><li class="list-group-item"><a href="#generic-view-declaration" class="ripple internal reference">通用视图声明</a></li><li class="list-group-item"><a href="#tree-views" class="ripple internal reference">树状视图</a></li><li class="list-group-item"><a href="#form-views" class="ripple internal reference">表单视图</a></li><li class="list-group-item"><a href="#search-views" class="ripple internal reference">搜索视图</a></li></ul></li><li class="list-group-item"><a href="#relations-between-models" class="ripple internal reference">模型之间的关系</a><ul ><li class="list-group-item"><a href="#relational-fields" class="ripple internal reference">关系字段</a></li></ul></li><li class="list-group-item"><a href="#inheritance" class="ripple internal reference">继承</a><ul ><li class="list-group-item"><a href="#model-inheritance" class="ripple internal reference">模型继承</a></li><li class="list-group-item"><a href="#view-inheritance" class="ripple internal reference">视图继承</a><ul ><li class="list-group-item"><a href="#domains" class="ripple internal reference">域</a></li></ul></li></ul></li><li class="list-group-item"><a href="#computed-fields-and-default-values" class="ripple internal reference">计算字段和默认值</a><ul ><li class="list-group-item"><a href="#dependencies" class="ripple internal reference">依赖</a></li><li class="list-group-item"><a href="#default-values" class="ripple internal reference">默认值</a></li></ul></li><li class="list-group-item"><a href="#onchange" class="ripple internal reference">Onchange</a></li><li class="list-group-item"><a href="#model-constraints" class="ripple internal reference">模型的约束</a></li><li class="list-group-item"><a href="#advanced-views" class="ripple internal reference">高级视图</a><ul ><li class="list-group-item"><a href="#id3" class="ripple internal reference">树状视图</a></li><li class="list-group-item"><a href="#calendars" class="ripple internal reference">日历</a></li><li class="list-group-item"><a href="#id4" class="ripple internal reference">搜索视图</a></li><li class="list-group-item"><a href="#gantt" class="ripple internal reference">甘特</a></li><li class="list-group-item"><a href="#graph-views" class="ripple internal reference">图形视图</a></li><li class="list-group-item"><a href="#kanban" class="ripple internal reference">看板</a></li></ul></li><li class="list-group-item"><a href="#workflows" class="ripple internal reference">工作流程</a></li><li class="list-group-item"><a href="#security" class="ripple internal reference">安全</a><ul ><li class="list-group-item"><a href="#group-based-access-control-mechanisms" class="ripple internal reference">基于组的访问控制机制</a></li><li class="list-group-item"><a href="#access-rights" class="ripple internal reference">访问权限</a></li><li class="list-group-item"><a href="#record-rules" class="ripple internal reference">记录规则</a></li></ul></li><li class="list-group-item"><a href="#wizards" class="ripple internal reference">向导</a><ul ><li class="list-group-item"><a href="#launching-wizards" class="ripple internal reference">启动向导</a></li></ul></li><li class="list-group-item"><a href="#internationalization" class="ripple internal reference">国际化</a></li><li class="list-group-item"><a href="#reporting" class="ripple internal reference">报告</a><ul ><li class="list-group-item"><a href="#printed-reports" class="ripple internal reference">打印报告</a></li><li class="list-group-item"><a href="#dashboards" class="ripple internal reference">仪表板</a></li></ul></li><li class="list-group-item"><a href="#webservices" class="ripple internal reference">Web服务</a><ul ><li class="list-group-item"><a href="#xml-rpc-library" class="ripple internal reference">XML-RPC库</a></li><li class="list-group-item"><a href="#json-rpc-library" class="ripple internal reference">JSON-RPC库</a></li></ul></li></ul>
              
              <p class="gith-container"><a href="https://github.com/odoo/odoo/edit/9.0/doc/howtos/backend.rst" class="gith-link">
                  Edit on GitHub
              </a></p>
              
            </div>
          </aside>
          
          <article class="doc-body ">
            
            
  <section id="building-a-module"><div role="alert" class="alert-warning alert"><p class="alert-title">警告</p><p >This tutorial requires <a href="../setup/install.html#setup-install" class="internal alert-link reference"><span >having installed Odoo</span></a></p></div></section><section id="start-stop-the-odoo-server"><h2 >启动/停止Odoo服务器</h2><p >Odoo使用客户机/服务器体系结构，其中客户端的web浏览器访问通过RPC的Odoo服务器。</p><p >Business logic and extension is generally performed on the server side,
although supporting client features (e.g. new data representation such as
interactive maps) can be added to the client.</p><p >In order to start the server, simply invoke the command <a href="../reference/cmdline.html#reference-cmdline" class="internal reference"><span >odoo.py</span></a> in the shell, adding the full path to the file if
necessary:</p><div class="highlight-python code bash"><div class="highlight"><pre><span class="n">odoo</span><span class="o">.</span><span class="n">py</span>
</pre></div>
</div>
<p >服务器发生碰撞停止``按Ctrl-C``两次从终端，或者通过杀死相应的操作系统进程。</p></section><section id="build-an-odoo-module"><h2 >构建Odoo模块</h2><p >Both server and client extensions are packaged as <em >modules</em> which are
optionally loaded in a <em >database</em>.</p><p >Odoo modules can either add brand new business logic to an Odoo system, or
alter and extend existing business logic: a module can be created to add your
country's accounting rules to Odoo's generic accounting support, while the
next module adds support for real-time visualisation of a bus fleet.</p><p >在Odoo所有的一切都与模块开始和结束。</p></section><section id="composition-of-a-module"><h3 >一个模块的组成</h3><p >An Odoo module can contain a number of elements:</p><dl ><dt >业务对象</dt><dd ><p >声明为Python类，这些资源会自动Odoo根据其配置的坚持</p></dd><dt >数据文件</dt><dd >XML or CSV files declaring metadata (views or workflows), configuration
data (modules parameterization), demonstration data and more</dd><dt >网络控制器</dt><dd ><p >处理来自Web浏览器的请求</p></dd><dt >静态网页数据</dt><dd ><p >使用Web界面或网页图像，CSS或JavaScript文件</p></dd></dl></section><section id="module-structure"><h3 >模块结构</h3><p >Each module is a directory within a <em >module directory</em>. Module directories
are specified by using the <a href="../reference/cmdline.html#cmdoption-odoo.py--addons-path" class="internal reference"><code class="std xref std-option">--addons-path</code></a>
option.</p><div role="alert" class="alert-info aphorism alert"><p class="alert-title">小技巧</p><p >most command-line options can also be set using <a href="../reference/cmdline.html#reference-cmdline-config" class="internal alert-link reference"><span >a configuration
file</span></a></p></div><p >An Odoo module is declared by its <a href="../reference/module.html#reference-module-manifest" class="internal reference"><span >manifest</span></a>.
See the <a href="../reference/module.html#reference-module-manifest" class="internal reference"><span >manifest documentation</span></a> information
about it.</p><p >A module is also a
<a href="http://docs.python.org/2/tutorial/modules.html#packages" class="external reference">Python package</a>
with a <code >__init__.py</code> file, containing import instructions for various Python
files in the module.</p><p >For instance, if the module has a single <code >mymodule.py</code> file <code >__init__.py</code>
might contain:</p><div class="highlight-python"><div class="highlight"><pre><span class="kn">from</span> <span class="nn">.</span> <span class="kn">import</span> <span class="n">mymodule</span>
</pre></div>
</div>
<p >Odoo provides a mechanism to help set up a new module, <a href="../reference/cmdline.html#reference-cmdline-server" class="internal reference"><span >odoo.py</span></a> has a subcommand <a href="../reference/cmdline.html#reference-cmdline-scaffold" class="internal reference"><span >scaffold</span></a> to create an empty module:</p><div class="highlight-console"><div class="highlight"><pre><span class="gp">$</span> odoo.py scaffold &lt;module name&gt; &lt;where to put it&gt;
</pre></div>
</div>
<p >该命令为你的模块的子目录，并自动为模块创建了一堆的标准文件。他们大多只包含注释代码或XML。大部分这些文件的使用将沿着这个教程来解释。</p><div role="alert" class="alert-exercise alert"><p class="alert-title">Exercise</p><p >模块创建</p><p >使用上面的命令行创建一个空的模块开放学院，并在Odoo安装。</p></div></section><section id="object-relational-mapping"><h3 >对象 - 关系映射</h3><p >A key component of Odoo is the <abbr title="Object-Relational Mapping">ORM</abbr> layer.
This layer avoids having to write most <abbr title="Structured Query Language">SQL</abbr>
by hand and provides extensibility and security services<a href="#rawsql" class="footnote-ref" id="id1">2</a>.</p><p >Business objects are declared as Python classes extending
<code class="py xref py-class">Model</code> which integrates them into the automated
persistence system.</p><p >Models can be configured by setting a number of attributes at their
definition. The most important attribute is
<code class="py xref py-attr">_name</code> which is required and defines the name for
the model in the Odoo system. Here is a minimally complete definition of a
model:</p><div class="highlight-python"><div class="highlight"><pre><span class="kn">from</span> <span class="nn">openerp</span> <span class="kn">import</span> <span class="n">models</span>
<span class="k">class</span> <span class="nc">MinimalModel</span><span class="p">(</span><span class="n">models</span><span class="o">.</span><span class="n">Model</span><span class="p">):</span>
    <span class="n">_name</span> <span class="o">=</span> <span class="s">&#39;test.model&#39;</span>
</pre></div>
</div>
</section><section id="model-fields"><h3 >模型字段</h3><p >Fields are used to define what the model can store and where. Fields are
defined as attributes on the model class:</p><div class="highlight-python"><div class="highlight"><pre><span class="kn">from</span> <span class="nn">openerp</span> <span class="kn">import</span> <span class="n">models</span><span class="p">,</span> <span class="n">fields</span>

<span class="k">class</span> <span class="nc">LessMinimalModel</span><span class="p">(</span><span class="n">models</span><span class="o">.</span><span class="n">Model</span><span class="p">):</span>
    <span class="n">_name</span> <span class="o">=</span> <span class="s">&#39;test.model2&#39;</span>

    <span class="n">name</span> <span class="o">=</span> <span class="n">fields</span><span class="o">.</span><span class="n">Char</span><span class="p">()</span>
</pre></div>
</div>
</section><section id="common-attributes"><h4 >公共属性</h4><p >Much like the model itself, its fields can be configured, by passing
configuration attributes as parameters:</p><div class="highlight-python"><div class="highlight"><pre><span class="n">name</span> <span class="o">=</span> <span class="n">field</span><span class="o">.</span><span class="n">Char</span><span class="p">(</span><span class="n">required</span><span class="o">=</span><span class="bp">True</span><span class="p">)</span>
</pre></div>
</div>
<p >Some attributes are available on all fields, here are the most common ones:</p><dl ><dt ><code class="py xref py-attr">string</code> (<code >unicode</code>, default: field's name)</dt><dd >The label of the field in UI (visible by users).</dd><dt ><code class="py xref py-attr">required</code> (<code >bool</code>, default: <code >False</code>)</dt><dd ><p >如果``True``，那么该字段不能为空，它必须拥有一个默认值或总是创建一个记录时被赋予的值。</p></dd><dt ><code class="py xref py-attr">help</code> (<code >unicode</code>, default: <code >''</code>)</dt><dd ><p >长的形式，提供了一种帮助工具提示用户在UI中。</p></dd><dt ><code class="py xref py-attr">index</code> (<code >bool</code>, default: <code >False</code>)</dt><dd ><p >请在列Odoo创建'数据库index`_</p></dd></dl></section><section id="simple-fields"><h4 >简单字段</h4><p >There are two broad categories of fields: &quot;simple&quot; fields which are atomic
values stored directly in the model's table and &quot;relational&quot; fields linking
records (of the same model or of different models).</p><p >Example of simple fields are <code class="py xref py-class">Boolean</code>,
<code class="py xref py-class">Date</code>, <code class="py xref py-class">Char</code>.</p></section><section id="reserved-fields"><h4 >保留字段</h4><p >Odoo creates a few fields in all models<a href="#autofields" class="footnote-ref" id="id2">1</a>. These fields are
managed by the system and shouldn't be written to. They can be read if
useful or necessary:</p><dl ><dt ><code class="py xref py-attr">id</code> (<code class="py xref py-class">Id</code>)</dt><dd ><p >在其模型中记录的唯一标识符</p></dd><dt ><code class="py xref py-attr">create_date</code> (<code class="py xref py-class">Datetime</code>)</dt><dd ><p >记录的创建日期</p></dd><dt ><code class="py xref py-attr">create_uid</code> (<code class="py xref py-class">Many2one</code>)</dt><dd ><p >谁创造了记录用户</p></dd><dt ><code class="py xref py-attr">write_date</code> (<code class="py xref py-class">Datetime</code>)</dt><dd ><p >记录的最后修改日期</p></dd><dt ><code class="py xref py-attr">write_uid</code> (<code class="py xref py-class">Many2one</code>)</dt><dd ><p >用户谁最后修改过的记录</p></dd></dl></section><section id="special-fields"><h4 >特殊字段</h4><p >By default, Odoo also requires a <code >name</code> field on all models for various
display and search behaviors. The field used for these purposes can be
overridden by setting <code class="py xref py-attr">_rec_name</code>.</p><div role="alert" class="alert-exercise alert"><p class="alert-title">Exercise</p><p >定义一个模型</p><p >Define a new data model <em >Course</em> in the <em >openacademy</em> module. A course
has a title and a description. Courses must have a title.</p></div></section><section id="data-files"><h3 >数据文件</h3><p >Odoo是一个高度数据驱动的系统。虽然行为是使用一个模块的价值Python_代码的一部分定制是它建立加载时的数据。</p><div role="alert" class="alert-info aphorism alert"><p class="alert-title">小技巧</p><p >一些模块的存在仅仅将数据添加到Odoo</p></div><p >Module data is declared via <a href="../reference/data.html#reference-data" class="internal reference"><span >data files</span></a>, XML files with
<code >&lt;record&gt;</code> elements. Each <code >&lt;record&gt;</code> element creates or updates a database
record.</p><div class="highlight-xml"><div class="highlight"><pre><span class="nt">&lt;openerp&gt;</span>
    <span class="nt">&lt;data&gt;</span>
        <span class="nt">&lt;record</span> <span class="na">model=</span><span class="s">&quot;{model name}&quot;</span> <span class="na">id=</span><span class="s">&quot;{record identifier}&quot;</span><span class="nt">&gt;</span>
            <span class="nt">&lt;field</span> <span class="na">name=</span><span class="s">&quot;{a field name}&quot;</span><span class="nt">&gt;</span>{a value}<span class="nt">&lt;/field&gt;</span>
        <span class="nt">&lt;/record&gt;</span>
    <span class="nt">&lt;/data&gt;</span>
<span class="nt">&lt;/openerp&gt;</span>
</pre></div>
</div>
<ul ><li ><p >[UNKNOWN NODE problematic]model``是Odoo型号为记录的名称</p></li><li ><code >id</code> is an <a href="../glossary.html#term-external-identifier" class="internal reference"><span class="std std-term xref">external identifier</span></a>, it allows referring to the record
(without having to know its in-database identifier)</li><li ><code >&lt;field&gt;</code> elements have a <code >name</code> which is the name of the field in the
model (e.g. <code >description</code>). Their body is the field's value.</li></ul><p >Data files have to be declared in the manifest file to be loaded, they can
be declared in the <code >'data'</code> list (always loaded) or in the <code >'demo'</code> list
(only loaded in demonstration mode).</p><div role="alert" class="alert-exercise alert"><p class="alert-title">Exercise</p><p >定义演示数据</p><p >Create demonstration data filling the <em >Courses</em> model with a few
demonstration courses.</p></div></section><section id="actions-and-menus"><h3 >动作和菜单</h3><p >Actions and menus are regular records in database, usually declared through
data files. Actions can be triggered in three ways:</p><ol ><li >by clicking on menu items (linked to specific actions)</li><li >by clicking on buttons in views (if these are connected to actions)</li><li ><p >在对象上下文动作</p></li></ol><p >Because menus are somewhat complex to declare there is a <code >&lt;menuitem&gt;</code>
shortcut to declare an <code >ir.ui.menu</code> and connect it to the corresponding
action more easily.</p><div class="highlight-xml"><div class="highlight"><pre><span class="nt">&lt;record</span> <span class="na">model=</span><span class="s">&quot;ir.actions.act_window&quot;</span> <span class="na">id=</span><span class="s">&quot;action_list_ideas&quot;</span><span class="nt">&gt;</span>
    <span class="nt">&lt;field</span> <span class="na">name=</span><span class="s">&quot;name&quot;</span><span class="nt">&gt;</span>Ideas<span class="nt">&lt;/field&gt;</span>
    <span class="nt">&lt;field</span> <span class="na">name=</span><span class="s">&quot;res_model&quot;</span><span class="nt">&gt;</span>idea.idea<span class="nt">&lt;/field&gt;</span>
    <span class="nt">&lt;field</span> <span class="na">name=</span><span class="s">&quot;view_mode&quot;</span><span class="nt">&gt;</span>tree,form<span class="nt">&lt;/field&gt;</span>
<span class="nt">&lt;/record&gt;</span>
<span class="nt">&lt;menuitem</span> <span class="na">id=</span><span class="s">&quot;menu_ideas&quot;</span> <span class="na">parent=</span><span class="s">&quot;menu_root&quot;</span> <span class="na">name=</span><span class="s">&quot;Ideas&quot;</span> <span class="na">sequence=</span><span class="s">&quot;10&quot;</span>
          <span class="na">action=</span><span class="s">&quot;action_list_ideas&quot;</span><span class="nt">/&gt;</span>
</pre></div>
</div>
<div role="alert" class="alert-danger aphorism alert"><p class="alert-title">危险</p><p >动作一定XML文件中其相应的菜单之前声明。</p><p >数据的文件被顺序执行时，动作的``id``必须存在在数据库中，可以创建菜单之前。</p></div><div role="alert" class="alert-exercise alert"><p class="alert-title">Exercise</p><p >定义新的菜单项</p><p >Define new menu entries to access courses under the
OpenAcademy menu entry. A user should be able to</p><ul ><li ><p >显示所有课程的列表</p></li><li ><p >创建/修改课程</p></li></ul></div></section><section id="basic-views"><h2 >基本视图</h2><p >Views define the way the records of a model are displayed. Each type of view
represents a mode of visualization (a list of records, a graph of their
aggregation, …). Views can either be requested generically via their type
(e.g. <em >a list of partners</em>) or specifically via their id. For generic
requests, the view with the correct type and the lowest priority will be
used (so the lowest-priority view of each type is the default view for that
type).</p><p ><a href="../reference/views.html#reference-views-inheritance" class="internal reference"><span >View inheritance</span></a> allows altering views
declared elsewhere (adding or removing content).</p></section><section id="generic-view-declaration"><h3 >通用视图声明</h3><p >A view is declared as a record of the model <code >ir.ui.view</code>. The view type
is implied by the root element of the <code >arch</code> field:</p><div class="highlight-xml"><div class="highlight"><pre><span class="nt">&lt;record</span> <span class="na">model=</span><span class="s">&quot;ir.ui.view&quot;</span> <span class="na">id=</span><span class="s">&quot;view_id&quot;</span><span class="nt">&gt;</span>
    <span class="nt">&lt;field</span> <span class="na">name=</span><span class="s">&quot;name&quot;</span><span class="nt">&gt;</span>view.name<span class="nt">&lt;/field&gt;</span>
    <span class="nt">&lt;field</span> <span class="na">name=</span><span class="s">&quot;model&quot;</span><span class="nt">&gt;</span>object_name<span class="nt">&lt;/field&gt;</span>
    <span class="nt">&lt;field</span> <span class="na">name=</span><span class="s">&quot;priority&quot;</span> <span class="na">eval=</span><span class="s">&quot;16&quot;</span><span class="nt">/&gt;</span>
    <span class="nt">&lt;field</span> <span class="na">name=</span><span class="s">&quot;arch&quot;</span> <span class="na">type=</span><span class="s">&quot;xml&quot;</span><span class="nt">&gt;</span>
        <span class="c">&lt;!-- view content: &lt;form&gt;, &lt;tree&gt;, &lt;graph&gt;, ... --&gt;</span>
    <span class="nt">&lt;/field&gt;</span>
<span class="nt">&lt;/record&gt;</span>
</pre></div>
</div>
<div role="alert" class="alert-danger aphorism alert"><p class="alert-title">危险</p><p >该视图的内容是XML。</p><p >The <code >arch</code> field must thus be declared as <code >type=&quot;xml&quot;</code> to be parsed
correctly.</p></div></section><section id="tree-views"><h3 >树状视图</h3><p >树视图，也称为列表视图，显示记录以表格的形式。</p><p >Their root element is <code >&lt;tree&gt;</code>. The simplest form of the tree view simply
lists all the fields to display in the table (each field as a column):</p><div class="highlight-xml"><div class="highlight"><pre><span class="nt">&lt;tree</span> <span class="na">string=</span><span class="s">&quot;Idea list&quot;</span><span class="nt">&gt;</span>
    <span class="nt">&lt;field</span> <span class="na">name=</span><span class="s">&quot;name&quot;</span><span class="nt">/&gt;</span>
    <span class="nt">&lt;field</span> <span class="na">name=</span><span class="s">&quot;inventor_id&quot;</span><span class="nt">/&gt;</span>
<span class="nt">&lt;/tree&gt;</span>
</pre></div>
</div>
</section><section id="form-views"><h3 >表单视图</h3><p >表单用于创建和编辑一个记录。</p><p >Their root element is <code >&lt;form&gt;</code>. They composed of high-level structure
elements (groups, notebooks) and interactive elements (buttons and fields):</p><div class="highlight-xml"><div class="highlight"><pre><span class="nt">&lt;form</span> <span class="na">string=</span><span class="s">&quot;Idea form&quot;</span><span class="nt">&gt;</span>
    <span class="nt">&lt;group</span> <span class="na">colspan=</span><span class="s">&quot;4&quot;</span><span class="nt">&gt;</span>
        <span class="nt">&lt;group</span> <span class="na">colspan=</span><span class="s">&quot;2&quot;</span> <span class="na">col=</span><span class="s">&quot;2&quot;</span><span class="nt">&gt;</span>
            <span class="nt">&lt;separator</span> <span class="na">string=</span><span class="s">&quot;General stuff&quot;</span> <span class="na">colspan=</span><span class="s">&quot;2&quot;</span><span class="nt">/&gt;</span>
            <span class="nt">&lt;field</span> <span class="na">name=</span><span class="s">&quot;name&quot;</span><span class="nt">/&gt;</span>
            <span class="nt">&lt;field</span> <span class="na">name=</span><span class="s">&quot;inventor_id&quot;</span><span class="nt">/&gt;</span>
        <span class="nt">&lt;/group&gt;</span>

        <span class="nt">&lt;group</span> <span class="na">colspan=</span><span class="s">&quot;2&quot;</span> <span class="na">col=</span><span class="s">&quot;2&quot;</span><span class="nt">&gt;</span>
            <span class="nt">&lt;separator</span> <span class="na">string=</span><span class="s">&quot;Dates&quot;</span> <span class="na">colspan=</span><span class="s">&quot;2&quot;</span><span class="nt">/&gt;</span>
            <span class="nt">&lt;field</span> <span class="na">name=</span><span class="s">&quot;active&quot;</span><span class="nt">/&gt;</span>
            <span class="nt">&lt;field</span> <span class="na">name=</span><span class="s">&quot;invent_date&quot;</span> <span class="na">readonly=</span><span class="s">&quot;1&quot;</span><span class="nt">/&gt;</span>
        <span class="nt">&lt;/group&gt;</span>

        <span class="nt">&lt;notebook</span> <span class="na">colspan=</span><span class="s">&quot;4&quot;</span><span class="nt">&gt;</span>
            <span class="nt">&lt;page</span> <span class="na">string=</span><span class="s">&quot;Description&quot;</span><span class="nt">&gt;</span>
                <span class="nt">&lt;field</span> <span class="na">name=</span><span class="s">&quot;description&quot;</span> <span class="na">nolabel=</span><span class="s">&quot;1&quot;</span><span class="nt">/&gt;</span>
            <span class="nt">&lt;/page&gt;</span>
        <span class="nt">&lt;/notebook&gt;</span>

        <span class="nt">&lt;field</span> <span class="na">name=</span><span class="s">&quot;state&quot;</span><span class="nt">/&gt;</span>
    <span class="nt">&lt;/group&gt;</span>
<span class="nt">&lt;/form&gt;</span>
</pre></div>
</div>
<div role="alert" class="alert-exercise alert"><p class="alert-title">Exercise</p><p >使用XML自定义表单视图</p><p >Create your own form view for the Course object. Data displayed should be:
the name and the description of the course.</p></div><div role="alert" class="alert-exercise alert"><p class="alert-title">Exercise</p><p >笔记本</p><p >在课程表视图，把描述字段选项卡下，这样它会更容易在以后添加其他标签，包含附加信息。</p></div><p >Form views can also use plain HTML for more flexible layouts:</p><div class="highlight-xml"><div class="highlight"><pre><span class="nt">&lt;form</span> <span class="na">string=</span><span class="s">&quot;Idea Form&quot;</span><span class="nt">&gt;</span>
    <span class="nt">&lt;header&gt;</span>
        <span class="nt">&lt;button</span> <span class="na">string=</span><span class="s">&quot;Confirm&quot;</span> <span class="na">type=</span><span class="s">&quot;object&quot;</span> <span class="na">name=</span><span class="s">&quot;action_confirm&quot;</span>
                <span class="na">states=</span><span class="s">&quot;draft&quot;</span> <span class="na">class=</span><span class="s">&quot;oe_highlight&quot;</span> <span class="nt">/&gt;</span>
        <span class="nt">&lt;button</span> <span class="na">string=</span><span class="s">&quot;Mark as done&quot;</span> <span class="na">type=</span><span class="s">&quot;object&quot;</span> <span class="na">name=</span><span class="s">&quot;action_done&quot;</span>
                <span class="na">states=</span><span class="s">&quot;confirmed&quot;</span> <span class="na">class=</span><span class="s">&quot;oe_highlight&quot;</span><span class="nt">/&gt;</span>
        <span class="nt">&lt;button</span> <span class="na">string=</span><span class="s">&quot;Reset to draft&quot;</span> <span class="na">type=</span><span class="s">&quot;object&quot;</span> <span class="na">name=</span><span class="s">&quot;action_draft&quot;</span>
                <span class="na">states=</span><span class="s">&quot;confirmed,done&quot;</span> <span class="nt">/&gt;</span>
        <span class="nt">&lt;field</span> <span class="na">name=</span><span class="s">&quot;state&quot;</span> <span class="na">widget=</span><span class="s">&quot;statusbar&quot;</span><span class="nt">/&gt;</span>
    <span class="nt">&lt;/header&gt;</span>
    <span class="nt">&lt;sheet&gt;</span>
        <span class="nt">&lt;div</span> <span class="na">class=</span><span class="s">&quot;oe_title&quot;</span><span class="nt">&gt;</span>
            <span class="nt">&lt;label</span> <span class="na">for=</span><span class="s">&quot;name&quot;</span> <span class="na">class=</span><span class="s">&quot;oe_edit_only&quot;</span> <span class="na">string=</span><span class="s">&quot;Idea Name&quot;</span> <span class="nt">/&gt;</span>
            <span class="nt">&lt;h1&gt;&lt;field</span> <span class="na">name=</span><span class="s">&quot;name&quot;</span> <span class="nt">/&gt;&lt;/h1&gt;</span>
        <span class="nt">&lt;/div&gt;</span>
        <span class="nt">&lt;separator</span> <span class="na">string=</span><span class="s">&quot;General&quot;</span> <span class="na">colspan=</span><span class="s">&quot;2&quot;</span> <span class="nt">/&gt;</span>
        <span class="nt">&lt;group</span> <span class="na">colspan=</span><span class="s">&quot;2&quot;</span> <span class="na">col=</span><span class="s">&quot;2&quot;</span><span class="nt">&gt;</span>
            <span class="nt">&lt;field</span> <span class="na">name=</span><span class="s">&quot;description&quot;</span> <span class="na">placeholder=</span><span class="s">&quot;Idea description...&quot;</span> <span class="nt">/&gt;</span>
        <span class="nt">&lt;/group&gt;</span>
    <span class="nt">&lt;/sheet&gt;</span>
<span class="nt">&lt;/form&gt;</span>
</pre></div>
</div>
</section><section id="search-views"><h3 >搜索视图</h3><p >Search views customize the search field associated with the list view (and
other aggregated views). Their root element is <code >&lt;search&gt;</code> and they're
composed of fields defining which fields can be searched on:</p><div class="highlight-xml"><div class="highlight"><pre><span class="nt">&lt;search&gt;</span>
    <span class="nt">&lt;field</span> <span class="na">name=</span><span class="s">&quot;name&quot;</span><span class="nt">/&gt;</span>
    <span class="nt">&lt;field</span> <span class="na">name=</span><span class="s">&quot;inventor_id&quot;</span><span class="nt">/&gt;</span>
<span class="nt">&lt;/search&gt;</span>
</pre></div>
</div>
<p >如果没有搜索视图存在的模式，Odoo生成一个只允许搜索的``name``字段。</p><div role="alert" class="alert-exercise alert"><p class="alert-title">Exercise</p><p >搜索课程</p><p >允许搜索基于其标题或对它们的描述课程。</p></div></section><section id="relations-between-models"><h2 >模型之间的关系</h2><p >从模型的记录，可能与从另一个模型的记录。例如，一个销售订单记录是与一个包含客户端数据的客户记录;这也关系到其销售订单行记录。</p><div role="alert" class="alert-exercise alert"><p class="alert-title">Exercise</p><p >创建一个会话模型</p><p >For the module Open Academy, we consider a model for <em >sessions</em>: a session
is an occurrence of a course taught at a given time for a given audience.</p><p >Create a model for <em >sessions</em>. A session has a name, a start date, a
duration and a number of seats. Add an action and a menu item to display
them. Make the new model visible via a menu item.</p></div></section><section id="relational-fields"><h3 >关系字段</h3><p >Relational fields link records, either of the same model (hierarchies) or
between different models.</p><p >Relational field types are:</p><dl ><dt ><code class="py xref py-class">Many2one(other_model, ondelete='set null')</code></dt><dd ><p >A simple link to an other object:</p><div class="highlight-python"><div class="highlight"><pre><span class="k">print</span> <span class="n">foo</span><span class="o">.</span><span class="n">other_id</span><span class="o">.</span><span class="n">name</span>
</pre></div>
</div>
<div role="alert" class="alert-go_to alert"><p class="alert-title">参见</p><p ><a href="http://www.postgresql.org/docs/9.3/static/tutorial-fk.html" class="external reference alert-link">foreign keys</a></p></div></dd><dt ><code class="py xref py-class">One2many(other_model, related_field)</code></dt><dd ><p >A virtual relationship, inverse of a <code class="py xref py-class">Many2one</code>.
A <code class="py xref py-class">One2many</code> behaves as a container of records,
accessing it results in a (possibly empty) set of records:</p><div class="highlight-python"><div class="highlight"><pre><span class="k">for</span> <span class="n">other</span> <span class="ow">in</span> <span class="n">foo</span><span class="o">.</span><span class="n">other_ids</span><span class="p">:</span>
    <span class="k">print</span> <span class="n">other</span><span class="o">.</span><span class="n">name</span>
</pre></div>
</div>
<div role="alert" class="alert-danger alert"><p class="alert-title">危险</p><p >Because a <code class="py xref py-class">One2many</code> is a virtual relationship,
there <em >must</em> be a <code class="py xref py-class">Many2one</code> field in the
<code class="samp"><em >other_model</em></code>, and its name <em >must</em> be <code class="samp"><em >related_field</em></code></p></div></dd><dt ><code class="py xref py-class">Many2many(other_model)</code></dt><dd ><p >Bidirectional multiple relationship, any record on one side can be related
to any number of records on the other side. Behaves as a container of
records, accessing it also results in a possibly empty set of records:</p><div class="highlight-python"><div class="highlight"><pre><span class="k">for</span> <span class="n">other</span> <span class="ow">in</span> <span class="n">foo</span><span class="o">.</span><span class="n">other_ids</span><span class="p">:</span>
    <span class="k">print</span> <span class="n">other</span><span class="o">.</span><span class="n">name</span>
</pre></div>
</div>
</dd></dl><div role="alert" class="alert-exercise alert"><p class="alert-title">Exercise</p><p >Many2one关系</p><p >Using a many2one, modify the <em >Course</em> and <em >Session</em> models to reflect their
relation with other models:</p><ul ><li >A course has a <em >responsible</em> user; the value of that field is a record of
the built-in model <code >res.users</code>.</li><li >A session has an <em >instructor</em>; the value of that field is a record of the
built-in model <code >res.partner</code>.</li><li >A session is related to a <em >course</em>; the value of that field is a record
of the model <code >openacademy.course</code> and is required.</li><li ><p >采用视图。</p></li></ul></div><div role="alert" class="alert-exercise alert"><p class="alert-title">Exercise</p><p >反向one2many关系</p><p >使用逆关系字段one2many，修改模型，以反映课程和会议之间的关系。</p></div><div role="alert" class="alert-exercise alert"><p class="alert-title">Exercise</p><p >多重many2many关系</p><p >Using the relational field many2many, modify the <em >Session</em> model to relate
every session to a set of <em >attendees</em>. Attendees will be represented by
partner records, so we will relate to the built-in model <code >res.partner</code>.
Adapt the views accordingly.</p></div></section><section id="inheritance"><h2 >继承</h2></section><section id="model-inheritance"><h3 >模型继承</h3><p >Odoo provides two <em >inheritance</em> mechanisms to extend an existing model in a
modular way.</p><p >The first inheritance mechanism allows a module to modify the behavior of a
model defined in another module:</p><ul ><li ><p >字段添加到模型，</p></li><li ><p >覆盖在模型字段的定义，</p></li><li ><p >添加约束到一个模型，</p></li><li ><p >方法添加到模型，</p></li><li ><p >覆盖在模型上现有的方法。</p></li></ul><p >The second inheritance mechanism (delegation) allows to link every record of a
model to a record in a parent model, and provides transparent access to the
fields of the parent record.</p><img src="../_images/inheritance_methods.png" class="img-responsive center-block"><div role="alert" class="alert-go_to alert"><p class="alert-title">参见</p><ul ><li ><code class="py xref py-attr">_inherit</code></li><li ><code class="py xref py-attr">_inherits</code></li></ul></div></section><section id="view-inheritance"><h3 >视图继承</h3><p >Instead of modifying existing views in place (by overwriting them), Odoo
provides view inheritance where children &quot;extension&quot; views are applied on top of
root views, and can add or remove content from their parent.</p><p >An extension view references its parent using the <code >inherit_id</code> field, and
instead of a single view its <code >arch</code> field is composed of any number of
<code >xpath</code> elements selecting and altering the content of their parent view:</p><div class="highlight-xml"><div class="highlight"><pre><span class="c">&lt;!-- improved idea categories list --&gt;</span>
<span class="nt">&lt;record</span> <span class="na">id=</span><span class="s">&quot;idea_category_list2&quot;</span> <span class="na">model=</span><span class="s">&quot;ir.ui.view&quot;</span><span class="nt">&gt;</span>
    <span class="nt">&lt;field</span> <span class="na">name=</span><span class="s">&quot;name&quot;</span><span class="nt">&gt;</span>id.category.list2<span class="nt">&lt;/field&gt;</span>
    <span class="nt">&lt;field</span> <span class="na">name=</span><span class="s">&quot;model&quot;</span><span class="nt">&gt;</span>idea.category<span class="nt">&lt;/field&gt;</span>
    <span class="nt">&lt;field</span> <span class="na">name=</span><span class="s">&quot;inherit_id&quot;</span> <span class="na">ref=</span><span class="s">&quot;id_category_list&quot;</span><span class="nt">/&gt;</span>
    <span class="nt">&lt;field</span> <span class="na">name=</span><span class="s">&quot;arch&quot;</span> <span class="na">type=</span><span class="s">&quot;xml&quot;</span><span class="nt">&gt;</span>
        <span class="c">&lt;!-- find field description and add the field</span>
<span class="c">             idea_ids after it --&gt;</span>
        <span class="nt">&lt;xpath</span> <span class="na">expr=</span><span class="s">&quot;//field[@name=&#39;description&#39;]&quot;</span> <span class="na">position=</span><span class="s">&quot;after&quot;</span><span class="nt">&gt;</span>
          <span class="nt">&lt;field</span> <span class="na">name=</span><span class="s">&quot;idea_ids&quot;</span> <span class="na">string=</span><span class="s">&quot;Number of ideas&quot;</span><span class="nt">/&gt;</span>
        <span class="nt">&lt;/xpath&gt;</span>
    <span class="nt">&lt;/field&gt;</span>
<span class="nt">&lt;/record&gt;</span>
</pre></div>
</div>
<dl ><dt ><code >expr</code></dt><dd ><p >一个XPath_表情选择在父视图中的单个元素。引发错误，如果它没有元素或多于一个的匹配</p></dd><dt ><code >position</code></dt><dd ><p >Operation to apply to the matched element:</p><dl ><dt ><code >inside</code></dt><dd ><p >追加``在匹配元素的结束xpath``的身体</p></dd><dt ><code >replace</code></dt><dd ><p >由``xpath``的身体替换匹配元素</p></dd><dt ><code >before</code></dt><dd ><p >插入``xpath``的身体匹配的元素之前同级</p></dd><dt ><code >after</code></dt><dd ><p >插入``xpaths``的身体作为匹配的元素后，同级</p></dd><dt ><code >attributes</code></dt><dd ><p >改变匹配元素的使用特殊的``attribute``元素的属性在``xpath``的身体</p></dd></dl></dd></dl><div role="alert" class="alert-info alert"><p class="alert-title">小技巧</p><p >When matching a single element, the <code >position</code> attribute can be set directly
on the element to be found. Both inheritances below will give the same result.</p><div class="highlight-xml"><div class="highlight"><pre><span class="nt">&lt;xpath</span> <span class="na">expr=</span><span class="s">&quot;//field[@name=&#39;description&#39;]&quot;</span> <span class="na">position=</span><span class="s">&quot;after&quot;</span><span class="nt">&gt;</span>
    <span class="nt">&lt;field</span> <span class="na">name=</span><span class="s">&quot;idea_ids&quot;</span> <span class="nt">/&gt;</span>
<span class="nt">&lt;/xpath&gt;</span>

<span class="nt">&lt;field</span> <span class="na">name=</span><span class="s">&quot;description&quot;</span> <span class="na">position=</span><span class="s">&quot;after&quot;</span><span class="nt">&gt;</span>
    <span class="nt">&lt;field</span> <span class="na">name=</span><span class="s">&quot;idea_ids&quot;</span> <span class="nt">/&gt;</span>
<span class="nt">&lt;/field&gt;</span>
</pre></div>
</div>
</div><div role="alert" class="alert-exercise alert"><p class="alert-title">Exercise</p><p >改变现有的内容</p><ul ><li >Using model inheritance, modify the existing <em >Partner</em> model to add an
<code >instructor</code> boolean field, and a many2many field that corresponds to
the session-partner relation</li><li ><p >使用视图继承，显示在合作伙伴的形式针对这一字段</p></li></ul></div></section><section id="domains"><h4 >域</h4><p >In Odoo, <a href="../reference/orm.html#reference-orm-domains" class="internal reference"><span >域</span></a> are values that encode conditions on
records. A domain is a  list of criteria used to select a subset of a model's
records. Each criteria is a triple with a field name, an operator and a value.</p><p >For instance, when used on the <em >Product</em> model the following domain selects
all <em >services</em> with a unit price over <em >1000</em>:</p><div class="highlight-python"><div class="highlight"><pre><span class="p">[(</span><span class="s">&#39;product_type&#39;</span><span class="p">,</span> <span class="s">&#39;=&#39;</span><span class="p">,</span> <span class="s">&#39;service&#39;</span><span class="p">),</span> <span class="p">(</span><span class="s">&#39;unit_price&#39;</span><span class="p">,</span> <span class="s">&#39;&gt;&#39;</span><span class="p">,</span> <span class="mi">1000</span><span class="p">)]</span>
</pre></div>
</div>
<p >By default criteria are combined with an implicit AND. The logical operators
<code >&amp;</code> (AND), <code >|</code> (OR) and <code >!</code> (NOT) can be used to explicitly combine
criteria. They are used in prefix position (the operator is inserted before
its arguments rather than between). For instance to select products &quot;which are
services <em >OR</em> have a unit price which is <em >NOT</em> between 1000 and 2000&quot;:</p><div class="highlight-python"><div class="highlight"><pre><span class="p">[</span><span class="s">&#39;|&#39;</span><span class="p">,</span>
    <span class="p">(</span><span class="s">&#39;product_type&#39;</span><span class="p">,</span> <span class="s">&#39;=&#39;</span><span class="p">,</span> <span class="s">&#39;service&#39;</span><span class="p">),</span>
    <span class="s">&#39;!&#39;</span><span class="p">,</span> <span class="s">&#39;&amp;&#39;</span><span class="p">,</span>
        <span class="p">(</span><span class="s">&#39;unit_price&#39;</span><span class="p">,</span> <span class="s">&#39;&gt;=&#39;</span><span class="p">,</span> <span class="mi">1000</span><span class="p">),</span>
        <span class="p">(</span><span class="s">&#39;unit_price&#39;</span><span class="p">,</span> <span class="s">&#39;&lt;&#39;</span><span class="p">,</span> <span class="mi">2000</span><span class="p">)]</span>
</pre></div>
</div>
<p >甲``domain``参数可以被添加到关系字段试图选择在客户端接口记录时，以限制有效记录的关系。</p><div role="alert" class="alert-exercise alert"><p class="alert-title">Exercise</p><p >关系字段上的域</p><p >When selecting the instructor for a <em >Session</em>, only instructors (partners
with <code >instructor</code> set to <code >True</code>) should be visible.</p></div><div role="alert" class="alert-exercise alert"><p class="alert-title">Exercise</p><p >更复杂的域</p><p >Create new partner categories <em >Teacher / Level 1</em> and <em >Teacher / Level 2</em>.
The instructor for a session can be either an instructor or a teacher
(of any level).</p></div></section><section id="computed-fields-and-default-values"><h2 >计算字段和默认值</h2><p >So far fields have been stored directly in and retrieved directly from the
database. Fields can also be <em >computed</em>. In that case, the field's value is not
retrieved from the database but computed on-the-fly by calling a method of the
model.</p><p >To create a computed field, create a field and set its attribute
<code class="py xref py-attr">compute</code> to the name of a method. The computation
method should simply set the value of the field to compute on every record in
<code >self</code>.</p><div role="alert" class="alert-danger aphorism alert"><p class="alert-title">危险</p><p >[UNKNOWN NODE problematic]self``是一家集合</p><p >The object <code >self</code> is a <em >recordset</em>, i.e., an ordered collection of
records. It supports the standard Python operations on collections, like
<code >len(self)</code> and <code >iter(self)</code>, plus extra set operations like <code >recs1 +
recs2</code>.</p><p >迭代``self``给人的记录一个接一个，其中每个记录本身尺寸1.集合您可以访问/使用点符号分配在单记录中的字段，如``record.name``。</p></div><div class="highlight-python"><div class="highlight"><pre><span class="kn">import</span> <span class="nn">random</span>
<span class="kn">from</span> <span class="nn">openerp</span> <span class="kn">import</span> <span class="n">models</span><span class="p">,</span> <span class="n">fields</span><span class="p">,</span> <span class="n">api</span>

<span class="k">class</span> <span class="nc">ComputedModel</span><span class="p">(</span><span class="n">models</span><span class="o">.</span><span class="n">Model</span><span class="p">):</span>
    <span class="n">_name</span> <span class="o">=</span> <span class="s">&#39;test.computed&#39;</span>

    <span class="n">name</span> <span class="o">=</span> <span class="n">fields</span><span class="o">.</span><span class="n">Char</span><span class="p">(</span><span class="n">compute</span><span class="o">=</span><span class="s">&#39;_compute_name&#39;</span><span class="p">)</span>

    <span class="nd">@api.multi</span>
    <span class="k">def</span> <span class="nf">_compute_name</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">for</span> <span class="n">record</span> <span class="ow">in</span> <span class="bp">self</span><span class="p">:</span>
            <span class="n">record</span><span class="o">.</span><span class="n">name</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="n">random</span><span class="o">.</span><span class="n">randint</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mf">1e6</span><span class="p">))</span>
</pre></div>
</div>
</section><section id="dependencies"><h3 >依赖</h3><p >The value of a computed field usually depends on the values of other fields on
the computed record. The ORM expects the developer to specify those dependencies
on the compute method with the decorator <code class="py xref py-func">depends()</code>.
The given dependencies are used by the ORM to trigger the recomputation of the
field whenever some of its dependencies have been modified:</p><div class="highlight-python"><div class="highlight"><pre><span class="kn">from</span> <span class="nn">openerp</span> <span class="kn">import</span> <span class="n">models</span><span class="p">,</span> <span class="n">fields</span><span class="p">,</span> <span class="n">api</span>

<span class="k">class</span> <span class="nc">ComputedModel</span><span class="p">(</span><span class="n">models</span><span class="o">.</span><span class="n">Model</span><span class="p">):</span>
    <span class="n">_name</span> <span class="o">=</span> <span class="s">&#39;test.computed&#39;</span>

    <span class="n">name</span> <span class="o">=</span> <span class="n">fields</span><span class="o">.</span><span class="n">Char</span><span class="p">(</span><span class="n">compute</span><span class="o">=</span><span class="s">&#39;_compute_name&#39;</span><span class="p">)</span>
    <span class="n">value</span> <span class="o">=</span> <span class="n">fields</span><span class="o">.</span><span class="n">Integer</span><span class="p">()</span>

    <span class="nd">@api.depends</span><span class="p">(</span><span class="s">&#39;value&#39;</span><span class="p">)</span>
    <span class="k">def</span> <span class="nf">_compute_name</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">for</span> <span class="n">record</span> <span class="ow">in</span> <span class="bp">self</span><span class="p">:</span>
            <span class="n">record</span><span class="o">.</span><span class="n">name</span> <span class="o">=</span> <span class="s">&quot;Record with value </span><span class="si">%s</span><span class="s">&quot;</span> <span class="o">%</span> <span class="n">record</span><span class="o">.</span><span class="n">value</span>
</pre></div>
</div>
<div role="alert" class="alert-exercise alert"><p class="alert-title">Exercise</p><p >计算字段</p><ul ><li >Add the percentage of taken seats to the <em >Session</em> model</li><li >Display that field in the tree and form views</li><li ><p >显示字段的进度条</p></li></ul></div></section><section id="default-values"><h3 >默认值</h3><p >Any field can be given a default value. In the field definition, add the option
<code >default=X</code> where <code >X</code> is either a Python literal value (boolean, integer,
float, string), or a function taking a recordset and returning a value:</p><div class="highlight-python"><div class="highlight"><pre><span class="n">name</span> <span class="o">=</span> <span class="n">fields</span><span class="o">.</span><span class="n">Char</span><span class="p">(</span><span class="n">default</span><span class="o">=</span><span class="s">&quot;Unknown&quot;</span><span class="p">)</span>
<span class="n">user_id</span> <span class="o">=</span> <span class="n">fields</span><span class="o">.</span><span class="n">Many2one</span><span class="p">(</span><span class="s">&#39;res.users&#39;</span><span class="p">,</span> <span class="n">default</span><span class="o">=</span><span class="k">lambda</span> <span class="bp">self</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">env</span><span class="o">.</span><span class="n">user</span><span class="p">)</span>
</pre></div>
</div>
<div role="alert" class="alert-info alert"><p class="alert-title">注解</p><p >The object <code >self.env</code> gives access to request parameters and other useful
things:</p><ul ><li ><code >self.env.cr</code> or <code >self._cr</code> is the database <em >cursor</em> object; it is
used for querying the database</li><li ><code >self.env.uid</code> or <code >self._uid</code> is the current user's database id</li><li ><code >self.env.user</code> is the current user's record</li><li ><code >self.env.context</code> or <code >self._context</code> is the context dictionary</li><li ><code >self.env.ref(xml_id)</code> returns the record corresponding to an XML id</li><li ><code >self.env[model_name]</code> returns an instance of the given model</li></ul></div><div role="alert" class="alert-exercise alert"><p class="alert-title">Exercise</p><p >活动对象 - 默认值</p><ul ><li >Define the start_date default value as today (see
<code class="py xref py-class">Date</code>).</li><li ><p >添加一个字段``active``在上课，并默认设置会为活动。</p></li></ul></div></section><section id="onchange"><h2 >Onchange</h2><p >The &quot;onchange&quot; mechanism provides a way for the client interface to update a
form whenever the user has filled in a value in a field, without saving anything
to the database.</p><p >For instance, suppose a model has three fields <code >amount</code>, <code >unit_price</code> and
<code >price</code>, and you want to update the price on the form when any of the other
fields is modified. To achieve this, define a method where <code >self</code> represents
the record in the form view, and decorate it with <code class="py xref py-func">onchange()</code>
to specify on which field it has to be triggered. Any change you make on
<code >self</code> will be reflected on the form.</p><div class="highlight-xml"><div class="highlight"><pre><span class="c">&lt;!-- content of form view --&gt;</span>
<span class="nt">&lt;field</span> <span class="na">name=</span><span class="s">&quot;amount&quot;</span><span class="nt">/&gt;</span>
<span class="nt">&lt;field</span> <span class="na">name=</span><span class="s">&quot;unit_price&quot;</span><span class="nt">/&gt;</span>
<span class="nt">&lt;field</span> <span class="na">name=</span><span class="s">&quot;price&quot;</span> <span class="na">readonly=</span><span class="s">&quot;1&quot;</span><span class="nt">/&gt;</span>
</pre></div>
</div>
<div class="highlight-python"><div class="highlight"><pre><span class="c"># onchange handler</span>
<span class="nd">@api.onchange</span><span class="p">(</span><span class="s">&#39;amount&#39;</span><span class="p">,</span> <span class="s">&#39;unit_price&#39;</span><span class="p">)</span>
<span class="k">def</span> <span class="nf">_onchange_price</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
    <span class="c"># set auto-changing field</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">price</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">amount</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">unit_price</span>
    <span class="c"># Can optionally return a warning and domains</span>
    <span class="k">return</span> <span class="p">{</span>
        <span class="s">&#39;warning&#39;</span><span class="p">:</span> <span class="p">{</span>
            <span class="s">&#39;title&#39;</span><span class="p">:</span> <span class="s">&quot;Something bad happened&quot;</span><span class="p">,</span>
            <span class="s">&#39;message&#39;</span><span class="p">:</span> <span class="s">&quot;It was very bad indeed&quot;</span><span class="p">,</span>
        <span class="p">}</span>
    <span class="p">}</span>
</pre></div>
</div>
<p >For computed fields, valued <code >onchange</code> behavior is built-in as can be seen by
playing with the <em >Session</em> form: change the number of seats or participants, and
the <code >taken_seats</code> progressbar is automatically updated.</p><div role="alert" class="alert-exercise alert"><p class="alert-title">Exercise</p><p >警示</p><p >添加一个明确的onchange来发出警告无效的值，像一个负数的座位，或更多的参与者比座位。</p></div></section><section id="model-constraints"><h2 >模型的约束</h2><p >Odoo provides two ways to set up automatically verified invariants:
<code class="py xref py-func">Python constraints</code> and
<code class="py xref py-attr">SQL constraints</code>.</p><p >A Python constraint is defined as a method decorated with
<code class="py xref py-func">constrains()</code>, and invoked on a recordset. The decorator
specifies which fields are involved in the constraint, so that the constraint is
automatically evaluated when one of them is modified. The method is expected to
raise an exception if its invariant is not satisfied:</p><div class="highlight-python"><div class="highlight"><pre><span class="kn">from</span> <span class="nn">openerp.exceptions</span> <span class="kn">import</span> <span class="n">ValidationError</span>

<span class="nd">@api.constrains</span><span class="p">(</span><span class="s">&#39;age&#39;</span><span class="p">)</span>
<span class="k">def</span> <span class="nf">_check_something</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
    <span class="k">for</span> <span class="n">record</span> <span class="ow">in</span> <span class="bp">self</span><span class="p">:</span>
        <span class="k">if</span> <span class="n">record</span><span class="o">.</span><span class="n">age</span> <span class="o">&gt;</span> <span class="mi">20</span><span class="p">:</span>
            <span class="k">raise</span> <span class="n">ValidationError</span><span class="p">(</span><span class="s">&quot;Your record is too old: </span><span class="si">%s</span><span class="s">&quot;</span> <span class="o">%</span> <span class="n">record</span><span class="o">.</span><span class="n">age</span><span class="p">)</span>
    <span class="c"># all records passed the test, don&#39;t return anything</span>
</pre></div>
</div>
<div role="alert" class="alert-exercise alert"><p class="alert-title">Exercise</p><p >加入Python的限制</p><p >补充一下，检查该教师没有出现在他/她自己的会议的与会者的约束。</p></div><p >SQL constraints are defined through the model attribute
<code class="py xref py-attr">_sql_constraints</code>. The latter is assigned to a list
of triples of strings <code >(name, sql_definition, message)</code>, where <code >name</code> is a
valid SQL constraint name, <code >sql_definition</code> is a <a href="http://www.postgresql.org/docs/9.3/static/ddl-constraints.html" class="external reference">table_constraint</a> expression,
and <code >message</code> is the error message.</p><div role="alert" class="alert-exercise alert"><p class="alert-title">Exercise</p><p >加入SQL约束</p><p >With the help of <a href="http://www.postgresql.org/docs/9.3/static/ddl-constraints.html" class="external reference alert-link">PostgreSQL's documentation</a> , add the following
constraints:</p><ol ><li ><p >检查过程描述和课程名称不同</p></li><li ><p >使课程的名称唯一</p></li></ol></div><div role="alert" class="alert-exercise alert"><p class="alert-title">Exercise</p><p >练习6  - 添加一个重复的选项</p><p >Since we added a constraint for the Course name uniqueness, it is not
possible to use the &quot;duplicate&quot; function anymore (<span class="menuselection">Form ‣
Duplicate</span>).</p><p >Re-implement your own &quot;copy&quot; method which allows to duplicate the Course
object, changing the original name into &quot;Copy of [original name]&quot;.</p></div></section><section id="advanced-views"><h2 >高级视图</h2></section><section id="id3"><h3 >树状视图</h3><p >Tree views can take supplementary attributes to further customize their
behavior:</p><dl ><dt ><code >decoration-{$name}</code></dt><dd ><p >允许更改行的文本的基础上，相应的记录的属性的风格。</p><p >Values are Python expressions. For each record, the expression is evaluated
with the record's attributes as context values and if <code >true</code>, the
corresponding style is applied to the row. Other context values are
<code >uid</code> (the id of the current user) and <code >current_date</code> (the current date
as a string of the form <code >yyyy-MM-dd</code>).</p><p ><code >{$name}</code> can be <code >bf</code> (<code >font-weight: bold</code>), <code >it</code>
(<code >font-style: italic</code>), or any <a href="http://getbootstrap.com/components/#available-variations" class="external reference">bootstrap contextual color</a> (<code >danger</code>,
<code >info</code>, <code >muted</code>, <code >primary</code>, <code >success</code> or <code >warning</code>).</p><div class="highlight-xml"><div class="highlight"><pre><span class="nt">&lt;tree</span> <span class="na">string=</span><span class="s">&quot;Idea Categories&quot;</span> <span class="na">decoration-info=</span><span class="s">&quot;state==&#39;draft&#39;&quot;</span>
    <span class="na">decoration-danger=</span><span class="s">&quot;state==&#39;trashed&#39;&quot;</span><span class="nt">&gt;</span>
    <span class="nt">&lt;field</span> <span class="na">name=</span><span class="s">&quot;name&quot;</span><span class="nt">/&gt;</span>
    <span class="nt">&lt;field</span> <span class="na">name=</span><span class="s">&quot;state&quot;</span><span class="nt">/&gt;</span>
<span class="nt">&lt;/tree&gt;</span>
</pre></div>
</div>
</dd><dt ><code >editable</code></dt><dd >Either <code >&quot;top&quot;</code> or <code >&quot;bottom&quot;</code>. Makes the tree view editable in-place
(rather than having to go through the form view), the value is the
position where new rows appear.</dd></dl><div role="alert" class="alert-exercise alert"><p class="alert-title">Exercise</p><p >列表着色</p><p >修改会话树视图中的会话持续时间少于5天蓝色这样的方式，和那些持续15天以上为红色。</p></div></section><section id="calendars"><h3 >日历</h3><p >Displays records as calendar events. Their root element is <code >&lt;calendar&gt;</code> and
their most common attributes are:</p><dl ><dt ><code >color</code></dt><dd >The name of the field used for <em >color segmentation</em>. Colors are
automatically distributed to events, but events in the same color segment
(records which have the same value for their <code >@color</code> field) will be
given the same color.</dd><dt ><code >date_start</code></dt><dd ><p >记录的字段持有的开始日期/时间事件</p></dd><dt ><code >date_stop</code> (可选)</dt><dd ><p >记录的字段保持结束日期/时间事件</p></dd></dl><p >field (to define the label for each calendar event)</p><div class="highlight-xml"><div class="highlight"><pre><span class="nt">&lt;calendar</span> <span class="na">string=</span><span class="s">&quot;Ideas&quot;</span> <span class="na">date_start=</span><span class="s">&quot;invent_date&quot;</span> <span class="na">color=</span><span class="s">&quot;inventor_id&quot;</span><span class="nt">&gt;</span>
    <span class="nt">&lt;field</span> <span class="na">name=</span><span class="s">&quot;name&quot;</span><span class="nt">/&gt;</span>
<span class="nt">&lt;/calendar&gt;</span>
</pre></div>
</div>
<div role="alert" class="alert-exercise alert"><p class="alert-title">Exercise</p><p >日历视图</p><p >Add a Calendar view to the <em >Session</em> model enabling the user to view the
events associated to the Open Academy.</p></div></section><section id="id4"><h3 >搜索视图</h3><p >Search view <code >&lt;field&gt;</code> elements can have a <code >@filter_domain</code> that overrides
the domain generated for searching on the given field. In the given domain,
<code >self</code> represents the value entered by the user. In the example below, it is
used to search on both fields <code >name</code> and <code >description</code>.</p><p >Search views can also contain <code >&lt;filter&gt;</code> elements, which act as toggles for
predefined searches. Filters must have one of the following attributes:</p><dl ><dt ><code >domain</code></dt><dd ><p >给定域添加到当前搜索</p></dd><dt ><code >context</code></dt><dd ><p >添加一些上下文当前的搜索;使用密钥``group_by``分组结果在给定的字段名</p></dd></dl><div class="highlight-xml"><div class="highlight"><pre><span class="nt">&lt;search</span> <span class="na">string=</span><span class="s">&quot;Ideas&quot;</span><span class="nt">&gt;</span>
    <span class="nt">&lt;field</span> <span class="na">name=</span><span class="s">&quot;name&quot;</span><span class="nt">/&gt;</span>
    <span class="nt">&lt;field</span> <span class="na">name=</span><span class="s">&quot;description&quot;</span> <span class="na">string=</span><span class="s">&quot;Name and description&quot;</span>
           <span class="na">filter_domain=</span><span class="s">&quot;[&#39;|&#39;, (&#39;name&#39;, &#39;ilike&#39;, self), (&#39;description&#39;, &#39;ilike&#39;, self)]&quot;</span><span class="nt">/&gt;</span>
    <span class="nt">&lt;field</span> <span class="na">name=</span><span class="s">&quot;inventor_id&quot;</span><span class="nt">/&gt;</span>
    <span class="nt">&lt;field</span> <span class="na">name=</span><span class="s">&quot;country_id&quot;</span> <span class="na">widget=</span><span class="s">&quot;selection&quot;</span><span class="nt">/&gt;</span>

    <span class="nt">&lt;filter</span> <span class="na">name=</span><span class="s">&quot;my_ideas&quot;</span> <span class="na">string=</span><span class="s">&quot;My Ideas&quot;</span>
            <span class="na">domain=</span><span class="s">&quot;[(&#39;inventor_id&#39;, &#39;=&#39;, uid)]&quot;</span><span class="nt">/&gt;</span>
    <span class="nt">&lt;group</span> <span class="na">string=</span><span class="s">&quot;Group By&quot;</span><span class="nt">&gt;</span>
        <span class="nt">&lt;filter</span> <span class="na">name=</span><span class="s">&quot;group_by_inventor&quot;</span> <span class="na">string=</span><span class="s">&quot;Inventor&quot;</span>
                <span class="na">context=</span><span class="s">&quot;{&#39;group_by&#39;: &#39;inventor_id&#39;}&quot;</span><span class="nt">/&gt;</span>
    <span class="nt">&lt;/group&gt;</span>
<span class="nt">&lt;/search&gt;</span>
</pre></div>
</div>
<p >要在操作使用非默认的搜索来看，它应该使用动作记录的``search_view_id``域链接。</p><p >The action can also set default values for search fields through its
<code >context</code> field: context keys of the form
<code class="samp">search_default_<em >field_name</em></code> will initialize <em >field_name</em> with the
provided value. Search filters must have an optional <code >@name</code> to have a
default and behave as booleans (they can only be enabled by default).</p><div role="alert" class="alert-exercise alert"><p class="alert-title">Exercise</p><p >搜索视图</p><ol ><li ><p >添加一个按钮来过滤为当前用户是负责在使用过程中搜索视图的课程。使它成为默认选项。</p></li><li ><p >负责用户添加一个按钮组的课程。</p></li></ol></div></section><section id="gantt"><h3 >甘特</h3><p >Horizontal bar charts typically used to show project planning and advancement,
their root element is <code >&lt;gantt&gt;</code>.</p><div class="highlight-xml"><div class="highlight"><pre><span class="nt">&lt;gantt</span> <span class="na">string=</span><span class="s">&quot;Ideas&quot;</span>
       <span class="na">date_start=</span><span class="s">&quot;invent_date&quot;</span>
       <span class="na">date_stop=</span><span class="s">&quot;date_finished&quot;</span>
       <span class="na">progress=</span><span class="s">&quot;progress&quot;</span>
       <span class="na">default_group_by=</span><span class="s">&quot;inventor_id&quot;</span> <span class="nt">/&gt;</span>
</pre></div>
</div>
<div role="alert" class="alert-exercise alert"><p class="alert-title">Exercise</p><p >甘特图</p><p >添加甘特图使用户能够查看会议计划联系到开放学院模块。该会议应该由教师进行分组。</p></div></section><section id="graph-views"><h3 >图形视图</h3><p >Graph views allow aggregated overview and analysis of models, their root
element is <code >&lt;graph&gt;</code>.</p><div role="alert" class="alert-info alert"><p class="alert-title">注解</p><p >Pivot views (element <code >&lt;pivot&gt;</code>) a multidimensional table, allows the
selection of filers and dimensions to get the right aggregated dataset
before moving to a more graphical overview. The pivot view shares the same
content definition as graph views.</p></div><p >图形视图有4个显示模式，默认模式是使用``@ type``属性选定。</p><dl ><dt >Bar (default)</dt><dd ><p >条形图，第一维是用来定义在横轴上基，其它尺寸确定每个组内的凝集条。</p><p >By default bars are side-by-side, they can be stacked by using
<code >@stacked=&quot;True&quot;</code> on the <code >&lt;graph&gt;</code></p></dd><dt >线条</dt><dd ><p >2维线图</p></dd><dt >馅饼</dt><dd ><p >2维馅饼</p></dd></dl><p >Graph views contain <code >&lt;field&gt;</code> with a mandatory <code >@type</code> attribute taking
the values:</p><dl ><dt ><code >row</code> (default)</dt><dd ><p >现场默认情况下应汇总</p></dd><dt ><code >measure</code></dt><dd ><p >该字段应该聚集，而不是分组上</p></dd></dl><div class="highlight-xml"><div class="highlight"><pre><span class="nt">&lt;graph</span> <span class="na">string=</span><span class="s">&quot;Total idea score by Inventor&quot;</span><span class="nt">&gt;</span>
    <span class="nt">&lt;field</span> <span class="na">name=</span><span class="s">&quot;inventor_id&quot;</span><span class="nt">/&gt;</span>
    <span class="nt">&lt;field</span> <span class="na">name=</span><span class="s">&quot;score&quot;</span> <span class="na">type=</span><span class="s">&quot;measure&quot;</span><span class="nt">/&gt;</span>
<span class="nt">&lt;/graph&gt;</span>
</pre></div>
</div>
<div role="alert" class="alert-warning alert"><p class="alert-title">警告</p><p >图形视图上执行数据库值聚合，它们不与非存储计算字段的工作。</p></div><div role="alert" class="alert-exercise alert"><p class="alert-title">Exercise</p><p >图形视图</p><p >添加图表视图中显示的Session对象，为每门课程，出席人数柱状图的形式下。</p></div></section><section id="kanban"><h3 >看板</h3><p >Used to organize tasks, production processes, etc… their root element is
<code >&lt;kanban&gt;</code>.</p><p >看板视图显示了一组卡可能分组列。每张卡片代表一个记录，每一列的聚集字段的值。</p><p >For instance, project tasks may be organized by stage (each column is a
stage), or by responsible (each column is a user), and so on.</p><p >Kanban views define the structure of each card as a mix of form elements
(including basic HTML) and <a href="../reference/qweb.html#reference-qweb" class="internal reference"><span >QWeb</span></a>.</p><div role="alert" class="alert-exercise alert"><p class="alert-title">Exercise</p><p >看板视图</p><p >Add a Kanban view that displays sessions grouped by course (columns are
thus courses).</p></div></section><section id="workflows"><h2 >工作流程</h2><p >工作流是相关的描述它们的动态业务对象模型。工作流也用于跟踪随时间演变的过程。</p><div role="alert" class="alert-exercise alert"><p class="alert-title">Exercise</p><p >几乎一个工作流程</p><p >Add a <code >state</code> field to the <em >Session</em> model. It will be used to define
a workflow-ish.</p><p >A sesion can have three possible states: Draft (default), Confirmed and
Done.</p><p >In the session form, add a (read-only) field to
visualize the state, and buttons to change it. The valid transitions are:</p><ul ><li ><p >草案 - &gt;确认</p></li><li ><p >确认 - &gt;草案</p></li><li ><p >确认 - &gt;完成</p></li><li ><p >完成 - &gt;草案</p></li></ul></div><p >Workflows may be associated with any object in Odoo, and are entirely
customizable. Workflows are used to structure and manage the lifecycles of
business objects and documents, and define transitions, triggers, etc. with
graphical tools. Workflows, activities (nodes or actions) and transitions
(conditions) are declared as XML records, as usual. The tokens that navigate
in workflows are called workitems.</p><div role="alert" class="alert-warning alert"><p class="alert-title">警告</p><p >与模型相关联的工作流程创建模型的记录时才会产生。因此存在与工作流的定义之前创建的会话实例关联没有工作流实例</p></div><div role="alert" class="alert-exercise alert"><p class="alert-title">Exercise</p><p >流程</p><p >Replace the ad-hoc <em >Session</em> workflow by a real workflow. Transform the
<em >Session</em> form view so its buttons call the workflow instead of the
model's methods.</p></div><div role="alert" class="alert-exercise alert"><p class="alert-title">Exercise</p><p >自动转换</p><p >Automatically transition sessions from <em >Draft</em> to <em >Confirmed</em> when more
than half the session's seats are reserved.</p></div><div role="alert" class="alert-exercise alert"><p class="alert-title">Exercise</p><p >服务器操作</p><p >更换Python的方法，由服务器操作同步会话状态。</p><p >两个工作流和服务器的行动可能已经从UI创建完全。</p></div></section><section id="security"><h2 >安全</h2><p >访问控制机制必须被配置为实现一个连贯的安全策略。</p></section><section id="group-based-access-control-mechanisms"><h3 >基于组的访问控制机制</h3><p >Groups are created as normal records on the model <code >res.groups</code>, and granted
menu access via menu definitions. However even without a menu, objects may
still be accessible indirectly, so actual object-level permissions (read,
write, create, unlink) must be defined for groups. They are usually inserted
via CSV files inside modules. It is also possible to restrict access to
specific fields on a view or object using the field's groups attribute.</p></section><section id="access-rights"><h3 >访问权限</h3><p >Access rights are defined as records of the model <code >ir.model.access</code>. Each
access right is associated to a model, a group (or no group for global
access), and a set of permissions: read, write, create, unlink. Such access
rights are usually created by a CSV file named after its model:
<code >ir.model.access.csv</code>.</p><div class="highlight-text"><div class="highlight"><pre>id,name,model_id/id,group_id/id,perm_read,perm_write,perm_create,perm_unlink
access_idea_idea,idea.idea,model_idea_idea,base.group_user,1,1,1,0
access_idea_vote,idea.vote,model_idea_vote,base.group_user,1,1,1,0
</pre></div>
</div>
<div role="alert" class="alert-exercise alert"><p class="alert-title">Exercise</p><p >通过OpenERP的接口添加访问控制</p><p >Create a new user &quot;John Smith&quot;. Then create a group
&quot;OpenAcademy / Session Read&quot; with read access to the <em >Session</em> model.</p></div><div role="alert" class="alert-exercise alert"><p class="alert-title">Exercise</p><p >通过数据文件添加访问控制你的模块</p><p >使用数据文件，</p><ul ><li >Create a group <em >OpenAcademy / Manager</em> with full access to all
OpenAcademy models</li><li >Make <em >Session</em> and <em >Course</em> readable by all users</li></ul></div></section><section id="record-rules"><h3 >记录规则</h3><p >A record rule restricts the access rights to a subset of records of the given
model. A rule is a record of the model <code >ir.rule</code>, and is associated to a
model, a number of groups (many2many field), permissions to which the
restriction applies, and a domain. The domain specifies to which records the
access rights are limited.</p><p >Here is an example of a rule that prevents the deletion of leads that are not
in state <code >cancel</code>. Notice that the value of the field <code >groups</code> must follow
the same convention as the method <code class="py py-meth xref">write()</code> of the ORM.</p><div class="highlight-xml"><div class="highlight"><pre><span class="nt">&lt;record</span> <span class="na">id=</span><span class="s">&quot;delete_cancelled_only&quot;</span> <span class="na">model=</span><span class="s">&quot;ir.rule&quot;</span><span class="nt">&gt;</span>
    <span class="nt">&lt;field</span> <span class="na">name=</span><span class="s">&quot;name&quot;</span><span class="nt">&gt;</span>Only cancelled leads may be deleted<span class="nt">&lt;/field&gt;</span>
    <span class="nt">&lt;field</span> <span class="na">name=</span><span class="s">&quot;model_id&quot;</span> <span class="na">ref=</span><span class="s">&quot;crm.model_crm_lead&quot;</span><span class="nt">/&gt;</span>
    <span class="nt">&lt;field</span> <span class="na">name=</span><span class="s">&quot;groups&quot;</span> <span class="na">eval=</span><span class="s">&quot;[(4, ref(&#39;base.group_sale_manager&#39;))]&quot;</span><span class="nt">/&gt;</span>
    <span class="nt">&lt;field</span> <span class="na">name=</span><span class="s">&quot;perm_read&quot;</span> <span class="na">eval=</span><span class="s">&quot;0&quot;</span><span class="nt">/&gt;</span>
    <span class="nt">&lt;field</span> <span class="na">name=</span><span class="s">&quot;perm_write&quot;</span> <span class="na">eval=</span><span class="s">&quot;0&quot;</span><span class="nt">/&gt;</span>
    <span class="nt">&lt;field</span> <span class="na">name=</span><span class="s">&quot;perm_create&quot;</span> <span class="na">eval=</span><span class="s">&quot;0&quot;</span><span class="nt">/&gt;</span>
    <span class="nt">&lt;field</span> <span class="na">name=</span><span class="s">&quot;perm_unlink&quot;</span> <span class="na">eval=</span><span class="s">&quot;1&quot;</span> <span class="nt">/&gt;</span>
    <span class="nt">&lt;field</span> <span class="na">name=</span><span class="s">&quot;domain_force&quot;</span><span class="nt">&gt;</span>[(&#39;state&#39;,&#39;=&#39;,&#39;cancel&#39;)]<span class="nt">&lt;/field&gt;</span>
<span class="nt">&lt;/record&gt;</span>
</pre></div>
</div>
<div role="alert" class="alert-exercise alert"><p class="alert-title">Exercise</p><p >记录规则</p><p >Add a record rule for the model Course and the group
&quot;OpenAcademy / Manager&quot;, that restricts <code >write</code> and <code >unlink</code> accesses
to the responsible of a course. If a course has no responsible, all users
of the group must be able to modify it.</p></div></section><section id="wizards"><h2 >向导</h2><p >Wizards describe interactive sessions with the user (or dialog boxes) through
dynamic forms. A wizard is simply a model that extends the class
<code class="py xref py-class">TransientModel</code> instead of
<code class="py xref py-class">Model</code>. The class
<code class="py xref py-class">TransientModel</code> extends <code class="py xref py-class">Model</code>
and reuse all its existing mechanisms, with the following particularities:</p><ul ><li >Wizard records are not meant to be persistent; they are automatically deleted
from the database after a certain time. This is why they are called
<em >transient</em>.</li><li >Wizard models do not require explicit access rights: users have all
permissions on wizard records.</li><li >Wizard records may refer to regular records or wizard records through many2one
fields, but regular records <em >cannot</em> refer to wizard records through a
many2one field.</li></ul><p >我们要创建一个向导，允许用户创建与会者特定会话，或者会话在一次列表。</p><div role="alert" class="alert-exercise alert"><p class="alert-title">Exercise</p><p >定义向导</p><p >Create a wizard model with a many2one relationship with the <em >Session</em>
model and a many2many relationship with the <em >Partner</em> model.</p></div></section><section id="launching-wizards"><h3 >启动向导</h3><p >向导是由``ir.actions.act_window``纪录发起，同场``target``的值设置为``new``。后者将打开向导查看到一个弹出式窗口。该动作可通过一菜单项来触发。</p><p >There is another way to launch the wizard: using an <code >ir.actions.act_window</code>
record like above, but with an extra field <code >src_model</code> that specifies in the
context of which model the action is available. The wizard will appear in the
contextual actions of the model, above the main view. Because of some internal
hooks in the ORM, such an action is declared in XML with the tag <code >act_window</code>.</p><div class="xml highlight-python code"><div class="highlight"><pre>&lt;act_window id=&quot;launch_the_wizard&quot;
            name=&quot;Launch the Wizard&quot;
            src_model=&quot;context.model.name&quot;
            res_model=&quot;wizard.model.name&quot;
            view_mode=&quot;form&quot;
            target=&quot;new&quot;
            key2=&quot;client_action_multi&quot;/&gt;
</pre></div>
</div>
<p >Wizards use regular views and their buttons may use the attribute
<code >special=&quot;cancel&quot;</code> to close the wizard window without saving.</p><div role="alert" class="alert-exercise alert"><p class="alert-title">Exercise</p><p >启动向导</p><ol ><li ><p >定义为向导的表单视图。</p></li><li >Add the action to launch it in the context of the <em >Session</em> model.</li><li ><p >定义为向导中的会话字段的默认值;使用上下文参数``self._context``检索当前会话。</p></li></ol></div><div role="alert" class="alert-exercise alert"><p class="alert-title">Exercise</p><p >注册参会</p><p >添加按钮到向导，并实施相应的方法添加与会者给定的会话。</p></div><div role="alert" class="alert-exercise alert"><p class="alert-title">Exercise</p><p >注册与会者多个会话</p><p >修改向导模式，使与会者可以注册多个会话。</p></div></section><section id="internationalization"><h2 >国际化</h2><p >Each module can provide its own translations within the i18n directory, by
having files named LANG.po where LANG is the locale code for the language, or
the language and country combination when they differ (e.g. pt.po or
pt_BR.po). Translations will be loaded automatically by Odoo for all
enabled languages. Developers always use English when creating a module, then
export the module terms using Odoo's gettext POT export feature
(<span class="menuselection">Settings ‣ Translations ‣ Import/Export ‣ Export
Translation</span> without specifying a language), to create the module template POT
file, and then derive the translated PO files. Many IDE's have plugins or modes
for editing and merging PO/POT files.</p><div role="alert" class="alert-info alert"><p class="alert-title">小技巧</p><p >The Portable Object files generated by Odoo are published on
<a href="https://www.transifex.com/odoo/public/" class="external reference alert-link">Transifex</a>, making it
easy to translate the software.</p></div><div class="highlight-text"><div class="highlight"><pre>|- idea/ # The module directory
   |- i18n/ # Translation files
      | - idea.pot # Translation Template (exported from Odoo)
      | - fr.po # French translation
      | - pt_BR.po # Brazilian Portuguese translation
      | (...)
</pre></div>
</div>
<div role="alert" class="alert-info alert"><p class="alert-title">小技巧</p><p >By default Odoo's POT export only extracts labels inside XML files or
inside field definitions in Python code, but any Python string can be
translated this way by surrounding it with the function <code class="py xref py-func">openerp._()</code>
(e.g. <code >_(&quot;Label&quot;)</code>)</p></div><div role="alert" class="alert-exercise alert"><p class="alert-title">Exercise</p><p >转换模块</p><p >选择第二语言为您Odoo安装。翻译你的模块使用由Odoo提供的设施。</p></div></section><section id="reporting"><h2 >报告</h2></section><section id="printed-reports"><h3 >打印报告</h3><p >Odoo 8.0 comes with a new report engine based on <a href="../reference/qweb.html#reference-qweb" class="internal reference"><span >QWeb</span></a>,
<a href="http://getbootstrap.com" class="external reference">Twitter Bootstrap</a> and <a href="http://wkhtmltopdf.org" class="external reference">Wkhtmltopdf</a>.</p><p >A report is a combination two elements:</p><ul ><li ><p >an <code >ir.actions.report.xml</code>, for which a <code >&lt;report&gt;</code> shortcut element is
provided, it sets up various basic parameters for the report (default
type, whether the report should be saved to the database after generation,…)</p><div class="highlight-xml"><div class="highlight"><pre><span class="nt">&lt;report</span>
    <span class="na">id=</span><span class="s">&quot;account_invoices&quot;</span>
    <span class="na">model=</span><span class="s">&quot;account.invoice&quot;</span>
    <span class="na">string=</span><span class="s">&quot;Invoices&quot;</span>
    <span class="na">report_type=</span><span class="s">&quot;qweb-pdf&quot;</span>
    <span class="na">name=</span><span class="s">&quot;account.report_invoice&quot;</span>
    <span class="na">file=</span><span class="s">&quot;account.report_invoice&quot;</span>
    <span class="na">attachment_use=</span><span class="s">&quot;True&quot;</span>
    <span class="na">attachment=</span><span class="s">&quot;(object.state in (&#39;open&#39;,&#39;paid&#39;)) and</span>
<span class="s">        (&#39;INV&#39;+(object.number or &#39;&#39;).replace(&#39;/&#39;,&#39;&#39;)+&#39;.pdf&#39;)&quot;</span>
<span class="nt">/&gt;</span>
</pre></div>
</div>
</li><li ><p >A standard <a href="../reference/views.html#reference-views-qweb" class="internal reference"><span >QWeb view</span></a> for the actual report:</p><div class="highlight-xml"><div class="highlight"><pre><span class="nt">&lt;t</span> <span class="na">t-call=</span><span class="s">&quot;report.html_container&quot;</span><span class="nt">&gt;</span>
    <span class="nt">&lt;t</span> <span class="na">t-foreach=</span><span class="s">&quot;docs&quot;</span> <span class="na">t-as=</span><span class="s">&quot;o&quot;</span><span class="nt">&gt;</span>
        <span class="nt">&lt;t</span> <span class="na">t-call=</span><span class="s">&quot;report.external_layout&quot;</span><span class="nt">&gt;</span>
            <span class="nt">&lt;div</span> <span class="na">class=</span><span class="s">&quot;page&quot;</span><span class="nt">&gt;</span>
                <span class="nt">&lt;h2&gt;</span>Report title<span class="nt">&lt;/h2&gt;</span>
            <span class="nt">&lt;/div&gt;</span>
        <span class="nt">&lt;/t&gt;</span>
    <span class="nt">&lt;/t&gt;</span>
<span class="nt">&lt;/t&gt;</span>

the standard rendering context provides a number of elements, the most
important being:

``docs``
    the records for which the report is printed
``user``
    the user printing the report
</pre></div>
</div>
</li></ul><p >Because reports are standard web pages, they are available through a URL and
output parameters can be manipulated through this URL, for instance the HTML
version of the <em >Invoice</em> report is available through
<a href="http://localhost:8069/report/html/account.report_invoice/1" class="external reference">http://localhost:8069/report/html/account.report_invoice/1</a> (if <code >account</code> is
installed) and the PDF version through
<a href="http://localhost:8069/report/pdf/account.report_invoice/1" class="external reference">http://localhost:8069/report/pdf/account.report_invoice/1</a>.</p><div role="alert" class="alert-danger alert" id="reference-backend-reporting-printed-reports-pdf-without-styles"><p class="alert-title">危险</p><p >If it appears that your PDF report is missing the styles (i.e. the text
appears but the style/layout is different from the html version), probably
your <a href="http://wkhtmltopdf.org" class="external reference alert-link">wkhtmltopdf</a> process cannot reach your web server to download them.</p><p >If you check your server logs and see that the CSS styles are not being
downloaded when generating a PDF report, most surely this is the problem.</p><p >The <a href="http://wkhtmltopdf.org" class="external reference alert-link">wkhtmltopdf</a> process will use the <code >web.base.url</code> system parameter as
the <em >root path</em> to all linked files, but this parameter is automatically
updated each time the Administrator is logged in. If your server resides
behind some kind of proxy, that could not be reachable. You can fix this by
adding one of these system parameters:</p><ul ><li ><code >report.url</code>, pointing to an URL reachable from your server
(probably <code >http://localhost:8069</code> or something similar). It will be
used for this particular purpose only.</li><li ><code >web.base.url.freeze</code>, when set to <code >True</code>, will stop the
automatic updates to <code >web.base.url</code>.</li></ul></div><div role="alert" class="alert-exercise alert"><p class="alert-title">Exercise</p><p >创建报告的会议模式</p><p >对于每个会话，它应该显示会议的名称，它的开始和结束，并列出了会议的与会者。</p></div></section><section id="dashboards"><h3 >仪表板</h3><div role="alert" class="alert-exercise alert"><p class="alert-title">Exercise</p><p >定义仪表板</p><p >Define a dashboard containing the graph view you created, the sessions
calendar view and a list view of the courses (switchable to a form
view). This dashboard should be available through a menuitem in the menu,
and automatically displayed in the web client when the OpenAcademy main
menu is selected.</p></div></section><section id="webservices"><h2 >Web服务</h2><p >The web-service module offer a common interface for all web-services :</p><ul ><li >XML-RPC</li><li >JSON-RPC</li></ul><p >业务对象也可以通过分布式对象机制访问。它们都可以通过与关联视图客户端界面进行修改。</p><p >Odoo是通过XML-RPC / JSON-RPC接口，对于这在许多语言中存在库的访问。</p></section><section id="xml-rpc-library"><h3 >XML-RPC库</h3><p >The following example is a Python program that interacts with an Odoo
server with the library <code >xmlrpclib</code>:</p><div class="highlight-python"><div class="highlight"><pre><span class="kn">import</span> <span class="nn">xmlrpclib</span>

<span class="n">root</span> <span class="o">=</span> <span class="s">&#39;http://</span><span class="si">%s</span><span class="s">:</span><span class="si">%d</span><span class="s">/xmlrpc/&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="n">HOST</span><span class="p">,</span> <span class="n">PORT</span><span class="p">)</span>

<span class="n">uid</span> <span class="o">=</span> <span class="n">xmlrpclib</span><span class="o">.</span><span class="n">ServerProxy</span><span class="p">(</span><span class="n">root</span> <span class="o">+</span> <span class="s">&#39;common&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">login</span><span class="p">(</span><span class="n">DB</span><span class="p">,</span> <span class="n">USER</span><span class="p">,</span> <span class="n">PASS</span><span class="p">)</span>
<span class="k">print</span> <span class="s">&quot;Logged in as </span><span class="si">%s</span><span class="s"> (uid: </span><span class="si">%d</span><span class="s">)&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="n">USER</span><span class="p">,</span> <span class="n">uid</span><span class="p">)</span>

<span class="c"># Create a new note</span>
<span class="n">sock</span> <span class="o">=</span> <span class="n">xmlrpclib</span><span class="o">.</span><span class="n">ServerProxy</span><span class="p">(</span><span class="n">root</span> <span class="o">+</span> <span class="s">&#39;object&#39;</span><span class="p">)</span>
<span class="n">args</span> <span class="o">=</span> <span class="p">{</span>
    <span class="s">&#39;color&#39;</span> <span class="p">:</span> <span class="mi">8</span><span class="p">,</span>
    <span class="s">&#39;memo&#39;</span> <span class="p">:</span> <span class="s">&#39;This is a note&#39;</span><span class="p">,</span>
    <span class="s">&#39;create_uid&#39;</span><span class="p">:</span> <span class="n">uid</span><span class="p">,</span>
<span class="p">}</span>
<span class="n">note_id</span> <span class="o">=</span> <span class="n">sock</span><span class="o">.</span><span class="n">execute</span><span class="p">(</span><span class="n">DB</span><span class="p">,</span> <span class="n">uid</span><span class="p">,</span> <span class="n">PASS</span><span class="p">,</span> <span class="s">&#39;note.note&#39;</span><span class="p">,</span> <span class="s">&#39;create&#39;</span><span class="p">,</span> <span class="n">args</span><span class="p">)</span>
</pre></div>
</div>
<div role="alert" class="alert-exercise alert"><p class="alert-title">Exercise</p><p >添加一个新的服务给客户端</p><p >Write a Python program able to send XML-RPC requests to a PC running
Odoo (yours, or your instructor's). This program should display all
the sessions, and their corresponding number of seats. It should also
create a new session for one of the courses.</p></div></section><section id="json-rpc-library"><h3 >JSON-RPC库</h3><p >The following example is a Python program that interacts with an Odoo server
with the standard Python libraries <code >urllib2</code> and <code >json</code>:</p><div class="highlight-python"><div class="highlight"><pre><span class="kn">import</span> <span class="nn">json</span>
<span class="kn">import</span> <span class="nn">random</span>
<span class="kn">import</span> <span class="nn">urllib2</span>

<span class="k">def</span> <span class="nf">json_rpc</span><span class="p">(</span><span class="n">url</span><span class="p">,</span> <span class="n">method</span><span class="p">,</span> <span class="n">params</span><span class="p">):</span>
    <span class="n">data</span> <span class="o">=</span> <span class="p">{</span>
        <span class="s">&quot;jsonrpc&quot;</span><span class="p">:</span> <span class="s">&quot;2.0&quot;</span><span class="p">,</span>
        <span class="s">&quot;method&quot;</span><span class="p">:</span> <span class="n">method</span><span class="p">,</span>
        <span class="s">&quot;params&quot;</span><span class="p">:</span> <span class="n">params</span><span class="p">,</span>
        <span class="s">&quot;id&quot;</span><span class="p">:</span> <span class="n">random</span><span class="o">.</span><span class="n">randint</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1000000000</span><span class="p">),</span>
    <span class="p">}</span>
    <span class="n">req</span> <span class="o">=</span> <span class="n">urllib2</span><span class="o">.</span><span class="n">Request</span><span class="p">(</span><span class="n">url</span><span class="o">=</span><span class="n">url</span><span class="p">,</span> <span class="n">data</span><span class="o">=</span><span class="n">json</span><span class="o">.</span><span class="n">dumps</span><span class="p">(</span><span class="n">data</span><span class="p">),</span> <span class="n">headers</span><span class="o">=</span><span class="p">{</span>
        <span class="s">&quot;Content-Type&quot;</span><span class="p">:</span><span class="s">&quot;application/json&quot;</span><span class="p">,</span>
    <span class="p">})</span>
    <span class="n">reply</span> <span class="o">=</span> <span class="n">json</span><span class="o">.</span><span class="n">load</span><span class="p">(</span><span class="n">urllib2</span><span class="o">.</span><span class="n">urlopen</span><span class="p">(</span><span class="n">req</span><span class="p">))</span>
    <span class="k">if</span> <span class="n">reply</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s">&quot;error&quot;</span><span class="p">):</span>
        <span class="k">raise</span> <span class="ne">Exception</span><span class="p">(</span><span class="n">reply</span><span class="p">[</span><span class="s">&quot;error&quot;</span><span class="p">])</span>
    <span class="k">return</span> <span class="n">reply</span><span class="p">[</span><span class="s">&quot;result&quot;</span><span class="p">]</span>

<span class="k">def</span> <span class="nf">call</span><span class="p">(</span><span class="n">url</span><span class="p">,</span> <span class="n">service</span><span class="p">,</span> <span class="n">method</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">):</span>
    <span class="k">return</span> <span class="n">json_rpc</span><span class="p">(</span><span class="n">url</span><span class="p">,</span> <span class="s">&quot;call&quot;</span><span class="p">,</span> <span class="p">{</span><span class="s">&quot;service&quot;</span><span class="p">:</span> <span class="n">service</span><span class="p">,</span> <span class="s">&quot;method&quot;</span><span class="p">:</span> <span class="n">method</span><span class="p">,</span> <span class="s">&quot;args&quot;</span><span class="p">:</span> <span class="n">args</span><span class="p">})</span>

<span class="c"># log in the given database</span>
<span class="n">url</span> <span class="o">=</span> <span class="s">&quot;http://</span><span class="si">%s</span><span class="s">:</span><span class="si">%s</span><span class="s">/jsonrpc&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="n">HOST</span><span class="p">,</span> <span class="n">PORT</span><span class="p">)</span>
<span class="n">uid</span> <span class="o">=</span> <span class="n">call</span><span class="p">(</span><span class="n">url</span><span class="p">,</span> <span class="s">&quot;common&quot;</span><span class="p">,</span> <span class="s">&quot;login&quot;</span><span class="p">,</span> <span class="n">DB</span><span class="p">,</span> <span class="n">USER</span><span class="p">,</span> <span class="n">PASS</span><span class="p">)</span>

<span class="c"># create a new note</span>
<span class="n">args</span> <span class="o">=</span> <span class="p">{</span>
    <span class="s">&#39;color&#39;</span> <span class="p">:</span> <span class="mi">8</span><span class="p">,</span>
    <span class="s">&#39;memo&#39;</span> <span class="p">:</span> <span class="s">&#39;This is another note&#39;</span><span class="p">,</span>
    <span class="s">&#39;create_uid&#39;</span><span class="p">:</span> <span class="n">uid</span><span class="p">,</span>
<span class="p">}</span>
<span class="n">note_id</span> <span class="o">=</span> <span class="n">call</span><span class="p">(</span><span class="n">url</span><span class="p">,</span> <span class="s">&quot;object&quot;</span><span class="p">,</span> <span class="s">&quot;execute&quot;</span><span class="p">,</span> <span class="n">DB</span><span class="p">,</span> <span class="n">uid</span><span class="p">,</span> <span class="n">PASS</span><span class="p">,</span> <span class="s">&#39;note.note&#39;</span><span class="p">,</span> <span class="s">&#39;create&#39;</span><span class="p">,</span> <span class="n">args</span><span class="p">)</span>
</pre></div>
</div>
<p >Here is the same program, using the library
<a href="https://pypi.python.org/pypi/jsonrpclib" class="external reference">jsonrpclib</a>:</p><div class="highlight-python"><div class="highlight"><pre><span class="kn">import</span> <span class="nn">jsonrpclib</span>

<span class="c"># server proxy object</span>
<span class="n">url</span> <span class="o">=</span> <span class="s">&quot;http://</span><span class="si">%s</span><span class="s">:</span><span class="si">%s</span><span class="s">/jsonrpc&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="n">HOST</span><span class="p">,</span> <span class="n">PORT</span><span class="p">)</span>
<span class="n">server</span> <span class="o">=</span> <span class="n">jsonrpclib</span><span class="o">.</span><span class="n">Server</span><span class="p">(</span><span class="n">url</span><span class="p">)</span>

<span class="c"># log in the given database</span>
<span class="n">uid</span> <span class="o">=</span> <span class="n">server</span><span class="o">.</span><span class="n">call</span><span class="p">(</span><span class="n">service</span><span class="o">=</span><span class="s">&quot;common&quot;</span><span class="p">,</span> <span class="n">method</span><span class="o">=</span><span class="s">&quot;login&quot;</span><span class="p">,</span> <span class="n">args</span><span class="o">=</span><span class="p">[</span><span class="n">DB</span><span class="p">,</span> <span class="n">USER</span><span class="p">,</span> <span class="n">PASS</span><span class="p">])</span>

<span class="c"># helper function for invoking model methods</span>
<span class="k">def</span> <span class="nf">invoke</span><span class="p">(</span><span class="n">model</span><span class="p">,</span> <span class="n">method</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">):</span>
    <span class="n">args</span> <span class="o">=</span> <span class="p">[</span><span class="n">DB</span><span class="p">,</span> <span class="n">uid</span><span class="p">,</span> <span class="n">PASS</span><span class="p">,</span> <span class="n">model</span><span class="p">,</span> <span class="n">method</span><span class="p">]</span> <span class="o">+</span> <span class="nb">list</span><span class="p">(</span><span class="n">args</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">server</span><span class="o">.</span><span class="n">call</span><span class="p">(</span><span class="n">service</span><span class="o">=</span><span class="s">&quot;object&quot;</span><span class="p">,</span> <span class="n">method</span><span class="o">=</span><span class="s">&quot;execute&quot;</span><span class="p">,</span> <span class="n">args</span><span class="o">=</span><span class="n">args</span><span class="p">)</span>

<span class="c"># create a new note</span>
<span class="n">args</span> <span class="o">=</span> <span class="p">{</span>
    <span class="s">&#39;color&#39;</span> <span class="p">:</span> <span class="mi">8</span><span class="p">,</span>
    <span class="s">&#39;memo&#39;</span> <span class="p">:</span> <span class="s">&#39;This is another note&#39;</span><span class="p">,</span>
    <span class="s">&#39;create_uid&#39;</span><span class="p">:</span> <span class="n">uid</span><span class="p">,</span>
<span class="p">}</span>
<span class="n">note_id</span> <span class="o">=</span> <span class="n">invoke</span><span class="p">(</span><span class="s">&#39;note.note&#39;</span><span class="p">,</span> <span class="s">&#39;create&#39;</span><span class="p">,</span> <span class="n">args</span><span class="p">)</span>
</pre></div>
</div>
<p >例子可以很容易地适应从XML-RPC为JSON-RPC。</p><div role="alert" class="alert-info alert"><p class="alert-title">注解</p><p >There are a number of high-level APIs in various languages to access Odoo
systems without <em >explicitly</em> going through XML-RPC or JSON-RPC, such as:</p><ul ><li ><a href="https://github.com/akretion/ooor" class="external reference alert-link">https://github.com/akretion/ooor</a></li><li ><a href="https://github.com/syleam/openobject-library" class="external reference alert-link">https://github.com/syleam/openobject-library</a></li><li ><a href="https://github.com/nicolas-van/openerp-client-lib" class="external reference alert-link">https://github.com/nicolas-van/openerp-client-lib</a></li><li ><a href="https://pypi.python.org/pypi/oersted/" class="external reference alert-link">https://pypi.python.org/pypi/oersted/</a></li><li ><a href="https://github.com/abhishek-jaiswal/php-openerp-lib" class="external reference alert-link">https://github.com/abhishek-jaiswal/php-openerp-lib</a></li></ul></div><div class="footnote" id="autofields"><span class="footnote-label"><a class="footnote-backref" href="#id2">[1]</a></span> it is possible to <code class="py xref py-attr">disable the automatic creation of some
fields</code></div><div class="footnote" id="rawsql"><span class="footnote-label"><a class="footnote-backref" href="#id1">[2]</a></span> <p >编写原始的SQL查询是可能的，但需要小心，因为它绕过所有Odoo认证和安全机制。</p></div></section>

          </article>
        </div>
        
        <div id="mask"></div>
      </main>
    </div>
  </div>

  <div class="floating_action_container">
    <a id="floating_action" class="ripple" href="#">
      <i class="mdi-action-explore"></i>
    </a>
    <div id="floating_action_menu">
      <span class="bubble"></span>
      <ul class="list-group content">
        <li class="list-group-item ripple"><a>Cras justo odio</a></li>
        <li class="list-group-item ripple"><a>Dapibus ac facilisis in</a></li>
        <li class="list-group-item ripple"><a>Morbi leo risus</a></li>
        <li class="list-group-item ripple"><a>Porta ac consectetur ac</a></li>
        <li class="list-group-item ripple"><a>Vestibulum at eros</a></li>
      </ul>
    </div>
  </div>
  <footer>
    <div id="footer" class="container">
      <span class="o_logo o_logo_inverse center-block o_footer_logo"></span>
      <div class="row">
        <div class="col-sm-7 col-md-7 col-lg-6">
          <div class="row">
            <div class="col-xs-6 col-sm-4">
              <span class="menu_title">Community</span>
              <ul>
                <li><a href="https://github.com/odoo/odoo">Github</a></li>
                <li><a href="http://www.odoo.com/page/download">Download</a></li>
                <li class="divider"></li>
                <li><a href="http://runbot.odoo.com/runbot/repo/git-github-com-odoo-enterprise-7">Runbot</a></li>
                <li><a href="https://github.com/odoo/odoo/wiki/Translations">Translations</a></li>
                <li class="divider"></li>
                <li><a href="http://www.odoo.com/page/odoo-community">Mailing Lists</a></li>
                <li><a href="http://www.odoo.com/forum/help-1">Forum</a></li>
              </ul>
            </div>
            <div class="col-xs-6 col-sm-4">
              <span class="menu_title">Services</span>
              <ul>
                <li><a href="http://www.odoo.com/pricing">Editions</a></li>
                <li><a href="http://www.odoo.com/pricing-online">Cloud Pricing</a></li>
                <li><a href="http://www.odoo.com/page/upgrade">Upgrade</a></li>
                <li class="divider"></li>
                <li><a href="http://www.odoo.com/partners">Find a partner</a></li>
                <li><a href="http://www.odoo.com/page/become-a-partner">Become a partner</a></li>
                <li class="divider"></li>
                <li><a href="http://www.odoo.com/page/education-program">Education</a></li>
                <li class="divider"></li>
                <li><a href="http://www.odoo.com/page/security">Security</a></li>
              </ul>
            </div>
            <div class="col-sm-4 mb64">
              <span class="menu_title">About us</span>
              <ul>
                <li><a href="http://www.odoo.com/page/about-us">Our company</a></li>
                <li><a href="http://www.odoo.com/page/contactus">Contact</a></li>
                <li class="divider" />
                <li><a href="http://www.odoo.com/event">Events</a></li>
                <li><a href="http://www.odoo.com/blog/">Blog</a></li>
                <li><a href="http://www.odoo.com/blog/6">Customers</a></li>
                <li class="divider" />
                <li><a href="http://www.odoo.com/jobs">Jobs</a></li>
              </ul>
            </div>
          </div>
        </div>
        <div class="col-sm-5 col-md-4 col-md-offset-1 col-lg-5 col-lg-offset-1">
          <p>
            <small>
              Odoo is a suite of open source business apps that cover all your company needs: CRM, eCommerce, accounting, inventory, point of sale, project management, etc.
              <br/><br/>
              Odoo's unique value proposition is to be at the same time very easy to use and fully integrated.
            </small>
          </p>
        </div>
      </div>
    </div>
    <div class="o_footer_bottom">
      <div class="container">
        <a class="small" href="http://www.odoo.com/page/website-builder">Website made with <span class="o_logo o_logo_inverse o_logo_15"></span></a>
        <div class="social-links pull-right">
          <a href="http://www.odoo.com/web/about/facebook"><i class="fa fa-facebook"></i></a>
          <a href="http://www.odoo.com/web/about/twitter"><i class="fa fa-twitter"></i></a>
          <a href="http://www.odoo.com/web/about/linkedin"><i class="fa fa-linkedin"></i></a>
          <a href="mailto:info@odoo.com"><i class="fa fa-envelope"></i></a>
        </div>
      </div>
    </div>
  </footer>
  </body>
</html>